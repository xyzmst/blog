<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å†·çŸ³çš„åšå®¢</title>
  <icon>https://coldstone.fun/avatar.png</icon>
  <subtitle>å­‘ç„¶ä¸€èº«ï¼Œå‚²ç«‹äºä¸–</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://coldstone.fun/"/>
  <updated>2019-12-06T12:04:58.098Z</updated>
  <id>https://coldstone.fun/</id>
  
  <author>
    <name>Cold Stone</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Egg.js ä¸Šä¼ æ¥å£å¼€å‘æ€»ç»“</title>
    <link href="https://coldstone.fun/post/2019/12/05/egg-api-dev/"/>
    <id>https://coldstone.fun/post/2019/12/05/egg-api-dev/</id>
    <published>2019-12-05T12:00:00.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/egg.jpg" alt="egg"></p><p>æ€»ç»“ä¸€ä¸‹ä¹‹å‰ç”¨ Egg.js å¼€å‘çš„æ–‡ä»¶ä¸Šä¼ æ¥å£çš„ä»»åŠ¡</p><a id="more"></a><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è¦åœ¨æµè§ˆå™¨ç«¯å°†æ–‡ä»¶ä¸Šä¼ åˆ°é˜¿é‡Œçš„ OSS å¯¹è±¡å­˜å‚¨ï¼Œéœ€è¦ç”¨åˆ°é˜¿é‡Œäº‘æä¾›çš„ <a href="https://github.com/ali-sdk/ali-oss" target="_blank" rel="noopener">SDK</a>ï¼Œä½†æ˜¯è¿™æ ·ä¼šåœ¨å‰ç«¯æš´éœ² OSS çš„ <code>accessKeyId</code> å’Œ <code>accessKeySecret</code>ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ¥å£æŠŠå‰ç«¯ä¼ è¿‡æ¥çš„æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨é‡Œé¢ï¼Œæœ€åˆåªæ”¯æŒé˜¿é‡Œäº‘ï¼Œä¹‹åå¯èƒ½ä¼šæ”¯æŒå…¶å®ƒçš„äº‘æœåŠ¡å•†æ¯”å¦‚ä¸ƒç‰›äº‘ã€‚</p><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p>åç«¯æ¡†æ¶ç”¨çš„æ˜¯ Egg.jsï¼Œå› ä¸ºæ¯”è¾ƒç†Ÿæ‚‰ã€‚ç„¶åè¿™åªæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡ï¼Œä¸€ä¸ªè·¯ç”±å°±è¡Œã€‚</p><pre><code class="js">router.post(`/${app.name}/v1/upload`, controller.oss.upload)</code></pre><p>ç„¶åå®ç°å¯¹åº”çš„ <code>OssController</code> çš„ <code>upload</code> æ–¹æ³•ï¼Œä¸€èˆ¬çš„å®è·µæ˜¯åœ¨ <code>Controller</code> å±‚è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œè¿™é‡Œç”¨å†…ç½®çš„æ˜¯ <code>egg-validate</code> æ’ä»¶è¿›è¡Œæ ¡éªŒã€‚å‡å¦‚æœ‰ä¸¤ä¸ªå‚æ•° <code>folder</code> å’Œ <code>bucket</code> ä»£è¡¨æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•å’Œ <code>bucket</code>ï¼Œé‚£ä¹ˆéªŒè¯ä»£ç å¦‚ä¸‹</p><pre><code class="js">const body = ctx.request.bodyconst rules = {  folder: { type: &#39;string&#39;, required: false, default: &#39;/&#39;, trim: true },  bucket: { type: &#39;string&#39;, required: false, default:  &#39;you-bucket-name&#39; },}await ctx.validate(rules, body)</code></pre><p>æ¥å—å‰ç«¯çš„ä¸Šä¼ æ–‡ä»¶ç”¨çš„æ˜¯ <a href="https://github.com/eggjs/egg-multipart" target="_blank" rel="noopener">egg-multipart</a> æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶æœ‰ä¸¤ç§æ¨¡å¼ <code>file</code> å’Œ <code>stream</code>ï¼Œ<code>file</code> æ¨¡å¼é€‚åˆç®€å•çš„æ–‡ä»¶ä¸Šä¼ ï¼Œè¿™ç§æ¨¡å¼ä¼šå…ˆå°†å‰ç«¯ä¼ æ¥çš„å›¾ç‰‡å­˜åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ‰§è¡Œå®Œæ“ä½œåéœ€è¦ç”¨ <code>ctx.cleanupRequestFiles()</code> æ–¹æ³•å°†æ–‡ä»¶åˆ é™¤ã€‚ <code>stream</code> æ¨¡å¼é€‚åˆåœ¨å¯¹ä¸Šä¼ æ–‡ä»¶è¿›ä¸€æ­¥å¤„ç†çš„æ—¶å€™ä½¿ç”¨ï¼Œå¦‚å‹ç¼©ï¼Œè§£å‹ç­‰ï¼Œå¦‚æœä¸Šä¼ æ–‡ä»¶æ˜¯å›¾ç‰‡é‚£ä¹ˆå¯ä»¥å°†è¿™ä¸ªæµä¼ é€’ç»™å¤„ç†å›¾ç‰‡çš„åº“è¿›è¡Œå¤„ç†ã€‚</p><p>åœ¨ <code>config.default.js</code> é…ç½® <code>egg-multipart</code> æ’ä»¶ï¼Œåœ¨ <code>fileExtensions</code> æ–°å¢éœ€è¦æ·»åŠ çš„æ–‡ä»¶ç±»å‹æ‰©å±•åï¼Œ<code>cleanSchedule</code> é…ç½®å®šæ—¶æ¸…é™¤é›¶æ—¶ä¿å­˜çš„æ–‡ä»¶ã€‚</p><pre><code class="ts">config.multipart = {  mode: &#39;file&#39;,  fileSize: &#39;50mb&#39;,  tmpdir: path.join(os.tmpdir(), &#39;egg-multipart-tmp&#39;, appInfo.name),  cleanSchedule: {    cron: &#39;0 30 4 * * *&#39;,  },  fileExtensions: [ &#39;.pdf&#39;, &#39;.doc&#39;, &#39;.docx&#39; ],}</code></pre><p>ç„¶åç”¨ <code>ctx.request.files</code> è·å–è¯·æ±‚è¿‡æ¥çš„æ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿéœ€è¦è¿›è¡ŒéªŒè¯è¯·æ±‚æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œæ ¡éªŒå¥½è¯·æ±‚å‚æ•°åå°±æŠŠè¯·æ±‚å‚æ•°ä¼ åˆ° <code>Services</code> å±‚é‡Œ</p><pre><code class="js">const files = ctx.request.filesconst body = ctx.request.body...ctx.body = await ctx.service.oss.upload(body, files)</code></pre><p>å¯¹åº”çš„ <code>OssService</code> æ˜¯è´Ÿè´£ä¸»è¦çš„ä»»åŠ¡åœ°æ–¹ï¼Œæ–°å»º <code>OSS</code> å®ä¾‹å¯¹è±¡ï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œè®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚å¤´ï¼Œè¿”å›ä¸Šä¼ ç»“æœã€‚</p><pre><code class="ts">import * as fs from &#39;fs&#39;import * as OSS from &#39;ali-oss&#39;const ONE_YEAR = 3600 * 24 * 365/** * OssService */export default class OssService extends Service {  private client  private createClient(option) {      this.client = new OSS({})    }  }  private async uploadFile(dir, file) {    let result    const filename = file.filename.replace(/\.(\w+)$/, `-${Date.now()}.$1`)    try {      result = await this.client.put(`${dir}${filename}`, file.filepath, {        headers: { &#39;Cache-Control&#39;: `max-age=${ONE_YEAR}`, &#39;Content-Disposition&#39;: &#39;&#39; },      })    } catch (e) {      this.ctx.logger.error(new Error(e.message))      throw new Error(e.message)    } finally {      fs.unlink(file.filepath, () =&gt; true)    }    return result  }  public async upload(parmas, files) {    this.createClient(parmas)    let result    if (files.length &gt; 1) {      result = []      for (const file of files) {        const res = await this.uploadFile(parmas.dir, file)        result.push({ url: res.url })      }    } else {      const file = files[0]      const res = await this.uploadFile(parmas.dir, file)      result = { url: res.url }    }    return result  }}</code></pre><p>è‡³æ­¤ä¸Šä¼ æ–‡ä»¶åˆ° OSS æ¥å£åŸºæœ¬å®Œæˆäº†</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>Egg.js é›†æˆäº† <a href="https://github.com/visionmedia/supertest" target="_blank" rel="noopener">SuperTest</a> æµ‹è¯•æ¡†æ¶ï¼Œæ‰€ä»¥å†™æ¥å£çš„å•å…ƒæµ‹è¯•å¾ˆæ–¹ä¾¿ã€‚è¿™ä¸ªæ¥å£ä¸»è¦æ˜¯å¯¹ <code>Controller</code> å±‚è¯·æ±‚å‚æ•°è¿›è¡Œæµ‹è¯•ã€‚æµ‹è¯•ä»£ç å†™åœ¨é¡¹ç›®ç›®å½• <code>test/app/controller/oss.test.ts</code> æ–‡ä»¶å†…ã€‚</p><pre><code class="ts">import { app, assert } from &#39;egg-mock/bootstrap&#39;describe(&#39;æµ‹è¯• oss controller&#39;, () =&gt; {  it(&#39;ä¸å†ç™½åå•çš„ bucket åè¿”å›é”™è¯¯&#39;, async () =&gt; {    const result = await app.httpRequest()      .post(&#39;/upload-server/v1/upload&#39;)      .set(&#39;Content-type&#39;, &#39;multipart/form-data; boundary=--------------------------820317025826519383208825&#39;)      .field(&#39;bucket&#39;, &#39;wrong-bucket&#39;)      .expect(403)    assert(result.body)  })  it(&#39;ä¸Šä¼ æ–‡ä»¶æˆåŠŸ&#39;, async () =&gt; {    const result = await app.httpRequest()      .post(&#39;/upload-server/v1/upload&#39;)      .set(&#39;Content-type&#39;, &#39;multipart/form-data; boundary=--------------------------820317025826519383208825&#39;)      .field(&#39;dir&#39;, &#39;images&#39;)      .attach(&#39;avatar&#39;, &#39;test/app/controller/avatar.png&#39;)      .expect(200)    assert(result.body)  })})</code></pre><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>Egg.js æœ¬èº«éƒ¨ç½²ååˆ†çš„æ–¹ä¾¿ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯</p><pre><code class="bash">egg-scripts start --daemon --env=prod --title=upload-server</code></pre><p>ä½†æ˜¯å°†è¿™ä¸ªæœåŠ¡å˜æˆä¸€ä¸ª <code>Docker</code> <code>iamge</code> å°±æ›´æ–¹ä¾¿äº†</p><blockquote><p>æ³¨æ„:<br>è¦ç”¨ <code>Docker</code> è¿è¡Œ Egg æœåŠ¡éœ€è¦å°† <code>package.json</code> ä¸­ <code>scripts</code> çš„ <code>start</code> å‘½ä»¤å»æ‰ <code>--daemon</code> å‚æ•°ï¼Œå˜æˆ<br><code>egg-scripts start --env=prod --title=upload-server</code><br>å› ä¸ºåœ¨ <code>Docker</code> è¿è¡Œ Egg åº”ç”¨éœ€è¦æ˜¯å‰å°æ¨¡å¼è¿è¡Œ</p></blockquote><pre><code class="dockerfile">FROM node:lts-alpine# è®¾ç½®æ—¶åŒºRUN apk --update add tzdata \    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \    &amp;&amp; echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone \    &amp;&amp; apk del tzdataWORKDIR /upload-serverCOPY package*.json ./RUN npm install --registry=https://registry.npm.taobao.orgCOPY . /upload-serverRUN npm run tsc &amp;&amp; npm prune --productionEXPOSE 7001CMD npm start</code></pre><p>æœ‰äº†é•œåƒåï¼Œå†™ä¸€ä¸ªè¿è¡Œå®¹å™¨çš„è„šæœ¬ï¼Œæ·»åŠ å¯æ‰§è¡Œçš„æƒé™ï¼Œä¹‹åå¯åŠ¨æœåŠ¡å°±å¯ä»¥åªç”¨è¿è¡Œè¿™ä¸ªè„šæœ¬å³å¯ã€‚</p><pre><code class="sh">#!/bin/bashset -eIMAGE_NAME=&quot;upload-server&quot;CONTAINER_NAME=&quot;upload-server&quot;echo &#39;æ‹‰å–ä»£ç &#39;git pull origin masterecho &#39;è¿è¡Œå®¹å™¨&#39;docker rm -f ${CONTAINER_NAME} || truedocker build -t ${IMAGE_NAME} .docker run -d -p 7001:7001 --env-file .env --name=${CONTAINER_NAME} ${IMAGE_NAME}exitEOF</code></pre><pre><code class="bash">chmod +x ./deploy.sh</code></pre><p>è¿è¡Œè„šæœ¬</p><pre><code class="bash">./deploy.sh</code></pre><h2 id="è¯·æ±‚é¢‘ç‡é™åˆ¶"><a href="#è¯·æ±‚é¢‘ç‡é™åˆ¶" class="headerlink" title="è¯·æ±‚é¢‘ç‡é™åˆ¶"></a>è¯·æ±‚é¢‘ç‡é™åˆ¶</h2><p>ä¸ºäº†é˜²æ­¢æ¥å£è¢«æ»¥ç”¨éœ€è¦é™åˆ¶è¯·æ±‚æ¥å£çš„é¢‘ç‡ï¼Œåœ¨ Github æ‰¾åˆ°ä¸€ä¸ª <a href="https://github.com/koajs/ratelimit" target="_blank" rel="noopener">koa-ratelimit</a> çš„ä»“åº“ï¼Œç”±äº Egg.js æ”¯æŒ Koa çš„æ’ä»¶ï¼Œæ‰€ä»¥ä¹Ÿé€‚åˆã€‚</p><p>å‚è€ƒè¿™ä¸ªä»“åº“çš„æ–‡æ¡£ï¼Œåœ¨é¡¹ç›® <code>middleware</code> æ–‡ä»¶æ·»åŠ ä¸€ä¸ª <code>ratelimit.ts</code>ï¼Œç”¨è¿™ä¸ªä¸­é—´ä»¶æ¥æ§åˆ¶ï¼Œä¸€å¼€å§‹ä½¿ç”¨çš„ <code>redis</code> ä½œä¸º <code>driver</code> å¯æ˜¯é‡åˆ°ä¸€ä¸ª <code>docker-compose</code> ç½‘ç»œé“¾æ¥é—®é¢˜å§‹ç»ˆæ— æ³•è§£å†³ï¼Œé‚æ”¾å¼ƒï¼Œæ”¹ç”¨å†…å­˜æ¨¡å¼ã€‚</p><pre><code class="ts">import * as Redis from &#39;ioredis&#39;import * as ratelimit from &#39;koa-ratelimit&#39;const db = new Map();export default () =&gt; {  return ratelimit({    db: db,    driver: &#39;memory&#39;,    duration: 60000,    errorMessage: &#39;è¯·æ±‚æ¬¡æ•°è¶…è¿‡é™åˆ¶&#39;,    id: ctx =&gt; ctx.ip,    headers: {      remaining: &#39;Upload-Limit-Remaining&#39;,      reset: &#39;Uplaod-Limit-Reset&#39;,      total: &#39;Upload-Limit-Total&#39;,    },    max: 300,    disableHeader: false,  })}</code></pre><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p><strong><em>ä¸Šä¼ åˆ° OSS çš„å›¾ç‰‡åœ¨æµè§ˆå™¨æ— æ³•é¢„è§ˆå˜ä¸ºä¸‹è½½</em></strong></p><p>é¦–å…ˆé˜¿é‡Œäº‘è§„å®š</p><blockquote><p>å¯¹äºå›¾ç‰‡æ–‡ä»¶ï¼ˆåœ¨æœªä¿®æ”¹æ–‡ä»¶httpå¤´çš„æƒ…å†µä¸‹ï¼‰ï¼š<br>è‹¥æ‚¨çš„Bucketæ˜¯2019å¹´9æœˆ23æ—¥å‰åˆ›å»ºçš„ï¼Œä½¿ç”¨OSSé»˜è®¤è®¿é—®åŸŸåæˆ–è‡ªæœ‰åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLä»æµè§ˆå™¨è®¿é—®æ—¶å¯ä»¥é¢„è§ˆæ–‡ä»¶å†…å®¹ã€‚<br>è‹¥æ‚¨çš„Bucketæ˜¯2019å¹´9æœˆ23æ—¥ååˆ›å»ºçš„ï¼Œä½¿ç”¨OSSé»˜è®¤åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLä»æµè§ˆå™¨è®¿é—®æ—¶ä¼šä»¥é™„ä»¶å½¢å¼ä¸‹è½½ï¼›ä½¿ç”¨è‡ªæœ‰åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLè®¿é—®æ—¶ï¼Œå¯ä»¥é¢„è§ˆ&gt; æ–‡ä»¶å†…å®¹ã€‚ç»‘å®šè‡ªæœ‰åŸŸåæ­¥éª¤è¯·å‚è§ç»‘å®šè‡ªå®šä¹‰åŸŸåã€‚</p></blockquote><p>ç„¶åæ˜¯ä¸Šä¼ çš„å›¾ç‰‡ä¸èƒ½æ·»åŠ  <code>Content-Disposition</code> è¿”å›å¤´ä¿¡æ¯ï¼Œç»™æ–‡ä»¶æ·»åŠ äº†è¿™ä¸ª http è¿”å›å¤´ï¼Œä¹Ÿä¼šè®©å›¾ç‰‡å˜æˆä¸‹è½½ã€‚</p><hr><p><strong><em><code>egg-multipart</code> æ’ä»¶ä½¿ç”¨ <code>stream</code> æ¨¡å¼æ— æ³•è·å–è¯·æ±‚ä½“ä¼ è¿‡æ¥çš„å‚æ•°</em></strong></p><p>ç”¨ <code>file</code> æ¨¡å¼èƒ½å¤Ÿæ­£ç¡®çš„æ‹¿åˆ° <code>ctx.request.body</code> é‡Œçš„è¯·æ±‚å‚æ•°ï¼Œä½†æ˜¯å°†ä½¿ç”¨ <code>stream</code> æ¨¡å¼å°±æ— æ³•è·å–ï¼Œæœç´¢äº†ä¸€ä¸‹åå‘ç°ä½¿ç”¨ <code>stream</code> æ¨¡å¼éœ€è¦å°†ä¸Šä¼ æ–‡ä»¶æ”¾åˆ°è¡¨å•çš„æœ€åä¸€é¡¹å»ï¼Œä¸ç„¶æ‹¿ä¸åˆ°å…¶å®ƒå‚æ•°ã€‚</p><blockquote><p><a href="https://eggjs.org/zh-cn/basics/controller.html#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6" target="_blank" rel="noopener">https://eggjs.org/zh-cn/basics/controller.html#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6</a><br>åªæ”¯æŒä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚<br>ä¸Šä¼ æ–‡ä»¶å¿…é¡»åœ¨æ‰€æœ‰å…¶ä»–çš„ fields åé¢ï¼Œå¦åˆ™åœ¨æ‹¿åˆ°æ–‡ä»¶æµæ—¶å¯èƒ½è¿˜è·å–ä¸åˆ° fieldsã€‚</p></blockquote><hr><p><strong><em>Redis æ— æ³•é“¾æ¥é—®é¢˜</em></strong></p><p>ç”¨ä»¥ä¸‹çš„ <code>docker-compose.yml</code> æ–‡ä»¶å¯åŠ¨ Egg.js åº”ç”¨å’Œä¸€ä¸ª <code>Redis</code> æœåŠ¡ï¼Œç„¶åæƒ³åœ¨ä¸Šä¼ æ¥å£çš„è¯·æ±‚é¢‘ç‡é™åˆ¶çš„ä¸­é—´ä»¶ä¸­ä½¿ç”¨è¿™ä¸ª <code>Redis</code> æœåŠ¡ï¼Œç„¶åä¸€ç›´æŠ¥é“¾æ¥å¤±è´¥â€¦Google ä¹‹åè¯•äº†å‡ ç§æ–¹æ³•ä¾ç„¶æ²¡æœ‰æˆåŠŸ :sad:</p><pre><code class="yml">version: &quot;3&quot;services:  redis:    image: redis:alpine    container_name: redis    restart: always    hostname: redis    ports:      - &quot;6379:6379&quot;    networks:       - upload-server-network  upload_server:    build:      context: .      dockerfile: Dockerfile    container_name: upload_server    restart: always    environment:      - EGG_SERVER_ENV:prod    ports:      - 7001:7001    depends_on:      - redis    networks:      - upload-server-networknetworks:  upload-server-network:    driver: bridge</code></pre><hr><p><strong><em>Egg.js å…¨å±€é”™è¯¯å¤„ç†è¿”å›æ ¼å¼é—®é¢˜</em></strong></p><p>Egg.js æœ¬èº«æœ‰ä¸€ä¸ªå…¨å±€é”™è¯¯å¤„ç†çš„æ’ä»¶ <a href="https://github.com/eggjs/egg-onerror" target="_blank" rel="noopener">egg-onerror</a>ï¼Œä½†æ˜¯ç”¨è¿™ä¸ªæ’ä»¶åœ¨å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„å¼‚å¸¸æ—¶ï¼Œç›´æ¥ <code>throw</code> é”™è¯¯ï¼Œè¿”å›ç»™å‰ç«¯çš„æ•°æ®æ ¼å¼æ˜¯æ–‡æœ¬ç±»å‹çš„ï¼Œä¸æ˜¯ json æ ¼å¼ï¼Œé™¤éå‰ç«¯åœ¨å‘é€è¯·æ±‚çš„æ·»åŠ  <code>Accept: application/json</code> è¯·æ±‚å¤´ä¿¡æ¯ã€‚<br>åªèƒ½åœ¨ <code>config.default.js</code> ä½¿ç”¨ <code>all</code> è¿›è¡Œæ•è·å¼‚å¸¸ï¼Œç„¶åç”¨ <code>JSON.stringify</code> æ–¹æ³•åœ¨å¤„ç†ä¸€éï¼Œè¿™æ · <code>throw new Error(e.message)</code> çš„æ—¶å€™è¿”å›ç»™å‰ç«¯çš„æ‰æ˜¯ jsonã€‚</p><pre><code class="js">config.onerror = {  all(err, ctx) {    ctx.status = err.status || 500    ctx.body = JSON.stringify({      code: ctx.status,      success: false,      message: err.message,    })  },}</code></pre><p>æœ€ç»ˆè¿˜æ˜¯æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œè‡ªå·±æ·»åŠ äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿›è¡Œå¼‚å¸¸æ•è·ã€‚</p><pre><code class="ts">private error(msg) {  const { ctx } = this  ctx.status = 400  ctx.body = {    code: ctx.status,    success: false,    message: msg,  }}...this.error(&#39;é”™è¯¯çš„ bucket&#39;)return</code></pre><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/egg.jpg&quot; alt=&quot;egg&quot;&gt;&lt;/p&gt;&lt;p&gt;æ€»ç»“ä¸€ä¸‹ä¹‹å‰ç”¨ Egg.js å¼€å‘çš„æ–‡ä»¶ä¸Šä¼ æ¥å£çš„ä»»åŠ¡&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Egg.js" scheme="https://coldstone.fun/tags/Egg-js/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Flutter å®ç°ä¸€ä¸ªèµ°é©¬ç¯å¸ƒå±€</title>
    <link href="https://coldstone.fun/post/2019/11/20/flutter-carousel/"/>
    <id>https://coldstone.fun/post/2019/11/20/flutter-carousel/</id>
    <published>2019-11-20T07:55:26.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<img src="images/carousel.jpg" height="334"><p>èµ°é©¬ç¯æ˜¯ä¸€ç§å¸¸è§çš„æ•ˆæœï¼Œæœ¬æ–‡è®²ä¸€ä¸‹å¦‚ä½•ç”¨ <code>PageView</code> åœ¨ <code>Flutter</code> é‡Œå®ç°ä¸€ä¸ªèµ°é©¬ç¯</p><a id="more"></a><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p>å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼Œå½“å‰é¡µé¢çš„é«˜åº¦æ¯”å…¶å®ƒé¡µé¢é«˜ï¼Œåˆ‡æ¢é¡µé¢çš„æ—¶å€™æœ‰ä¸€ä¸ªé«˜åº¦å˜åŒ–çš„åŠ¨ç”»ã€‚å®ç°è¿™æ ·çš„æ•ˆæœä¸»è¦ç”¨åˆ°çš„æ˜¯ <code>PageView.builder</code> éƒ¨ä»¶ã€‚</p><div><video src="videos/heroes.mp4" controls width="320" autoplay muted></div><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><h3 id="åˆ›å»ºé¦–é¡µ"><a href="#åˆ›å»ºé¦–é¡µ" class="headerlink" title="åˆ›å»ºé¦–é¡µ"></a>åˆ›å»ºé¦–é¡µ</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>IndexPage</code> éƒ¨ä»¶ï¼Œè¿™ä¸ªéƒ¨ä»¶ç”¨æ¥æ”¾ <code>PageView</code>ï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ›´æ–° UIï¼Œæ‰€ä»¥å®ƒæ˜¯ stateful çš„ã€‚</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;class IndexPage extends StatefulWidget {  @override  _IndexPageState createState() =&gt; _IndexPageState();}class _IndexPageState extends State&lt;IndexPage&gt; {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        elevation: 0.0,        backgroundColor: Colors.white,      ),      body: Column(        children: &lt;Widget&gt;[],      ),    );  }}</code></pre><p>ç„¶ååœ¨éƒ¨ä»¶å†…ç”³æ˜ä¸€ä¸ª <code>_pageIndex</code> å˜é‡ç”¨æ¥ä¿å­˜å½“å‰æ˜¾ç¤ºçš„é¡µé¢çš„ indexï¼Œåœ¨ <code>initState</code> ç”Ÿå‘½å‘¨æœŸé‡Œé¢åˆå§‹åŒ–ä¸€ä¸ª <code>PageController</code> ç”¨æ¥é…ç½® <code>PageView</code> éƒ¨ä»¶ã€‚</p><p>åœ¨ <code>body</code> çš„ <code>Column</code> é‡Œé¢åˆ›å»ºä¸€ä¸ª <code>PageView.builder</code>ï¼Œä½¿ç”¨ä¸€ä¸ª <code>SizedBox</code> éƒ¨ä»¶æŒ‡å®š <code>PageView</code> çš„é«˜åº¦ï¼Œå°† <code>controller</code> è®¾ç½®ä¸º <code>_pageController</code>ï¼Œåœ¨ <code>onPageChanged</code> äº‹ä»¶é‡Œå°†å½“å‰æ˜¾ç¤ºé¡µé¢çš„ <code>index</code> å€¼èµ‹å€¼ç»™ <code>_pageIndex</code> å˜é‡ã€‚</p><pre><code class="dart">int _pageIndex = 0;PageController _pageController;@overridevoid initState() {  super.initState();  _pageController = PageController(    initialPage: 0,    viewportFraction: 0.8,  );}body: Column(  children: &lt;Widget&gt;[    SizedBox(      height: 580.0,      child: PageView.builder(        itemCount: 3,        pageSnapping: true,        controller: _pageController,        onPageChanged: (int index) {          setState(() {            _pageIndex = index;          });        },        itemBuilder: (BuildContext ctx, int index) {          return _buildItem(_pageIndex, index);        },      ),    ),  ],),</code></pre><blockquote><p>å…³é”®ç‚¹: è®¾ç½® <code>PageController</code> çš„ <code>viewportFraction</code> å‚æ•°å°äº 1ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æ¥è®¾ç½®æ¯ä¸ªé¡µé¢åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„æ¯”ä¾‹ï¼Œå°äº 1 çš„è¯ï¼Œå°±å¯ä»¥åœ¨å½“å‰é¡µé¢åŒæ—¶æ˜¾ç¤ºå…¶å®ƒé¡µé¢çš„å†…å®¹äº†ã€‚</p><pre><code class="dart">/// The fraction of the viewport that each page should occupy./// Defaults to 1.0, which means each page fills the viewport in the scrolling direction.final double viewportFraction;</code></pre></blockquote><h3 id="å®ç°-buildItem"><a href="#å®ç°-buildItem" class="headerlink" title="å®ç° _buildItem"></a>å®ç° <code>_buildItem</code></h3><p>æ¥ç€å®ç° <code>_buildItem</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è¿”å› <code>PageView.builder</code> é‡Œæ¯ä¸€ä¸ªé¡µé¢æ¸²æŸ“çš„å†…å®¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>activeIndex</code> æ˜¯å½“å‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šé¡µé¢çš„ <code>index</code>ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>index</code> æ˜¯æ¯ä¸€é¡¹è‡ªå·±çš„ <code>index</code>ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ª <code>Center</code> éƒ¨ä»¶è®©å†…å®¹å±…ä¸­æ˜¾ç¤ºï¼Œç„¶åç”¨ä¸€ä¸ª <code>AnimatedContainer</code> æ·»åŠ é¡µé¢åˆ‡æ¢æ—¶çš„é«˜åº¦å˜åŒ–çš„åŠ¨ç”»æ•ˆæœï¼Œåˆ‡æ¢é¡µé¢çš„æ—¶å€™ä½¿ç”¨äº†<code>setState</code> æ–¹æ³•æ”¹å˜äº† <code>_pageIndex</code>ï¼Œ<code>Flutter</code> é‡æ–°ç»˜åˆ¶æ¯ä¸€é¡¹ã€‚å…³é”®ç‚¹åœ¨äºåˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦ä¸ºæ­£åœ¨æ˜¾ç¤ºçš„é¡µé¢ï¼Œæ˜¯çš„è¯å®ƒçš„é«˜åº¦å°±æ˜¯ 500 ä¸æ˜¯çš„è¯å°±æ˜¯ 450ã€‚</p><pre><code class="dart">_buildItem(activeIndex, index) {  return Center(    child: AnimatedContainer(      curve: Curves.easeInOut,      duration: Duration(milliseconds: 300),      height: activeIndex == index ? 500.0 : 450.0,      margin: EdgeInsets.symmetric(vertical: 20.0, horizontal: 10.0),      decoration: BoxDecoration(        color: heroes[index].color,        borderRadius: BorderRadius.all(Radius.circular(12.0)),      ),      child: Stack(),    ),  );}</code></pre><img src="images/empty00.jpg" width="320" style="width:320px"><h3 id="æ·»åŠ å†…å®¹"><a href="#æ·»åŠ å†…å®¹" class="headerlink" title="æ·»åŠ å†…å®¹"></a>æ·»åŠ å†…å®¹</h3><p>ç„¶åç»™ <code>AnimatedContainer</code> æ·»åŠ æ¯ä¸€é¡¹çš„å†…å®¹</p><pre><code class="dart">child: Stack(  fit: StackFit.expand,  children: &lt;Widget&gt;[    ClipRRect(      borderRadius: BorderRadius.all(        Radius.circular(12.0),      ),      child: Image.network(        heroes[index].image,        fit: BoxFit.cover,      ),    ),    Align(      alignment: Alignment.bottomCenter,      child: Row(        children: &lt;Widget&gt;[          Expanded(            child: Container(              padding: EdgeInsets.all(12.0),              decoration: BoxDecoration(                color: Colors.black26,                borderRadius: BorderRadius.only(                  bottomRight: Radius.circular(12.0),                  bottomLeft: Radius.circular(12.0),                ),              ),              child: Text(                heroes[index].title,                textAlign: TextAlign.center,                style: TextStyle(                  fontSize: 20.0,                  fontWeight: FontWeight.bold,                  color: Colors.white,                ),              ),            ),          )        ],      ),    ),  ],),</code></pre><h3 id="å®ç°æŒ‡ç¤ºå™¨"><a href="#å®ç°æŒ‡ç¤ºå™¨" class="headerlink" title="å®ç°æŒ‡ç¤ºå™¨"></a>å®ç°æŒ‡ç¤ºå™¨</h3><p>ç„¶åå®ç°é¡µé¢çš„æŒ‡ç¤ºå™¨ï¼Œåˆ›å»ºä¸€ä¸ª <code>PageIndicator</code> éƒ¨ä»¶ï¼Œéœ€è¦ä¼ å…¥ <code>pageCount</code> è¡¨ç¤ºæ€»é¡µæ•°ï¼Œä»¥åŠ <code>currentIndex</code> è¡¨ç¤ºå½“å‰æ˜¾ç¤ºçš„é¡µæ•°ç´¢å¼•ã€‚æŠŠæ‰€æœ‰æŒ‡ç¤ºå™¨æ”¾åœ¨ä¸€ä¸ª <code>Row</code> éƒ¨ä»¶é‡Œï¼Œåˆ¤æ–­å½“å‰æŒ‡ç¤ºå™¨çš„ <code>index</code> æ˜¯å¦ä¸ºæ­£åœ¨æ˜¾ç¤ºé¡µé¢çš„ <code>index</code>ï¼Œæ˜¯çš„è¯æ˜¾ç¤ºè¾ƒæ·±çš„é¢œè‰²ã€‚</p><pre><code class="dart">class PageIndicator extends StatelessWidget {  final int pageCount;  final int currentIndex;  const PageIndicator(this.currentIndex, this.pageCount);  Widget _indicator(bool isActive) {    return Container(      width: 6.0,      height: 6.0,      margin: EdgeInsets.symmetric(horizontal: 3.0),      decoration: BoxDecoration(        color: isActive ? Color(0xff666a84) : Color(0xffb9bcca),        shape: BoxShape.circle,        boxShadow: [          BoxShadow(            color: Colors.black12,            offset: Offset(0.0, 3.0),            blurRadius: 3.0,          ),        ],      ),    );  }  List&lt;Widget&gt; _buildIndicators() {    List&lt;Widget&gt; indicators = [];    for (int i = 0; i &lt; pageCount; i++) {      indicators.add(i == currentIndex ? _indicator(true) : _indicator(false));    }    return indicators;  }  @override  Widget build(BuildContext context) {    return Row(      mainAxisAlignment: MainAxisAlignment.center,      children: _buildIndicators(),    );  }}</code></pre><p>æ·»åŠ  <code>PageIndicator</code> åˆ° <code>SizedBox</code> ä¸‹æ”¾</p><h3 id="å°è£…-Carousel"><a href="#å°è£…-Carousel" class="headerlink" title="å°è£… Carousel"></a>å°è£… <code>Carousel</code></h3><p>æœ€åçš„æœ€åä¼˜åŒ–ä¸€ä¸‹ä»£ç ï¼ŒæŠŠéƒ¨ä»¶å°è£…ä¸€ä¸‹ï¼Œè®©å®ƒæˆä¸ºä¸€ä¸ªå•ç‹¬çš„éƒ¨ä»¶ï¼Œåˆ›å»ºä¸€ä¸ª <code>Carousel</code> éƒ¨ä»¶ï¼Œå¯¹å¤–æš´éœ² <code>items</code> å’Œ <code>height</code> ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«é…ç½®æ•°æ®å’Œé«˜åº¦ã€‚</p><pre><code class="dart">class Carousel extends StatefulWidget {  final List items;  final double height;  const Carousel({    @required this.items,    @required this.height,  });  @override  _CarouselState createState() =&gt; _CarouselState();}class _CarouselState extends State&lt;Carousel&gt; {  int _pageIndex = 0;  PageController _pageController;  Widget _buildItem(activeIndex, index) {    final items = widget.items;    return Center(      child: AnimatedContainer(        curve: Curves.easeInOut,        duration: Duration(milliseconds: 300),        height: activeIndex == index ? 500.0 : 450.0,        margin: EdgeInsets.symmetric(vertical: 20.0, horizontal: 10.0),        decoration: BoxDecoration(          color: items[index].color,          borderRadius: BorderRadius.all(Radius.circular(12.0)),        ),        child: Stack(          fit: StackFit.expand,          children: &lt;Widget&gt;[            ClipRRect(              borderRadius: BorderRadius.all(                Radius.circular(12.0),              ),              child: Image.network(                items[index].image,                fit: BoxFit.cover,              ),            ),            Align(              alignment: Alignment.bottomCenter,              child: Row(                children: &lt;Widget&gt;[                  Expanded(                    child: Container(                      padding: EdgeInsets.all(12.0),                      decoration: BoxDecoration(                        color: Colors.black26,                        borderRadius: BorderRadius.only(                          bottomRight: Radius.circular(12.0),                          bottomLeft: Radius.circular(12.0),                        ),                      ),                      child: Text(                        items[index].title,                        textAlign: TextAlign.center,                        style: TextStyle(                          fontSize: 20.0,                          fontWeight: FontWeight.bold,                          color: Colors.white,                        ),                      ),                    ),                  )                ],              ),            ),          ],        ),      ),    );  }  @override  void initState() {    super.initState();    _pageController = PageController(      initialPage: 0,      viewportFraction: 0.8,    );  }  @override  Widget build(BuildContext context) {    return Column(      children: &lt;Widget&gt;[        Container(          height: widget.height,          child: PageView.builder(            pageSnapping: true,            itemCount: heroes.length,            controller: _pageController,            onPageChanged: (int index) {              setState(() {                _pageIndex = index;              });            },            itemBuilder: (BuildContext ctx, int index) {              return _buildItem(_pageIndex, index);            },          ),        ),        PageIndicator(_pageIndex, widget.items.length),      ],    );  }}</code></pre><p>ä¹‹ååœ¨ <code>IndexPage</code> éƒ¨ä»¶é‡Œå°±åªç”¨å®ä¾‹åŒ–ä¸€ä¸ª <code>Carousel</code> äº†ï¼ŒåŒæ—¶ç”±äº <code>IndexPage</code> ä¸ç”¨ç®¡ç†éƒ¨ä»¶çŠ¶æ€äº†ï¼Œå¯ä»¥å°†å®ƒå˜æˆ <code>StatelessWidget</code>ã€‚</p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;class Hero {  final Color color;  final String image;  final String title;  Hero({    @required this.color,    @required this.image,    @required this.title,  });}List heroes = [  Hero(    color: Color(0xFF86F3FB),    image: &quot;https://game.gtimg.cn/images/lol/act/img/skin/big22009.jpg&quot;,    title: &#39;å¯’å†°å°„æ‰‹-è‰¾å¸Œ&#39;,  ),  Hero(    color: Color(0xFF7D6588),    image: &quot;https://game.gtimg.cn/images/lol/act/img/skin/big39006.jpg&quot;,    title: &#39;åˆ€é”‹èˆè€…-è‰¾ç‘è‰å¨…&#39;,  ),  Hero(    color: Color(0xFF4C314D),    image: &quot;https://game.gtimg.cn/images/lol/act/img/skin/big103015.jpg&quot;,    title: &#39;ä¹å°¾å¦–ç‹-é˜¿ç‹¸&#39;,  ),];class Carousel extends StatefulWidget {  final List items;  final double height;  const Carousel({    @required this.items,    @required this.height,  });  @override  _CarouselState createState() =&gt; _CarouselState();}class _CarouselState extends State&lt;Carousel&gt; {  int _pageIndex = 0;  PageController _pageController;  Widget _buildItem(activeIndex, index) {    final items = widget.items;    return Center(      child: AnimatedContainer(        curve: Curves.easeInOut,        duration: Duration(milliseconds: 300),        height: activeIndex == index ? 500.0 : 450.0,        margin: EdgeInsets.symmetric(vertical: 20.0, horizontal: 10.0),        decoration: BoxDecoration(          color: items[index].color,          borderRadius: BorderRadius.all(Radius.circular(12.0)),        ),        child: Stack(          fit: StackFit.expand,          children: &lt;Widget&gt;[            ClipRRect(              borderRadius: BorderRadius.all(                Radius.circular(12.0),              ),              child: Image.network(                items[index].image,                fit: BoxFit.cover,              ),            ),            Align(              alignment: Alignment.bottomCenter,              child: Row(                children: &lt;Widget&gt;[                  Expanded(                    child: Container(                      padding: EdgeInsets.all(12.0),                      decoration: BoxDecoration(                        color: Colors.black26,                        borderRadius: BorderRadius.only(                          bottomRight: Radius.circular(12.0),                          bottomLeft: Radius.circular(12.0),                        ),                      ),                      child: Text(                        items[index].title,                        textAlign: TextAlign.center,                        style: TextStyle(                          fontSize: 20.0,                          fontWeight: FontWeight.bold,                          color: Colors.white,                        ),                      ),                    ),                  )                ],              ),            ),          ],        ),      ),    );  }  @override  void initState() {    super.initState();    _pageController = PageController(      initialPage: 0,      viewportFraction: 0.8,    );  }  @override  Widget build(BuildContext context) {    return Column(      children: &lt;Widget&gt;[        Container(          height: widget.height,          child: PageView.builder(            pageSnapping: true,            itemCount: heroes.length,            controller: _pageController,            onPageChanged: (int index) {              setState(() {                _pageIndex = index;              });            },            itemBuilder: (BuildContext ctx, int index) {              return _buildItem(_pageIndex, index);            },          ),        ),        PageIndicator(_pageIndex, widget.items.length),      ],    );  }}class PageIndicator extends StatelessWidget {  final int currentIndex;  final int pageCount;  const PageIndicator(this.currentIndex, this.pageCount);  Widget _indicator(bool isActive) {    return Container(      width: 6.0,      height: 6.0,      margin: EdgeInsets.symmetric(horizontal: 3.0),      decoration: BoxDecoration(        color: isActive ? Color(0xff666a84) : Color(0xffb9bcca),        shape: BoxShape.circle,        boxShadow: [          BoxShadow(            color: Colors.black12,            offset: Offset(0.0, 3.0),            blurRadius: 3.0,          ),        ],      ),    );  }  List&lt;Widget&gt; _buildIndicators() {    List&lt;Widget&gt; indicators = [];    for (int i = 0; i &lt; pageCount; i++) {      indicators.add(i == currentIndex ? _indicator(true) : _indicator(false));    }    return indicators;  }  @override  Widget build(BuildContext context) {    return Row(      mainAxisAlignment: MainAxisAlignment.center,      children: _buildIndicators(),    );  }}class IndexPage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        elevation: 0.0,        backgroundColor: Colors.white,      ),      body: Carousel(        height: 540,        items: heroes,      ),      backgroundColor: Colors.white,    );  }}</code></pre><p>è‡³æ­¤ï¼Œæ•´ä¸ªå¸ƒå±€å°±å®Œæˆäº†ï¼ ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      &lt;img src=&quot;images/carousel.jpg&quot; height=&quot;334&quot;&gt;&lt;p&gt;èµ°é©¬ç¯æ˜¯ä¸€ç§å¸¸è§çš„æ•ˆæœï¼Œæœ¬æ–‡è®²ä¸€ä¸‹å¦‚ä½•ç”¨ &lt;code&gt;PageView&lt;/code&gt; åœ¨ &lt;code&gt;Flutter&lt;/code&gt; é‡Œå®ç°ä¸€ä¸ªèµ°é©¬ç¯&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«ä¸¤é“é¢è¯•é¢˜</title>
    <link href="https://coldstone.fun/post/2019/11/15/two-interview-question/"/>
    <id>https://coldstone.fun/post/2019/11/15/two-interview-question/</id>
    <published>2019-11-15T02:33:15.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹</p><a id="more"></a><p>å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹</p><h2 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h2><blockquote><p>JavaScript é‡‡ç”¨åŸå‹ç»§æ‰¿ï¼Œå³ä¸€ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªå¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªå¯¹è±¡å†ç»§æ‰¿è‡ªåˆ«çš„å¯¹è±¡ï¼Œä¾æ­¤å¾€å¤ã€‚è¯·å†™ä¸€ä¸ªé€šç”¨çš„ JavaScript å‡½æ•°ï¼Œæ¥æ‰¾å‡ºæŸä¸ªå¯¹è±¡èº«ä¸Šçš„æŸä¸ªå±æ€§ç»§æ‰¿è‡ªå“ªä¸ªå¯¹è±¡ã€‚</p></blockquote><p>è§£ç­”: å®é™…ä¸Šæ˜¯åœ¨è€ƒå¯Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡ä¸Šçš„å±æ€§æ˜¯æœ¬èº«çš„è¿˜æ˜¯é€šè¿‡ç»§æ‰¿æ¥çš„ï¼Œä½¿ç”¨ <code>hasOwnProperty</code> å’Œ <code>getPrototypeOf</code> æ–¹æ³•å³å¯</p><pre><code>function getPrototype(obj, key) {  if (obj.hasOwnProperty(key)) {    return obj  }  return getPrototype(Object.getPrototypeOf(obj), key)}const obj = { a: 'a' }const o1 = Object.create(obj)o1.b = 'b'console.log(o1.a) // aconsole.log(o1.b) // bconsole.log(o1.hasOwnProperty('a')) // falseconsole.log(o1.hasOwnProperty('b')) // trueconsole.log(getPrototype(o1, 'a')) // { a: 'a' }console.log(getPrototype(o1, 'b')) // { b: 'b' }</code></pre><p>ç›¸å…³æ–‡ç« </p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank" rel="noopener">ç»§æ‰¿ä¸åŸå‹é“¾</a></p><h2 id="ç¬¬äºŒé¢˜"><a href="#ç¬¬äºŒé¢˜" class="headerlink" title="ç¬¬äºŒé¢˜"></a>ç¬¬äºŒé¢˜</h2><blockquote><p><code>URLSearchParams()</code> å¯ä»¥è§£æå’Œå¤„ç†URLå‚æ•°ï¼Œç›®å‰å…¼å®¹æ€§ä¸€èˆ¬ï¼Œè¯·å®ç° <code>class URLSearchParams</code> çš„ polyfillã€‚</p><pre><code class="js">searchParams = new URLSearchParams(&quot;foo=1&amp;bar=2&quot;)// æˆ–è€…è¿™æ ·ä¼ å…¥searchParams = new URLSearchParams({foo: &quot;1&quot;, bar: &quot;2&quot;})// å®ä¾‹æ”¯æŒ get()ã€set()ã€has()ã€append() å››ä¸ªæ–¹æ³•// æ”¯æŒä»¥ä¸‹æ–¹å¼searchParams.get(&quot;foo&quot;) // 1searchParams.set(&quot;foo&quot;, &quot;10&quot;)searchParams.has(&quot;bar&quot;)searchParams.append(&quot;foo&quot;, &quot;100&quot;)</code></pre></blockquote><p>è§£ç­”ï¼šç®€å•å®ç°äº†ä¸‹ï¼Œçœ‹äº† Github ä¸Š <code>URLSearchParams</code> çš„ polyfill ä»£ç ï¼Œå‘ç°è¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„</p><pre><code>class URLSearchParams {  constructor (query) {    this._query = {}    if (typeof query === 'string') {      if (query.startsWith('?', 0)) {        query = query.slice(1)      }      query.split('&').forEach(pair => {        const params = pair.split('=')        const key = params[0]        const val = params[1]        this._query[key] = val      })    } else {      for (let [key, value] of Object.entries(query)) {        this._query[key] = query[key]      }    }  }  get (key) {    return this.has(key) ? this._query[key] : null  }  set (key, val) {    this._query[key] = encodeURIComponent(val)    return true  }  has (key) {    return key in this._query  }  append (key, val) {    const value = Array.isArray(val) ? val.join(',') : val    if (key in this._query) {      this._query[key].push(value)    } else {      this._query[key] = value    }    return this._query[key]  }}const mysp1 = new URLSearchParams('a=aaa&b=bbb')const mysp2 = new URLSearchParams({ c: 'ccc', d: 'ddd' })console.log(mysp1) // URLSearchParams { _query: { a: 'aaa', b: 'bbb' } }console.log(mysp1.get('a')) // aaaconsole.log(mysp1.set('c', 'ccc')) // trueconsole.log(mysp1.has('d')) // falseconsole.log(mysp1.append('e', 'eee')) // eeeconsole.log(mysp1) // { _query: { a: 'aaa', b: 'bbb', c: 'ccc', e: 'eee' } }console.log(mysp2) // URLSearchParams { _query: { c: 'ccc', d: 'ddd' } }console.log(mysp2.get('c')) // cccconsole.log(mysp2.set('d', 'ddd2')) // trueconsole.log(mysp2.has('d')) // trueconsole.log(mysp2.append('f', 'fff')) // fffconsole.log(mysp2) // URLSearchParams { _query: { c: 'ccc', d: 'ddd2', f: 'fff' } }</code></pre><p>ç›¸å…³æ–‡ç« </p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams" target="_blank" rel="noopener">URLSearchParams docs</a></p><p><a href="https://github.com/ungap/url-search-params" target="_blank" rel="noopener">URLSearchParams polyfill</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡ªå·±å¤ªèœäº†ï¼ŒåŸºç¡€çŸ¥è¯†ç”±äºæ²¡æœ‰å»å›é¡¾æ‰€ä»¥å¿˜çš„å¾ˆå¤šï¼Œç»§ç»­åŠ æ²¹å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Interview" scheme="https://coldstone.fun/tags/Interview/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ FFmpeg è½¬æ¢è§†é¢‘æ ¼å¼</title>
    <link href="https://coldstone.fun/post/2019/11/11/simple-use-ffmpeg/"/>
    <id>https://coldstone.fun/post/2019/11/11/simple-use-ffmpeg/</id>
    <published>2019-11-11T12:12:26.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ <code>flv</code>ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼ã€‚åœ¨æœç´¢äº†å¾ˆå¤šè§†é¢‘æ ¼å¼è½¬æ¢å·¥å…·åï¼Œå‘ç°å®ƒä»¬å¤§å¤šåº•å±‚æ˜¯ç”¨ <a href="https://www.ffmpeg.org/" target="_blank" rel="noopener">FFmpeg</a> è¿™ä¸ªå¼€æºå·¥å…·è¿›è¡Œè½¬æ¢çš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>FFmpeg</code> å®ƒæœ¬èº«å‘¢</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ <code>flv</code>ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼ã€‚åœ¨æœç´¢äº†å¾ˆå¤šè§†é¢‘æ ¼å¼è½¬æ¢å·¥å…·åï¼Œå‘ç°å®ƒä»¬å¤§å¤šåº•å±‚æ˜¯ç”¨ <a href="https://www.ffmpeg.org/" target="_blank" rel="noopener">FFmpeg</a> è¿™ä¸ªå¼€æºå·¥å…·è¿›è¡Œè½¬æ¢çš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>FFmpeg</code> å®ƒæœ¬èº«å‘¢ã€‚</p><h2 id="å…³äº-FFmpeg"><a href="#å…³äº-FFmpeg" class="headerlink" title="å…³äº FFmpeg"></a>å…³äº FFmpeg</h2><p>å®˜æ–¹æè¿°ï¼šFFmpeg æ˜¯ä¸€ç§éå¸¸å¿«é€Ÿçš„è§†é¢‘å’ŒéŸ³é¢‘è½¬æ¢å™¨ï¼Œä¹Ÿå¯ä»¥ä»å®æ—¶éŸ³é¢‘/è§†é¢‘æºä¸­è·å–ã€‚ å®ƒè¿˜å¯ä»¥åœ¨ä»»æ„é‡‡æ ·ç‡ä¹‹é—´è½¬æ¢ï¼Œå¹¶ä½¿ç”¨é«˜è´¨é‡çš„å¤šç›¸æ»¤æ³¢å™¨å³æ—¶è°ƒæ•´è§†é¢‘å¤§å°ã€‚</p><p>è½¬æ¢æµç¨‹</p><pre><code class="pre"> _______              ______________|       |            |              || input |  demuxer   | encoded data |   decoder| file  | ---------&gt; | packets      | -----+|_______|            |______________|      |                                           v                                       _________                                      |         |                                      | decoded |                                      | frames  |                                      |_________| ________             ______________       ||        |           |              |      || output | &lt;-------- | encoded data | &lt;----+| file   |   muxer   | packets      |   encoder|________|           |______________|</code></pre><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é¦–å…ˆå®‰è£… <code>FFmpeg</code>ï¼ŒmacOS å¯ä»¥ä½¿ç”¨ <code>homebrew</code> å®‰è£…</p><pre><code class="sh">brew install ffmpeg</code></pre><p>Windows åˆ° <code>https://ffmpeg.zeranoe.com/builds</code> è¿™é‡Œä¸‹è½½ zip åŒ…ï¼Œç„¶åå°† <code>bin</code> ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ <code>PATH</code> ä¸­ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>ffmpeg</code> å‘½ä»¤ï¼Œå‡ºç°æç¤ºè¯­å³è¡¨ç¤ºå®‰è£…æˆåŠŸ</p><p><img src="images/ffmpeg-hint.jpg" alt="hint"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åªéœ€ä¸€æ¡å‘½ä»¤å³å¯å¯¹è§†é¢‘è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œ<code>-i</code> å‚æ•°è¡¨ç¤ºéœ€è¦è½¬æ¢çš„è§†é¢‘ï¼Œå€¼æ˜¯è§†é¢‘è·¯å¾„ï¼Œåé¢çš„æ˜¯è½¬æ¢åçš„è§†é¢‘æ–‡ä»¶åã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 output.avi</code></pre><p>è½¬æ¢è¿‡ç¨‹ä¸­ä¼šå‡ºç°è¿›åº¦æç¤º</p><p><img src="images/ffmpeg-running.jpg" alt="running"></p><ul><li><code>frame</code> è¡¨ç¤ºæ˜¯è½¬ç æ‰€è¿›è¡Œåˆ°çš„å¸§æ•°ã€‚</li><li><code>fps</code> è¡¨ç¤ºä¸­çš„ FPS å°±æ˜¯ Frame per Second ï¼Œæ˜¯ç°åœ¨ç”µè„‘æ¯ç§’æ‰€å¤„ç†çš„å¸§çš„æ•°é‡ï¼Œè¿™ä¸ªæ•°å­—è·Ÿè§†é¢‘çš„å¸§ç‡æ— å…³ã€‚</li><li><code>size</code> è¡¨ç¤ºå·²ç»è½¬æ¢å‡ºæ¥çš„è§†é¢‘çš„ä½“ç§¯ã€‚</li><li><code>time</code> è¡¨ç¤ºç»è½¬æ¢å‡ºæ¥çš„è§†é¢‘çš„æ—¶é—´ã€‚</li></ul><h2 id="è½¬æ¢å‚æ•°"><a href="#è½¬æ¢å‚æ•°" class="headerlink" title="è½¬æ¢å‚æ•°"></a>è½¬æ¢å‚æ•°</h2><p><code>-r</code></p><p>è¿™ä¸ªé€‰é¡¹è®¾ç½®è§†é¢‘å¸§ç‡, å•ä½æ˜¯ Hzï¼Œä¹Ÿå°±æ˜¯å¸§æ¯ç§’ FPSï¼Œå¦‚ <code>-r 30</code> å³ä»£è¡¨è¾“å‡ºè§†é¢‘çš„å¸§ç‡ä¸ºæ¯ç§’ 30 å¸§ï¼Œé™ä½å¸§ç‡å¯ä»¥å‡å°è§†é¢‘çš„ä½“ç§¯ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -r 30 output.mp4</code></pre><p><code>-s</code></p><p>é»˜è®¤è¾“å‡ºçš„è§†é¢‘å°ºå¯¸ä¸åŸè§†é¢‘ç›¸åŒï¼Œ<code>-s 720x480</code> é€‰é¡¹å¯ä»¥æŒ‡å®šè¾“å‡ºè§†é¢‘çš„å°ºå¯¸ï¼Œä»¥åƒç´ ä¸ºå•ä½ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -s 720x480 output.mp4</code></pre><p><code>-t</code></p><p>ç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„æŒç»­æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¦‚æˆªå– input.mp4 çš„å‰ 30 ç§’å¹¶ä¿å­˜ä¸º output.mp4ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -t 30 output.mp4</code></pre><p><code>-c</code></p><p>ç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„ç¼–ç ï¼Œè®¾ç½® <code>-c copy</code> è®© <code>FFmpeg</code> åœ¨è½¬æ¢éŸ³è§†é¢‘æ—¶ä¸é‡æ–°è¿›è¡Œç¼–ç ï¼Œå‡å°‘è½¬æ¢è€—æ—¶ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -c copy -t 30 output.mp4</code></pre><p>æ‰§è¡Œ help å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šå…³äºè§†é¢‘è½¬æ¢çš„é€‰é¡¹</p><pre><code class="sh">ffmpeg -help</code></pre><p><img src="images/ffmpeg-video-opt.jpg" alt="video-options"></p><ul><li><code>-vframes</code> è®¾ç½®è¦è¾“å‡ºçš„è§†é¢‘å¸§æ•°</li><li><code>-r</code> é€Ÿç‡è®¾ç½®å¸§é€Ÿç‡ï¼ˆHzå€¼ï¼Œåˆ†æ•°æˆ–ç¼©å†™ï¼‰</li><li><code>-s</code> sizeè®¾ç½®å¸§å¤§å°ï¼ˆWxHæˆ–ç¼©å†™ï¼‰</li><li><code>-aspect</code> å®½é«˜æ¯”è®¾ç½®çš„å®½é«˜æ¯”ï¼ˆ4ï¼š3ã€16ï¼š9æˆ–1.3333ã€1.7777ï¼‰</li><li><code>-bits_per_raw_sample</code> è®¾ç½®æ¯ä¸ªåŸå§‹æ ·æœ¬çš„ä½æ•°</li><li><code>-vn</code> ç¦ç”¨è§†é¢‘</li><li><code>-vcodec</code> ç¼–è§£ç å™¨å¼ºåˆ¶è§†é¢‘ç¼–è§£ç å™¨ï¼ˆâ€œå¤åˆ¶â€ä»¥å¤åˆ¶æµï¼‰</li><li><code>-timecode</code> å•ä½ hhï¼šmmï¼šss [ï¼š;ã€‚] ffè®¾ç½®åˆå§‹ TimeCode å€¼ã€‚</li><li><code>-pass n</code> é€‰æ‹©é€šè¿‡æ¬¡æ•°ï¼ˆ1åˆ°3ï¼‰</li><li><code>-vf filter_graph</code> è®¾ç½®è§†é¢‘è¿‡æ»¤å™¨</li><li><code>-ab</code> æ¯”ç‰¹ç‡éŸ³é¢‘æ¯”ç‰¹ç‡ï¼ˆè¯·ä½¿ç”¨-bï¼šaï¼‰</li><li><code>-b</code> æ¯”ç‰¹ç‡è§†é¢‘æ¯”ç‰¹ç‡ï¼ˆè¯·ä½¿ç”¨-bï¼švï¼‰</li><li><code>-dn</code> ç¦ç”¨æ•°æ®</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.ffmpeg.org/documentation.html" target="_blank" rel="noopener">FFmpeg Documentation</a></p><p><a href="https://wiki.fiveyellowmice.com/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8_FFmpeg_%E8%BF%9B%E8%A1%8C%E8%A7%86%E9%A2%91%E8%BD%AC%E7%A0%81:%E9%A6%96%E9%A1%B5" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨_FFmpeg_è¿›è¡Œè§†é¢‘è½¬ç </a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ &lt;code&gt;flv&lt;/code&gt;ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼ã€‚åœ¨æœç´¢äº†å¾ˆå¤šè§†é¢‘æ ¼å¼è½¬æ¢å·¥å…·åï¼Œå‘ç°å®ƒä»¬å¤§å¤šåº•å±‚æ˜¯ç”¨ &lt;a href=&quot;https://www.ffmpeg.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;FFmpeg&lt;/a&gt; è¿™ä¸ªå¼€æºå·¥å…·è¿›è¡Œè½¬æ¢çš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ &lt;code&gt;FFmpeg&lt;/code&gt; å®ƒæœ¬èº«å‘¢&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="FFmpeg" scheme="https://coldstone.fun/tags/FFmpeg/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹ Egg.js è¿›è¡Œå•å…ƒæµ‹è¯•</title>
    <link href="https://coldstone.fun/post/2019/11/01/eggjs-test/"/>
    <id>https://coldstone.fun/post/2019/11/01/eggjs-test/</id>
    <published>2019-11-01T04:35:00.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>ä¼˜ç§€çš„ä»£ç éœ€è¦æœ‰å•å…ƒæµ‹è¯•è¿›è¡Œè´¨é‡ä¿è¯ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ç»™åº”ç”¨çš„ç¨³å®šæ€§æä¾›äº†ä¸€å±‚ä¿éšœï¼Œæœ¬æ–‡è¯´ä¸€ä¸‹å¦‚ä½•å¯¹ä½¿ç”¨ egg.js å†™çš„æ¥å£è¿›è¡Œå•å…ƒæµ‹è¯•</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¼˜ç§€çš„ä»£ç éœ€è¦æœ‰å•å…ƒæµ‹è¯•è¿›è¡Œè´¨é‡ä¿è¯ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ç»™åº”ç”¨çš„ç¨³å®šæ€§æä¾›äº†ä¸€å±‚ä¿éšœã€‚</p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>egg.js å·¥ç¨‹çš„æµ‹è¯•ä»£ç éƒ½æ˜¯æ”¾åœ¨å·¥ç¨‹çš„ test ç›®å½•ä¸‹ï¼Œå‘½åçš„æ–¹å¼ä¸º <code>${filename}.test.js</code>ï¼Œæ¯”å¦‚æˆ‘æƒ³æµ‹è¯•é¡¹ç›®çš„ <code>user</code> <code>controller</code> å°±åœ¨ <code>test</code> ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <code>controller/user.test.js</code>ï¼ŒåŒç†è¦æµ‹ <code>service</code> å°±æ˜¯åˆ›å»ºä¸€ä¸ª <code>service</code> ç›®å½•ï¼Œç„¶åå°±æ˜¯å†™å…·ä½“çš„æµ‹è¯•ä»£ç äº†ã€‚</p><p>å‡è®¾ç°åœ¨éœ€è¦å¯¹ä¸€ä¸ª <code>UserService</code> è¿›è¡Œæµ‹è¯•ï¼Œé¦–å…ˆåœ¨ <code>user.test.js</code> ä¸­å¼•å…¥ <code>egg-mock</code> æ¨¡å—ç”¨æ¥åˆ›å»ºä¸€ä¸ª <code>app</code> å®ä¾‹ä»¥åŠä¸€ä¸ª <code>ctx</code> å¯¹è±¡ï¼Œä¸€èˆ¬åœ¨è¯·æ±‚æ¥å£çš„æ—¶å€™ä¼šåœ¨ <code>ctx</code> å¯¹è±¡ä¸Šæºå¸¦è¿™æ¬¡è¯·æ±‚çš„å‚æ•°å’Œæ˜¯ç”¨æˆ·ä¿¡æ¯ï¼Œéœ€è¦åœ¨åˆ›å»º <code>ctx</code> çš„æ—¶å€™æ·»åŠ æ‰€è¦çš„æ•°æ®ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ <code>before</code> å‡½æ•°ä¸­ï¼Œå°†è¿™äº›æ•°æ®é™„åŠ åˆ° <code>ctx</code> ä¸Šã€‚</p><pre><code class="js">const { app, assert } = require(&#39;egg-mock/bootstrap&#39;)let ctxbefore(() =&gt; {  ctx = app.mockContext({    user: {      name: &#39;your-name&#39;    }  })})</code></pre><p>å¦‚æœè¿˜éœ€è¦æ·»åŠ è¯·æ±‚å¤´ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ <code>token</code> å¯ä»¥è¿™æ ·æ·»åŠ </p><pre><code class="js">ctx.request.headers = {  authorization: yourToken}</code></pre><p>å‡†å¤‡å®Œæ¯•ï¼Œæ¥ä¸‹æ¥ç¼–å†™å…·ä½“çš„æµ‹è¯•ä»£ç äº†ï¼Œå‡å¦‚ <code>UserService</code> æœ‰ä¸€ä¸ª <code>create</code> æ–¹æ³•ï¼Œä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>user</code>ï¼Œå‚æ•°æ˜¯è¯·æ±‚ä½“ä¼ è¿‡æ¥çš„æ–°å»ºç”¨æˆ·æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™æµ‹è¯•ä»£ç </p><pre><code class="js">it(&#39;create æ–¹æ³•è¿”å›æ–°å¢ç”¨æˆ·æˆåŠŸä¿¡æ¯&#39;, async () =&gt; {  const data = {    name: &#39;user name&#39; + Date.now(),    age: parseInt(Math.random() * 60),    gender: Math.random() &gt; 0.5 ? &#39;male&#39; : &#39;female&#39;  }  const response = await ctx.service.user.create(data)  assert(response.success === true)  assert(response.payload.length &gt; 0)})</code></pre><p>å®Œæ•´çš„ä»£ç </p><pre><code>'use strict';const { app, assert } = require('egg-mock/bootstrap');describe('ç”¨æˆ·æœåŠ¡æµ‹è¯•', () => {  let ctx  before(() => {    ctx = app.mockContext({      user: {        name: 'your-name',      },    });    ctx.request.headers = {      authorization: yourToken    };  })  it('create æ–¹æ³•è¿”å›æ–°å¢ç”¨æˆ·æˆåŠŸä¿¡æ¯', async () => {    const data = {      name: 'user name' + Date.now(),      age: parseInt(Math.random() * 60),      gender: Math.random() > .5 ? 'male' : 'female'    };    const response = await ctx.service.user.create(data);    assert(response.success === true);    assert(response.payload.length > 0);  });})</code></pre><p>æ–­è¨€è¿”å›å€¼çš„ <code>success</code> ä¸º <code>true</code>ï¼Œ<code>payload</code> çš„ <code>length</code> å±æ€§é•¿åº¦å¤§äº 0ï¼Œå½“ç„¶è¿™éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡æ¥å†™ï¼Œä¸€ä¸ª <code>service</code> å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„æ–¹æ³•ï¼Œéœ€è¦å°½å¯èƒ½å¤šçš„å¯¹è¿™äº›æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚</p><p>æœ€åå°±æ˜¯æ‰§è¡Œæµ‹è¯•ä»£ç äº†</p><pre><code class="sh">npm run test</code></pre><p>é€šè¿‡å‘½ä»¤ <code>npm run test</code> æ‰§è¡Œ <code>egg-bin test</code>ï¼Œæˆ–è€…åœ¨ <code>Idea</code> æ·»åŠ ä¸€ä¸ªæµ‹è¯•çš„ <code>configuration</code> ç‚¹å‡»æ‰§è¡Œå³å¯ï¼Œè¿™æ · <code>test</code> ç›®å½•ä¸‹çš„æ‰€æœ‰æµ‹è¯•éƒ½ä¼šè¿è¡Œã€‚è¿è¡Œå…¨éƒ¨çš„æµ‹è¯•è€—æ—¶å¯èƒ½ä¼šå¾ˆé•¿æˆ–è€…æœ‰æ—¶åªéœ€è¦å¯¹ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ—¶é€šè¿‡æŒ‡å®šæµ‹è¯•æ–‡ä»¶çš„è·¯å¾„å³å¯</p><pre><code class="sh">npm run test &lt;TestFilePath&gt;</code></pre><p>è¿è¡Œæµ‹è¯•çš„æ—¶å€™ä¼šåŠ è½½ <code>config.unittest.js</code> é‡Œé¢çš„é…ç½®ï¼Œè¿è¡Œå®Œæ¯•ï¼Œæ²¡æœ‰é€šè¿‡çš„æµ‹è¯•ä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®šä½é”™è¯¯ï¼Œå¦‚æœæµ‹è¯•éƒ½é€šè¿‡äº†å°±ä¼šå‡ºç°æµ‹è¯•é€šè¿‡çš„ä»¥åŠè€—æ—¶ä¿¡æ¯</p><p><img src="images/egg-test.jpg" alt="test"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://eggjs.org/zh-cn/core/unittest.html" target="_blank" rel="noopener">å•å…ƒæµ‹è¯•</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¼˜ç§€çš„ä»£ç éœ€è¦æœ‰å•å…ƒæµ‹è¯•è¿›è¡Œè´¨é‡ä¿è¯ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ç»™åº”ç”¨çš„ç¨³å®šæ€§æä¾›äº†ä¸€å±‚ä¿éšœï¼Œæœ¬æ–‡è¯´ä¸€ä¸‹å¦‚ä½•å¯¹ä½¿ç”¨ egg.js å†™çš„æ¥å£è¿›è¡Œå•å…ƒæµ‹è¯•&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Egg" scheme="https://coldstone.fun/tags/Egg/"/>
    
  </entry>
  
  <entry>
    <title>Docker ARG vs ENV</title>
    <link href="https://coldstone.fun/post/2019/10/25/docker-arg-vs-env/"/>
    <id>https://coldstone.fun/post/2019/10/25/docker-arg-vs-env/</id>
    <published>2019-10-25T06:12:19.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>æ„å»º Docker é•œåƒçš„çš„æ—¶å€™æœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ <code>ARG</code> å’Œ <code>ENV</code>, ä¸€ç§æ˜¯åœ¨è¿è¡Œ build å‘½ä»¤æ—¶é€šè¿‡ <code>--build-arg</code> å‚æ•°è®¾ç½®çš„ build-time variables ä»¥åŠé€šè¿‡åœ¨ <code>dockerfile</code> é‡Œé¢è®¾ç½® <code>ENV</code> æŒ‡ä»¤é…ç½®çš„ç¯å¢ƒå˜é‡ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ„å»º Docker é•œåƒçš„çš„æ—¶å€™æœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ <code>ARG</code> å’Œ <code>ENV</code>, ä¸€ç§æ˜¯åœ¨è¿è¡Œ build å‘½ä»¤æ—¶é€šè¿‡ <code>--build-arg</code> å‚æ•°è®¾ç½®çš„ build-time variables ä»¥åŠé€šè¿‡åœ¨ <code>dockerfile</code> é‡Œé¢è®¾ç½® <code>ENV</code> æŒ‡ä»¤é…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œæœ¬æ–‡è¯´æ˜å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</p><h2 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h2><p>Dockerfile é‡Œé¢çš„ ARG æŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œåœ¨è¿è¡Œ <code>docker build</code> å‘½ä»¤æ—¶ä½¿ç”¨ <code>--build-arg &lt;varname&gt; = &lt;value&gt;</code> å‚æ•°å°†å…¶ä¼ é€’ç»™æ„å»ºå™¨ã€‚</p><pre><code class="dockerfile">ARG &lt;name&gt;[=&lt;default value&gt;]</code></pre><p>è¿™ç§å˜é‡åªå­˜åœ¨äºé•œåƒæ„å»ºçš„æ—¶å€™ï¼Œä¸€æ—¦é•œåƒæ„å»ºå®Œæˆå°±å¤±æ•ˆäº†ï¼Œä¸è¦ä½¿ç”¨æ„å»ºæ—¶å˜é‡æ¥ä¼ é€’è¯¸å¦‚ github å¯†é’¥ï¼Œç”¨æˆ·å‡­æ®ç­‰æœºå¯†æ•°æ®ï¼Œæ„å»ºæ—¶å˜é‡å€¼å¯ä»¥ä½¿ç”¨ docker history å‘½ä»¤æŸ¥çœ‹ã€‚</p><h2 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h2><p>Dockerfile é‡Œé¢çš„ ENV æŒ‡ä»¤å°†ç¯å¢ƒå˜é‡<key>è®¾ç½®ä¸ºå€¼<value>ï¼Œè¿™ä¸ªå˜é‡å°†åœ¨æ„å»ºé˜¶æ®µä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</value></key></p><pre><code class="dockerfile">ENV &lt;key&gt; &lt;value&gt;ENV &lt;key&gt;=&lt;value&gt; ...</code></pre><p>ä½¿ç”¨ ENV è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†ä¸€ç›´å­˜åœ¨äºæ„å»ºé•œåƒæ—¶ä»¥åŠé•œåƒå®¹å™¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ docker inspect æŸ¥çœ‹è®¾ç½®æ‰“çš„å˜é‡ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>docker run --env &lt;key&gt; = &lt;value&gt;</code> æ¥æ›´æ”¹å®ƒä»¬ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å¦‚æœåªæ˜¯éœ€è¦æ„å»ºé•œåƒæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨ <code>ARG</code>ï¼Œå¦‚æœè¿™ä¸ªå˜é‡åœ¨å®¹å™¨è¿è¡Œæ—¶ä¹Ÿæœ‰ç”¨åˆ°å°±éœ€è¦ç”¨ <code>ENV</code>ï¼Œæ³¨æ„ä½¿ç”¨ <code>ENV</code> æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡ä¼šè¦†ç›–åŒåçš„ <code>ARG</code> æŒ‡ä»¤å®šä¹‰çš„å˜é‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ„å»º Docker é•œåƒçš„çš„æ—¶å€™æœ‰ä¸¤ç§ç¯å¢ƒå˜é‡ &lt;code&gt;ARG&lt;/code&gt; å’Œ &lt;code&gt;ENV&lt;/code&gt;, ä¸€ç§æ˜¯åœ¨è¿è¡Œ build å‘½ä»¤æ—¶é€šè¿‡ &lt;code&gt;--build-arg&lt;/code&gt; å‚æ•°è®¾ç½®çš„ build-time variables ä»¥åŠé€šè¿‡åœ¨ &lt;code&gt;dockerfile&lt;/code&gt; é‡Œé¢è®¾ç½® &lt;code&gt;ENV&lt;/code&gt; æŒ‡ä»¤é…ç½®çš„ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Docker" scheme="https://coldstone.fun/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯ä»£ç è§„èŒƒ</title>
    <link href="https://coldstone.fun/post/2019/10/10/code-standard/"/>
    <id>https://coldstone.fun/post/2019/10/10/code-standard/</id>
    <published>2019-10-10T09:59:04.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>è‰¯å¥½çš„ä»£ç è§„èŒƒæœ‰åˆ©äºæé«˜é¡¹ç›®å¼€å‘æ•ˆç‡ä»¥åŠå‡å°‘é˜…è¯»ä»£ç çš„å›°éš¾ï¼Œæœ¬è§„èŒƒç»“åˆäº†(chaoxi)å¤šä¸ªæµè¡Œçš„ä»£ç è§„èŒƒä»¥åŠå‰äººçš„å¼€å‘ç»éªŒè€Œæˆï¼Œå‚è€ƒè§„èŒƒè¿›è¡Œå¼€å‘æé«˜ä»£ç è´¨é‡</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è‰¯å¥½çš„ä»£ç è§„èŒƒæœ‰åˆ©äºæé«˜é¡¹ç›®å¼€å‘æ•ˆç‡ä»¥åŠå‡å°‘é˜…è¯»ä»£ç çš„å›°éš¾ï¼Œæœ¬è§„èŒƒç»“åˆäº†(chaoxi)å¤šä¸ªæµè¡Œçš„ä»£ç è§„èŒƒä»¥åŠå‰äººçš„å¼€å‘ç»éªŒè€Œæˆï¼Œå‚è€ƒè§„èŒƒè¿›è¡Œå¼€å‘æé«˜ä»£ç è´¨é‡</p><h2 id="HTML-è§„èŒƒ"><a href="#HTML-è§„èŒƒ" class="headerlink" title="HTML è§„èŒƒ"></a>HTML è§„èŒƒ</h2><p>è®¾ç½®æ ‡å‡†æ¨¡å¼çš„æ–‡æ¡£ç±»å‹</p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt; &lt;/head&gt;&lt;/html&gt;</code></pre><p>è®¾ç½®é¡µé¢è¯­è¨€</p><pre><code class="html">&lt;html lang=&quot;zh-CN&quot;&gt;&lt;/html&gt;</code></pre><p>è®¾ç½®é¡µé¢å­—ç¬¦ç¼–ç </p><pre><code class="html">&lt;meta charset=&quot;UTF-8&quot; /&gt;</code></pre><p>ä½¿ç”¨è¯­ä¹‰åŒ–çš„æ ‡ç­¾å‡†ç¡®åœ°æè¿°ç½‘é¡µçš„å†…å®¹</p><pre><code class="html">&lt;main&gt;  &lt;article&gt;    &lt;header&gt;      &lt;h1&gt;title&lt;/h1&gt;      &lt;p&gt;published: &lt;time datetime=&quot;2015-02-21&quot;&gt;21st Feb, 2015&lt;/time&gt;&lt;/p&gt;    &lt;/header&gt;    &lt;p&gt;content&lt;/p&gt;  &lt;/article&gt;  &lt;aside&gt;...&lt;/aside&gt;  &lt;footer&gt;...&lt;/footer&gt;&lt;/main&gt;</code></pre><p>ç¡®ä¿é¡µé¢å¯è®¿é—®æ€§</p><ul><li>ç»™ <code>img</code> æ ‡ç­¾æ·»åŠ æ­£ç¡®çš„ <code>alt</code> å±æ€§</li><li>ä½¿ç”¨ <code>label</code> æ ‡ç­¾å¯¹è¡¨å•è¿›è¡Œæ§åˆ¶</li></ul><p>ä½¿ç”¨å­—ç¬¦å®ä½“æ›¿ä»£ç‰¹æ®Šå­—ç¬¦</p><pre><code class="html">&lt;span&gt;&amp;gt;&lt;/span&gt;&lt;span&gt;&amp;copy;&lt;/span&gt;&lt;span&gt;&amp;lt;&lt;/span&gt;</code></pre><p>ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼ç¼©è¿›</p><pre><code class="html">&lt;section&gt;  &lt;h1&gt;&lt;/h1&gt;&lt;/section&gt;</code></pre><p>æŒ‰ç‰¹å®šé¡ºåºä¹¦å†™æ ‡ç­¾å±æ€§</p><ol><li><code>class</code></li><li><code>id</code>, <code>name</code></li><li><code>data-*</code></li><li><code>src</code>, <code>for</code>, <code>type</code>, <code>href</code>, <code>value</code></li><li><code>title</code>, <code>alt</code></li><li><code>role</code>, <code>aria-*</code></li></ol><pre><code class="html">&lt;!-- ç¤ºä¾‹ --&gt;&lt;a class=&quot;link&quot; id=&quot;link&quot; data-toggle=&quot;modal&quot; href=&quot;#&quot;&gt;link&lt;/a&gt;&lt;input class=&quot;form-control&quot; type=&quot;text&quot; /&gt;&lt;img src=&quot;example.jpg&quot; alt=&quot;dog&quot; /&gt;</code></pre><p>ä¸å¯¹å¸ƒå°”å±æ€§èµ‹å€¼</p><pre><code class="html">&lt;!-- ç¤ºä¾‹ --&gt;&lt;input type=&quot;text&quot; disabled /&gt;&lt;input type=&quot;checkbox&quot; value=&quot;1&quot; checked /&gt;&lt;select&gt;  &lt;option value=&quot;1&quot; selected&gt;1&lt;/option&gt;&lt;/select&gt;</code></pre><h2 id="CSS-è§„èŒƒ"><a href="#CSS-è§„èŒƒ" class="headerlink" title="CSS è§„èŒƒ"></a>CSS è§„èŒƒ</h2><p>å…¨å±€è®¾ç½®ç›’å­æ¨¡å‹</p><pre><code class="css">* {  box-sizing: border-box;}</code></pre><p>ä½¿ç”¨ç®€æ´çš„ class å‘½å</p><p>class çš„å‘½ååº”è¯¥å°½é‡ç®€æ´ã€æ˜ç¡®ï¼Œä»¥å­—æ¯å¼€å¤´å‘½åï¼Œä¸”å…¨éƒ¨å­—æ¯ä¸ºå°å†™ï¼Œå•è¯ä¹‹é—´ä½¿ç”¨è¿å­—ç¬¦ â€œ-â€ è¿æ¥ã€‚<br>æ¯ä¸ªæ¨¡å—ä½¿ç”¨ä¸€ä¸ªæ¨¡å—å‘½åï¼Œå­å…ƒç´ ä½¿ç”¨æ¨¡å—å + å…ƒç´ ä½œç”¨åå</p><pre><code class="html">&lt;!-- ç¤ºä¾‹ --&gt;&lt;header class=&quot;header&quot;&gt;  &lt;h1 class=&quot;header-title&quot;&gt;&lt;/h1&gt;&lt;/header&gt;</code></pre><p>ä½¿ç”¨å¸¸ç”¨çš„ class å‘½å</p><p><strong>åŒ…è£¹ç±»ï¼š</strong> container, wrapper, outer, inner, box, header, footer, main, content, aside, page, section, block</p><p><strong>çŠ¶æ€ç±»ï¼š</strong> primary, secondary, success, danger, warning, info, error, link, light, dark, disabled, active, checked, loading</p><p><strong>å°ºå¯¸ç±»ï¼š</strong> large, middle, small, bigger, smaller</p><p><strong>ç»„ä»¶ç±»ï¼š</strong> card, list, picture, carousel, swiper, menu, navs, badge, hint, modal, dialog</p><p><strong>ä½ç½®ç±»ï¼š</strong> first, last, current, prev, next, forward, back</p><p><strong>æ–‡æœ¬ç±»ï¼š</strong> title, desc, content, date, author, categoryï¼Œlabelï¼Œtag</p><p><strong>äººç‰©ç±»ï¼š</strong> avatar, name, age, post, intro</p><table><thead><tr><th align="left">Class Name</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">about</td><td align="left">å…³äº</td></tr><tr><td align="left">account</td><td align="left">è´¦æˆ·</td></tr><tr><td align="left">arrow</td><td align="left">ç®­å¤´å›¾æ ‡</td></tr><tr><td align="left">article</td><td align="left">æ–‡ç« </td></tr><tr><td align="left">aside</td><td align="left">è¾¹æ </td></tr><tr><td align="left">audio</td><td align="left">éŸ³é¢‘</td></tr><tr><td align="left">avatar</td><td align="left">å¤´åƒ</td></tr><tr><td align="left">bg,background</td><td align="left">èƒŒæ™¯</td></tr><tr><td align="left">bar</td><td align="left">æ ï¼ˆå·¥å…·ç±»ï¼‰</td></tr><tr><td align="left">branding</td><td align="left">å“ç‰ŒåŒ–</td></tr><tr><td align="left">crumb,breadcrumbs</td><td align="left">é¢åŒ…å±‘</td></tr><tr><td align="left">btn,button</td><td align="left">æŒ‰é’®</td></tr><tr><td align="left">caption</td><td align="left">æ ‡é¢˜ï¼Œè¯´æ˜</td></tr><tr><td align="left">category</td><td align="left">åˆ†ç±»</td></tr><tr><td align="left">chart</td><td align="left">å›¾è¡¨</td></tr><tr><td align="left">clearfix</td><td align="left">æ¸…é™¤æµ®åŠ¨</td></tr><tr><td align="left">close</td><td align="left">å…³é—­</td></tr><tr><td align="left">col,column</td><td align="left">åˆ—</td></tr><tr><td align="left">comment</td><td align="left">è¯„è®º</td></tr><tr><td align="left">community</td><td align="left">ç¤¾åŒº</td></tr><tr><td align="left">container</td><td align="left">å®¹å™¨</td></tr><tr><td align="left">content</td><td align="left">å†…å®¹</td></tr><tr><td align="left">copyright</td><td align="left">ç‰ˆæƒ</td></tr><tr><td align="left">current</td><td align="left">å½“å‰æ€ï¼Œé€‰ä¸­æ€</td></tr><tr><td align="left">default</td><td align="left">é»˜è®¤</td></tr><tr><td align="left">description</td><td align="left">æè¿°</td></tr><tr><td align="left">details</td><td align="left">ç»†èŠ‚</td></tr><tr><td align="left">disabled</td><td align="left">ä¸å¯ç”¨</td></tr><tr><td align="left">entry</td><td align="left">æ–‡ç« ï¼Œåšæ–‡</td></tr><tr><td align="left">error</td><td align="left">é”™è¯¯</td></tr><tr><td align="left">even</td><td align="left">å¶æ•°ï¼Œå¸¸ç”¨äºå¤šè¡Œåˆ—è¡¨æˆ–è¡¨æ ¼ä¸­</td></tr><tr><td align="left">fail</td><td align="left">å¤±è´¥ï¼ˆæç¤ºï¼‰</td></tr><tr><td align="left">feature</td><td align="left">ä¸“é¢˜</td></tr><tr><td align="left">fewer</td><td align="left">æ”¶èµ·</td></tr><tr><td align="left">field</td><td align="left">ç”¨äºè¡¨å•çš„è¾“å…¥åŒºåŸŸ</td></tr><tr><td align="left">figure</td><td align="left">å›¾</td></tr><tr><td align="left">filter</td><td align="left">ç­›é€‰</td></tr><tr><td align="left">first</td><td align="left">ç¬¬ä¸€ä¸ªï¼Œå¸¸ç”¨äºåˆ—è¡¨ä¸­</td></tr><tr><td align="left">footer</td><td align="left">é¡µè„š</td></tr><tr><td align="left">forum</td><td align="left">è®ºå›</td></tr><tr><td align="left">gallery</td><td align="left">ç”»å»Š</td></tr><tr><td align="left">group</td><td align="left">æ¨¡å—ï¼Œæ¸…é™¤æµ®åŠ¨</td></tr><tr><td align="left">header</td><td align="left">é¡µå¤´</td></tr><tr><td align="left">help</td><td align="left">å¸®åŠ©</td></tr><tr><td align="left">hide</td><td align="left">éšè—</td></tr><tr><td align="left">hightlight</td><td align="left">é«˜äº®</td></tr><tr><td align="left">home</td><td align="left">ä¸»é¡µ</td></tr><tr><td align="left">icon</td><td align="left">å›¾æ ‡</td></tr><tr><td align="left">info,information</td><td align="left">ä¿¡æ¯</td></tr><tr><td align="left">last</td><td align="left">æœ€åä¸€ä¸ªï¼Œå¸¸ç”¨äºåˆ—è¡¨ä¸­</td></tr><tr><td align="left">links</td><td align="left">é“¾æ¥</td></tr><tr><td align="left">login</td><td align="left">ç™»å½•</td></tr><tr><td align="left">logout</td><td align="left">é€€å‡º</td></tr><tr><td align="left">logo</td><td align="left">æ ‡å¿—</td></tr><tr><td align="left">main</td><td align="left">ä¸»ä½“</td></tr><tr><td align="left">menu</td><td align="left">èœå•</td></tr><tr><td align="left">meta</td><td align="left">ä½œè€…ã€æ›´æ–°æ—¶é—´ç­‰ä¿¡æ¯æ ï¼Œä¸€èˆ¬ä½äºæ ‡é¢˜ä¹‹ä¸‹</td></tr><tr><td align="left">module</td><td align="left">æ¨¡å—</td></tr><tr><td align="left">more</td><td align="left">æ›´å¤šï¼ˆå±•å¼€ï¼‰</td></tr><tr><td align="left">msg,message</td><td align="left">æ¶ˆæ¯</td></tr><tr><td align="left">nav,navigation</td><td align="left">å¯¼èˆª</td></tr><tr><td align="left">next</td><td align="left">ä¸‹ä¸€é¡µ</td></tr><tr><td align="left">nub</td><td align="left">å°å—</td></tr><tr><td align="left">odd</td><td align="left">å¥‡æ•°ï¼Œå¸¸ç”¨äºå¤šè¡Œåˆ—è¡¨æˆ–è¡¨æ ¼ä¸­</td></tr><tr><td align="left">off</td><td align="left">é¼ æ ‡ç¦»å¼€</td></tr><tr><td align="left">on</td><td align="left">é¼ æ ‡ç§»è¿‡</td></tr><tr><td align="left">output</td><td align="left">è¾“å‡º</td></tr><tr><td align="left">pagination</td><td align="left">åˆ†é¡µ</td></tr><tr><td align="left">pop,popup</td><td align="left">å¼¹çª—</td></tr><tr><td align="left">preview</td><td align="left">é¢„è§ˆ</td></tr><tr><td align="left">previous</td><td align="left">ä¸Šä¸€é¡µ</td></tr><tr><td align="left">primary</td><td align="left">ä¸»è¦</td></tr><tr><td align="left">progress</td><td align="left">è¿›åº¦æ¡</td></tr><tr><td align="left">promotion</td><td align="left">ä¿ƒé”€</td></tr><tr><td align="left">rcommd,recommendations</td><td align="left">æ¨è</td></tr><tr><td align="left">reg,register</td><td align="left">æ³¨å†Œ</td></tr><tr><td align="left">save</td><td align="left">ä¿å­˜</td></tr><tr><td align="left">search</td><td align="left">æœç´¢</td></tr><tr><td align="left">secondary</td><td align="left">æ¬¡è¦</td></tr><tr><td align="left">section</td><td align="left">åŒºå—</td></tr><tr><td align="left">selected</td><td align="left">å·²é€‰</td></tr><tr><td align="left">share</td><td align="left">åˆ†äº«</td></tr><tr><td align="left">show</td><td align="left">æ˜¾ç¤º</td></tr><tr><td align="left">sidebar</td><td align="left">è¾¹æ ï¼Œä¾§æ </td></tr><tr><td align="left">slide</td><td align="left">å¹»ç¯ç‰‡ï¼Œå›¾ç‰‡åˆ‡æ¢</td></tr><tr><td align="left">sort</td><td align="left">æ’åº</td></tr><tr><td align="left">sub</td><td align="left">æ¬¡çº§çš„ï¼Œå­çº§çš„</td></tr><tr><td align="left">submit</td><td align="left">æäº¤</td></tr><tr><td align="left">subscribe</td><td align="left">è®¢é˜…</td></tr><tr><td align="left">subtitle</td><td align="left">å‰¯æ ‡é¢˜</td></tr><tr><td align="left">success</td><td align="left">æˆåŠŸï¼ˆæç¤ºï¼‰</td></tr><tr><td align="left">summary</td><td align="left">æ‘˜è¦</td></tr><tr><td align="left">tab</td><td align="left">æ ‡ç­¾é¡µ</td></tr><tr><td align="left">table</td><td align="left">è¡¨æ ¼</td></tr><tr><td align="left">txt,text</td><td align="left">æ–‡æœ¬</td></tr><tr><td align="left">thumbnail</td><td align="left">ç¼©ç•¥å›¾</td></tr><tr><td align="left">time</td><td align="left">æ—¶é—´</td></tr><tr><td align="left">tips</td><td align="left">æç¤º</td></tr><tr><td align="left">title</td><td align="left">æ ‡é¢˜</td></tr><tr><td align="left">video</td><td align="left">è§†é¢‘</td></tr><tr><td align="left">wrap</td><td align="left">å®¹å™¨ï¼ŒåŒ…ï¼Œä¸€èˆ¬ç”¨äºæœ€å¤–å±‚</td></tr><tr><td align="left">wrapper</td><td align="left">å®¹å™¨ï¼ŒåŒ…ï¼Œä¸€èˆ¬ç”¨äºæœ€å¤–å±‚</td></tr></tbody></table><p>ä¸ä½¿ç”¨ ID é€‰æ‹©å™¨</p><pre><code class="css">// bad#title {  color: blue;}// good.title {  color: blue;}</code></pre><p>ä¸è¦ä¸º <code>0</code> å€¼è®¾ç½®å•ä½</p><pre><code class="css">// bad.content {  margin-top: 0px;}// good.content {  margin-top: 0;}</code></pre><p>éµå¾ªä»¥ä¸‹çš„æ ·å¼ä¹¦å†™é¡ºåº</p><ol><li>å¸ƒå±€å®šä½å±æ€§ï¼šposition / display / float / clear / visibility / overflow</li><li>ç›’å±æ€§ï¼šwidth / height / margin / padding / border / background</li><li>æ–‡æœ¬å±æ€§ï¼šcolor / font / text-decoration / text-align / vertical-align / white- space / break-word</li><li>è§†è§‰å±æ€§ï¼šbackground-color / border / border-radius / box-shadow</li><li>å…¶ä»–å±æ€§ï¼šcontent / cursor / text-shadow / background:linear-gradient</li></ol><pre><code class="css">.box {  /* Positioning */  position: absolute;  top: 0;  right: 0;  bottom: 0;  left: 0;  z-index: 100;  /* Box-model */  display: block;  float: right;  width: 100px;  height: 100px;  /* Typography */  font: normal 13px &#39;Helvetica Neue&#39;, sans-serif;  line-height: 1.5;  color: #333;  text-align: center;  /* Visual */  background-color: #f5f5f5;  border: 1px solid #e5e5e5;  border-radius: 3px;  /* Misc */  opacity: 1;}</code></pre><p>åµŒå¥—é€‰æ‹©å™¨çš„æ·±åº¦ä¸è¦è¶…è¿‡ 3 å±‚</p><pre><code class="css">.container {  .content {    .profile {      /* STOP! */    }  }}</code></pre><p>ä¸è¦ä½¿ç”¨ <code>@import</code></p><pre><code class="html">/* bad */ @import url(&quot;other.css&quot;); /* good */&lt;link rel=&quot;stylesheet&quot; href=&quot;other.css&quot; /&gt;</code></pre><p>å°†åª’ä½“æŸ¥è¯¢è¯­å¥æ”¾åœ¨é è¿‘ç›¸å…³è§„åˆ™æœ€è¿‘çš„ä½ç½®</p><pre><code class="css">.element {  /* ... */}.element-avatar {  /* ... */}.element-selected {  /* ... */}@media (min-width: 480px) {  .element {    /* ... */  }  .element-avatar {    /* ... */  }  .element-selected {    /* ... */  }}</code></pre><p>ä½¿ç”¨ç®€çŸ­çš„ç”³æ˜è¯­å¥</p><pre><code class="css">// bad.content {  padding-top: 10px;  padding-bottom: 10px;  padding-left: 20px;  padding-right: 20px;}// good.content {  padding: 10px 20px;}</code></pre><p>ä½¿ç”¨ stylelint æ£€æŸ¥æ ·å¼ä»£ç </p><p><a href="https://github.com/shinnn/vscode-stylelint" target="_blank" rel="noopener">https://github.com/shinnn/vscode-stylelint</a></p><h2 id="JS-è§„èŒƒ"><a href="#JS-è§„èŒƒ" class="headerlink" title="JS è§„èŒƒ"></a>JS è§„èŒƒ</h2><p>ä½¿ç”¨ const ä¼˜äº letï¼Œå¼ƒç”¨ var</p><pre><code class="javascript">// badvar name = &#39;jack&#39;let myVariable = &#39;myVariable&#39;// goodconst FIRST_US_PRESIDENT = &#39;George Washington&#39;</code></pre><p>ä½¿ç”¨å­—é¢é‡åˆ›å»ºå¯¹è±¡</p><pre><code class="javascript">// badconst a = new Object{}// goodconst obj = {}</code></pre><p>å‡½æ•°åæˆ–æ–¹æ³•åä½¿ç”¨åŠ¨å®¾çŸ­è¯­</p><pre><code class="javascript">// badfunction userInfo() {    ...}// goodfunction getUserInfo() {    ...}</code></pre><p>å‘½åæ‰€æœ‰çš„æ–¹æ³•åŒ…å«é—­åŒ…å’Œå›è°ƒ, é¿å…åŒ¿åæ–¹æ³•</p><p>å‘½åæ–¹æ³•å’Œå‡½æ•°å¯ä»¥è®©ä½ åœ¨ä»£ç è¿è¡Œå‡ºé”™æ—¶æ›´å¿«çš„æ‰¾åˆ°é”™è¯¯</p><p>å¸ƒå°”å€¼å˜é‡ä½¿ç”¨ is å¼€å¤´çš„è¯ç»„</p><pre><code class="javascript">// badconst finished = false// goodconst isFinished = false</code></pre><p>é¿å…é‡å¤çš„æè¿°å¯¹è±¡</p><pre><code class="javascript">// badconst car = {  carMake: &#39;Honda&#39;,  carModel: &#39;Accord&#39;,  carColor: &#39;Blue&#39;}// goodconst Car = {  make: &#39;Honda&#39;,  model: &#39;Accord&#39;,  color: &#39;Blue&#39;}</code></pre><p>ä½¿ç”¨æœ‰æ„ä¹‰å¯è¯»æ€§å¥½çš„å˜é‡å</p><pre><code class="javascript">// badconst yyyymmdstr = moment().format(&#39;YYYY/MM/DD&#39;)for (var i = 0; i &lt; 525600; i++) {  runCronJob()}// goodconst yearMonthDay = moment().format(&#39;YYYY/MM/DD&#39;)const MINUTES_IN_A_YEAR = 525600for (var i = 0; i &lt; MINUTES_IN_A_YEAR; i++) {  runCronJob()}</code></pre><p>å°†å‡½æ•°å‚æ•°é™åˆ¶ 2 ä¸ªä»¥å†…</p><pre><code class="javascript">// badfunction createMenu(title, body, buttonText, cancellable) {  ...}// goodconst menuConfig = {  title: &#39;Foo&#39;,  body: &#39;Bar&#39;,  buttonText: &#39;Baz&#39;,  cancellable: true}function createMenu(menuConfig) {  ...}</code></pre><p>å°è£…åˆ¤æ–­æ¡ä»¶</p><p>å°†å¤šä¸ªæ¡ä»¶çš„åˆ¤æ–­ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æˆ–ä½¿ç”¨ä¸€ä¸ªå‡½æ•°è¿”å›</p><pre><code class="javascript">// badif (fsm.state === &#39;fetching&#39; &amp;&amp; isEmpty(listNode)) {  /// ...}// goodfunction shouldShowSpinner(fsm, listNode) {  return fsm.state === &#39;fetching&#39; &amp;&amp; isEmpty(listNode)}if (shouldShowSpinner(fsmInstance, listNodeInstance)) {  // ...}</code></pre><p>é¿å…å¦å®šæƒ…å†µçš„åˆ¤æ–­</p><p>å°½å¯èƒ½åªä½¿ç”¨æ­£å‘çš„åˆ¤æ–­</p><pre><code class="javascript">// badif(!isLoading) {  ...}// goodif(isLoading) {  ...}</code></pre><p>åˆ é™¤æ— æ•ˆçš„ä»£ç </p><p>åŠæ—¶åˆ é™¤ä¸å†è¢«è°ƒç”¨çš„ä»£ç ï¼Œé¿å…ç»™é˜…è¯»ä»£ç å¸¦æ¥å›°æ‰°</p><p>ä½¿ç”¨ <code>try/catch</code> è¯­å¥æ•è·å¯èƒ½å‡ºç°çš„é”™è¯¯</p><pre><code class="js">try {  functionThatMightThrow()} catch (error) {  // ä¸å•å•åªæ˜¯ä½¿ç”¨ console  console.error(error)  // æ›´å¤šçš„é”™è¯¯å¤„ç†  notifyUserOfError(error)  // æŠ¥å‘Šé”™è¯¯  reportErrorToService(error)}</code></pre><p>åªæ³¨é‡Šä¸šåŠ¡é€»è¾‘å¤æ‚æ€§çš„ä»£ç </p><pre><code class="js">function hashIt(data) {  var hash = 0  var length = data.length  for (var i = 0; i &lt; length; i++) {    var char = data.charCodeAt(i)    hash = (hash &lt;&lt; 5) - hash + char    // Convert to 32-bit integer    hash = hash &amp; hash  }}</code></pre><h2 id="Vue-è§„èŒƒ"><a href="#Vue-è§„èŒƒ" class="headerlink" title="Vue è§„èŒƒ"></a>Vue è§„èŒƒ</h2><p>å°†ç»„ä»¶åå‘½åä¸ºå¤šä¸ªå•è¯</p><pre><code class="json">// badtodo.vue// goodtodo-item.vue</code></pre><p>ä½¿ç”¨ PascalCase æˆ–è€… kebab-case å‘½åç»„ä»¶</p><pre><code class="html">&lt;!-- bad  --&gt;components/ |- mycomponent.vue components/ |- myComponent.vue&lt;!-- good --&gt;components/ |- MyComponent.vue components/ |- my-component.vue</code></pre><p>è¯¦ç»†å®šä¹‰ç»„ä»¶çš„ Prop</p><pre><code class="javascript">// badprops: [&#39;status&#39;]// goodprops: {   status: {    type: String,    required: true  }}</code></pre><p>åœ¨ v-for å¾ªç¯ä¸ŠåŠ  key</p><pre><code class="html">&lt;!-- bad --&gt;&lt;li v-for=&quot;todo in todos&quot;&gt;  {{ todo.text }}&lt;/li&gt;&lt;!-- good --&gt;&lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;  {{ todo.text }}&lt;/li&gt;</code></pre><p>ä¸è¦æŠŠ v-if å’Œ v-for åŒæ—¶ç”¨åœ¨åŒä¸€ä¸ªå…ƒç´ ä¸Š</p><pre><code class="html">&lt;!-- bad --&gt;&lt;ul&gt;  &lt;li v-for=&quot;user in users&quot; v-if=&quot;shouldShowUsers&quot; :key=&quot;user.id&quot;&gt;    {{ user.name }}  &lt;/li&gt;&lt;/ul&gt;&lt;!-- good --&gt;&lt;ul v-if=&quot;shouldShowUsers&quot;&gt;  &lt;li v-for=&quot;user in users&quot; :key=&quot;user.id&quot;&gt;    {{ user.name }}  &lt;/li&gt;&lt;/ul&gt;</code></pre><p>ä¸ºç»„ä»¶æ ·å¼è®¾ç½®ä½œç”¨åŸŸ</p><pre><code class="html">&lt;!-- bad --&gt;&lt;template&gt;  &lt;button class=&quot;btn btn-close&quot;&gt;X&lt;/button&gt;&lt;/template&gt;&lt;style&gt;  .btn-close {    background-color: red;  }&lt;/style&gt;&lt;!--  good --&gt;&lt;template&gt;  &lt;button class=&quot;c-button c-button--close&quot;&gt;X&lt;/button&gt;&lt;/template&gt;&lt;!-- ä½¿ç”¨ BEM çº¦å®š --&gt;&lt;style&gt;  .c-button {    border: none;    border-radius: 2px;  }  .c-button--close {    background-color: red;  }&lt;/style&gt;</code></pre><p><strong>ç»„ä»¶å’Œå®ä¾‹çš„é€‰é¡¹ä½¿ç”¨ç»Ÿä¸€çš„é¡ºåº</strong></p><ol><li><strong>å‰¯ä½œç”¨</strong>(è§¦å‘ç»„ä»¶å¤–çš„å½±å“)</li></ol><ul><li><code>el</code></li></ul><ol start="2"><li><strong>å…¨å±€æ„ŸçŸ¥</strong>(è¦æ±‚ç»„ä»¶ä»¥å¤–çš„çŸ¥è¯†)</li></ol><ul><li><code>name</code></li><li><code>parent</code></li></ul><ol start="3"><li><strong>ç»„ä»¶ç±»å‹</strong>(æ›´æ”¹ç»„ä»¶çš„ç±»å‹)</li></ol><ul><li><code>functional</code></li></ul><ol start="4"><li><strong>æ¨¡æ¿ä¿®æ”¹å™¨</strong>(æ”¹å˜æ¨¡æ¿çš„ç¼–è¯‘æ–¹å¼)</li></ol><ul><li><code>delimiters</code></li><li><code>comments</code></li></ul><ol start="5"><li><strong>æ¨¡æ¿ä¾èµ–</strong>(æ¨¡æ¿å†…ä½¿ç”¨çš„èµ„æº)</li></ol><ul><li><code>components</code></li><li><code>directives</code></li><li><code>filters</code></li></ul><ol start="6"><li><strong>ç»„åˆ</strong>(å‘é€‰é¡¹é‡Œåˆå¹¶å±æ€§)</li></ol><ul><li><code>extends</code></li><li><code>mixins</code></li></ul><ol start="7"><li><strong>æ¥å£</strong>(ç»„ä»¶çš„æ¥å£)</li></ol><ul><li><code>inheritAttrs</code></li><li><code>model</code></li><li><code>props</code>/<code>propsData</code></li></ul><ol start="8"><li><strong>æœ¬åœ°çŠ¶æ€</strong>(æœ¬åœ°çš„å“åº”å¼å±æ€§)</li></ol><ul><li><code>data</code></li><li><code>computed</code></li></ul><ol start="9"><li><strong>äº‹ä»¶</strong>(é€šè¿‡å“åº”å¼äº‹ä»¶è§¦å‘çš„å›è°ƒ)</li></ol><ul><li><code>watch</code></li><li>ç”Ÿå‘½å‘¨æœŸé’©å­ (æŒ‰ç…§å®ƒä»¬è¢«è°ƒç”¨çš„é¡ºåº)<ul><li><code>beforeCreate</code></li><li><code>created</code></li><li><code>beforeMount</code></li><li><code>mounted</code></li><li><code>beforeUpdate</code></li><li><code>updated</code></li><li><code>activated</code></li><li><code>deactivated</code></li><li><code>beforeDestroy</code></li><li><code>destroyed</code></li></ul></li></ul><ol start="10"><li><strong>éå“åº”å¼çš„å±æ€§</strong>(ä¸ä¾èµ–å“åº”ç³»ç»Ÿçš„å®ä¾‹å±æ€§)</li></ol><ul><li><code>methods</code></li></ul><ol start="11"><li><strong>æ¸²æŸ“</strong>(ç»„ä»¶è¾“å‡ºçš„å£°æ˜å¼æè¿°)</li></ol><ul><li><code>template</code>/<code>render</code></li><li><code>renderError</code></li></ul><p><strong>å…ƒç´ å’Œç»„ä»¶çš„ç‰¹æ€§ä½¿ç”¨ç»Ÿä¸€çš„é¡ºåº</strong></p><ol><li><strong>å®šä¹‰</strong>(æä¾›ç»„ä»¶çš„é€‰é¡¹)</li></ol><ul><li><code>is</code></li></ul><ol start="2"><li><strong>åˆ—è¡¨æ¸²æŸ“</strong>(åˆ›å»ºå¤šä¸ªå˜åŒ–çš„ç›¸åŒå…ƒç´ )</li></ol><ul><li><code>v-for</code></li></ul><ol start="3"><li><strong>æ¡ä»¶æ¸²æŸ“</strong>(å…ƒç´ æ˜¯å¦æ¸²æŸ“/æ˜¾ç¤º)</li></ol><ul><li><code>v-if</code></li><li><code>v-else-if</code></li><li><code>v-else</code></li><li><code>v-show</code></li><li><code>v-cloak</code></li></ul><ol start="4"><li><strong>æ¸²æŸ“æ–¹å¼</strong>(æ”¹å˜å…ƒç´ çš„æ¸²æŸ“æ–¹å¼)</li></ol><ul><li><code>v-pre</code></li><li><code>v-once</code></li></ul><ol start="5"><li><strong>å…¨å±€æ„ŸçŸ¥</strong>(éœ€è¦è¶…è¶Šç»„ä»¶çš„çŸ¥è¯†)</li></ol><ul><li><code>id</code></li></ul><ol start="6"><li><strong>å”¯ä¸€çš„ç‰¹æ€§</strong>(éœ€è¦å”¯ä¸€å€¼çš„ç‰¹æ€§)</li></ol><ul><li><code>ref</code></li><li><code>key</code></li><li><code>slot</code></li></ul><ol start="7"><li><strong>åŒå‘ç»‘å®š</strong>(æŠŠç»‘å®šå’Œäº‹ä»¶ç»“åˆèµ·æ¥)</li></ol><ul><li><code>v-model</code></li></ul><ol start="8"><li><strong>å…¶å®ƒç‰¹æ€§</strong> (æ‰€æœ‰æ™®é€šçš„ç»‘å®šæˆ–æœªç»‘å®šçš„ç‰¹æ€§)<br></li><li><strong>äº‹ä»¶</strong>(ç»„ä»¶äº‹ä»¶ç›‘å¬å™¨)</li></ol><ul><li><code>v-on</code></li></ul><ol start="10"><li><strong>å†…å®¹</strong>(è¦†å†™å…ƒç´ çš„å†…å®¹)</li></ol><ul><li><code>v-html</code></li><li><code>v-text</code></li></ul><p>ä¿è¯ä¸€ä¸ªç»„ä»¶ä¸“æ³¨äºè§£å†³ä¸€ä¸ªé—®é¢˜</p><p>ç¡®ä¿ä¸€ä¸ªç»„ä»¶æ˜¯ç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„ã€å¾®å°çš„å’Œå¯æµ‹è¯•çš„</p><p>å°†è¡Œå†…è¡¨è¾¾å¼è½¬ä¸º computed</p><pre><code class="html">// bad&lt;template&gt;  &lt;h1&gt;    {{ (new Date()).getUTCFullYear() }}  &lt;/h1&gt;&lt;/template&gt;// good&lt;template&gt;  &lt;h1&gt;    {{ year }}  &lt;/h1&gt;&lt;/template&gt;&lt;script type=&quot;text/javascript&quot;&gt;  export default {    computed: {      year() {        return new Date().getUTCFullYear()      }    }  }&lt;/script&gt;</code></pre><p>å°½å¯èƒ½ä½¿ç”¨ mixins</p><p>Mixins å°è£…å¯é‡ç”¨çš„ä»£ç ï¼Œé¿å…äº†é‡å¤ã€‚å¦‚æœä¸¤ä¸ªç»„ä»¶å…±äº«æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ mixin</p><pre><code class="javascript">const HelloMixin = {    methods: {      hello() {        console.log(&#39;hello&#39;)    }  }}// CompA&lt;script&gt;  import HelloMixin from &#39;./HelloMixin&#39;  export default {    name: &#39;CompA&#39;,    mixins: [HelloMixin]  }&lt;/script&gt;// CompB&lt;script&gt;  import HelloMixin from &#39;./HelloMixin&#39;  export default {    name: &#39;CompB&#39;,    mixins: [HelloMixin]  }&lt;/script&gt;</code></pre><h2 id="Node-è§„èŒƒ"><a href="#Node-è§„èŒƒ" class="headerlink" title="Node è§„èŒƒ"></a>Node è§„èŒƒ</h2><p>require æ–‡ä»¶å¤¹ï¼Œè€Œä¸æ˜¯æ–‡ä»¶</p><p>åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­å¼€å‘åº“/æ¨¡å—ï¼Œæ”¾ç½®ä¸€ä¸ªæ–‡ä»¶ index.js æš´éœ²æ¨¡å—çš„å†…éƒ¨</p><p>ä½¿ç”¨ .npmrc é”ä½ä¾èµ–ç‰ˆæœ¬</p><p>ä»£ç å¿…é¡»åœ¨æ‰€æœ‰çš„ç¯å¢ƒä¸­æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ Npm é»˜è®¤æƒ…å†µä¸‹ä¼šæ‹¿åŒ…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œé…ç½® .npmrc é”å®šä¾èµ–ç‰ˆæœ¬</p><pre><code class="basic">save-exact=true</code></pre><p>åœ¨ Node å¤–ç®¡ç†å‰ç«¯èµ„æº</p><p>ä½¿ç”¨ä¸“é—¨çš„ä¸­é—´ä»¶ï¼ˆnginxï¼ŒS3ï¼ŒCDNï¼‰æœåŠ¡å‰ç«¯å†…å®¹ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å¤„ç†å¤§é‡é™æ€æ–‡ä»¶çš„æ—¶å€™ï¼Œç”±äº node çš„å•çº¿ç¨‹æ¨¡å‹ï¼Œå®ƒçš„æ€§èƒ½å¾ˆå—å½±å“</p><p>ä½¿ç”¨ä¸­é—´ä»¶é™åˆ¶å¹¶å‘è¯·æ±‚</p><p>DOS æ”»å‡»éå¸¸æµè¡Œè€Œä¸”ç›¸å¯¹å®¹æ˜“å¤„ç†ã€‚ä½¿ç”¨å¤–éƒ¨æœåŠ¡ï¼Œæ¯”å¦‚ cloud è´Ÿè½½å‡è¡¡, cloud é˜²ç«å¢™, nginx, æˆ–è€…ï¼ˆå¯¹äºå°çš„ï¼Œä¸æ˜¯é‚£ä¹ˆé‡è¦çš„ appï¼‰ä¸€ä¸ªé€Ÿç‡é™åˆ¶ä¸­é—´ä»¶(æ¯”å¦‚<a href="https://www.npmjs.com/package/express-rate-limit" target="_blank" rel="noopener">express-rate-limit</a>)ï¼Œæ¥å®ç°é€Ÿç‡é™åˆ¶ã€‚å¦åˆ™åº”ç”¨ç¨‹åºå¯èƒ½å—åˆ°æ”»å‡», å¯¼è‡´æ‹’ç»æœåŠ¡, åœ¨è¿™ç§æƒ…å†µä¸‹, çœŸå®ç”¨æˆ·ä¼šé­å—æœåŠ¡é™çº§æˆ–ä¸å¯ç”¨ã€‚</p><p>éªŒè¯ä¼ å…¥çš„ JSON schemas</p><p>éªŒè¯ä¼ å…¥è¯·æ±‚çš„ body payloadï¼Œå¹¶ç¡®ä¿å…¶ç¬¦åˆé¢„æœŸè¦æ±‚, å¦‚æœæ²¡æœ‰, åˆ™å¿«é€ŸæŠ¥é”™ã€‚ä¸ºäº†é¿å…æ¯ä¸ªè·¯ç”±ä¸­ç¹ççš„éªŒè¯ç¼–ç , æ‚¨å¯ä»¥ä½¿ç”¨åŸºäº JSON çš„è½»é‡çº§éªŒè¯æ¶æ„ï¼Œæ¯”å¦‚ <a href="https://www.npmjs.com/package/jsonschema" target="_blank" rel="noopener">jsonschema</a> or <a href="https://www.npmjs.com/package/joi" target="_blank" rel="noopener">joi</a>ï¼Œå¦åˆ™æ‚¨ç–å¿½å’Œå®½æ¾çš„æ–¹æ³•å¤§å¤§å¢åŠ äº†æ”»å‡»é¢, å¹¶é¼“åŠ±æ”»å‡»è€…å°è¯•è®¸å¤šè¾“å…¥, ç›´åˆ°ä»–ä»¬æ‰¾åˆ°ä¸€äº›ç»„åˆ, ä½¿åº”ç”¨ç¨‹åºå´©æºƒã€‚</p><p>ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ Node.js</p><p>Node.js ä½œä¸ºä¸€ä¸ªå…·æœ‰æ— é™æƒé™çš„ root ç”¨æˆ·è¿è¡Œï¼Œè¿™æ˜¯ä¸€ç§æ™®éçš„æƒ…æ™¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œè¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚å»ºè®®åˆ›å»ºä¸€ä¸ªé root ç”¨æˆ·ï¼Œå¹¶ä¿å­˜åˆ° Docker é•œåƒä¸­ï¼ˆä¸‹é¢ç»™å‡ºäº†ç¤ºä¾‹ï¼‰ï¼Œæˆ–è€…é€šè¿‡è°ƒç”¨å¸¦æœ‰â€-u usernameâ€ çš„å®¹å™¨æ¥ä»£è¡¨æ­¤ç”¨æˆ·è¿è¡Œè¯¥è¿›ç¨‹ï¼Œå¦åˆ™åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œè„šæœ¬çš„æ”»å‡»è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè·å¾—æ— é™åˆ¶çš„æƒåˆ© (ä¾‹å¦‚ï¼Œæ”¹å˜ iptableï¼Œå¼•æµåˆ°ä»–çš„æœåŠ¡å™¨ä¸Š)</p><h2 id="å…¶å®ƒè§„èŒƒ"><a href="#å…¶å®ƒè§„èŒƒ" class="headerlink" title="å…¶å®ƒè§„èŒƒ"></a>å…¶å®ƒè§„èŒƒ</h2><p>ä½¿ç”¨ jest è¿›è¡Œå•å…ƒæµ‹è¯•</p><p>é€šå¸¸åªè¦æ±‚å¯¹ä¸€äº›åŸºç¡€/åº•å±‚çš„ç»„ä»¶ã€å‡½æ•°è¿›è¡Œæµ‹è¯•, è§†æƒ…å†µè€ƒè™‘æ˜¯å¦è¦æµ‹è¯•ä¸šåŠ¡ä»£ç </p><p>ä½¿ç”¨ <a href="https://link.juejin.im/?target=https%3A%2F%2Fprettier.io">Prettier</a> æ ¼å¼åŒ–ä»£ç </p><p><br>æ‰€æœ‰ä»£ç æ ¼å¼ç›¸å…³çš„å·¥ä½œéƒ½å¯ä»¥äº¤ç»™ Prettier æ¥åš</p><p>åˆç†çš„å›¾ç‰‡å‘½å</p><p>å›¾ç‰‡ä¸šåŠ¡ + å›¾ç‰‡åŠŸèƒ½ç±»åˆ« + å›¾ç‰‡æ¨¡å—åç§° + å›¾ç‰‡ç²¾åº¦</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://codeguide.co" target="_blank" rel="noopener">Code Guide</a></li><li><a href="https://guide.aotu.io/" target="_blank" rel="noopener">O2 å‰ç«¯è§„èŒƒæ–‡æ¡£</a></li><li><a href="https://github.com/alivebao/clean-code-js" target="_blank" rel="noopener">JavaScript é£æ ¼æŒ‡å—</a></li><li><a href="https://cn.vuejs.org/v2/style-guide/" target="_blank" rel="noopener">Vue é£æ ¼æŒ‡å—</a></li><li><a href="https://github.com/pablohpsilva/vuejs-component-style-guide/blob/master/README-CN.md" target="_blank" rel="noopener">Vue.js ç»„ä»¶ç¼–ç è§„èŒƒ</a></li><li><a href="https://github.com/goldbergyoni/nodebestpractices/blob/master/README.chinese.md" target="_blank" rel="noopener">Node.js æœ€ä½³å®è·µ</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è‰¯å¥½çš„ä»£ç è§„èŒƒæœ‰åˆ©äºæé«˜é¡¹ç›®å¼€å‘æ•ˆç‡ä»¥åŠå‡å°‘é˜…è¯»ä»£ç çš„å›°éš¾ï¼Œæœ¬è§„èŒƒç»“åˆäº†(chaoxi)å¤šä¸ªæµè¡Œçš„ä»£ç è§„èŒƒä»¥åŠå‰äººçš„å¼€å‘ç»éªŒè€Œæˆï¼Œå‚è€ƒè§„èŒƒè¿›è¡Œå¼€å‘æé«˜ä»£ç è´¨é‡&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Standard" scheme="https://coldstone.fun/tags/Standard/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–</title>
    <link href="https://coldstone.fun/post/2019/10/05/js-intl/"/>
    <id>https://coldstone.fun/post/2019/10/05/js-intl/</id>
    <published>2019-10-05T04:04:00.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>å¹³æ—¶é¡¹ç›®ä¸­è¦å¯¹æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–é€šå¸¸ä¼šä½¿ç”¨å¦‚ <a href="https://github.com/iamkun/dayjs" target="_blank" rel="noopener">dayjs</a>ï¼Œ<a href="https://github.com/date-fns/date-fns" target="_blank" rel="noopener">date-fns</a>ï¼Œ<a href="https://github.com/moment/moment" target="_blank" rel="noopener">moment</a> è¿™äº›ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½åªéœ€è¦æŸå‡ ä¸ªæ–¹æ³•ï¼Œå´å®‰è£…äº†ä¸€æ•´ä¸ªåº“ï¼Œå¤§å¤§å¢åŠ äº†é¡¹ç›®çš„ä½“ç§¯ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« çš„æ•°æ® <a href="https://github.com/you-dont-need/You-Dont-Need-Momentjs" target="_blank" rel="noopener">You-Dont-Need-Momentjs</a>ã€‚æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¹³æ—¶é¡¹ç›®ä¸­è¦å¯¹æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–é€šå¸¸ä¼šä½¿ç”¨å¦‚ <a href="https://github.com/iamkun/dayjs" target="_blank" rel="noopener">dayjs</a>ï¼Œ<a href="https://github.com/date-fns/date-fns" target="_blank" rel="noopener">date-fns</a>ï¼Œ<a href="https://github.com/moment/moment" target="_blank" rel="noopener">moment</a> è¿™äº›ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½åªéœ€è¦æŸå‡ ä¸ªæ–¹æ³•ï¼Œå´å®‰è£…äº†ä¸€æ•´ä¸ªåº“ï¼Œå¤§å¤§å¢åŠ äº†é¡¹ç›®çš„ä½“ç§¯ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« çš„æ•°æ® <a href="https://github.com/you-dont-need/You-Dont-Need-Momentjs" target="_blank" rel="noopener">You-Dont-Need-Momentjs</a>ã€‚æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl" target="_blank" rel="noopener">MDN</a></p><blockquote><p>Intl å¯¹è±¡æ˜¯ ECMAScript å›½é™…åŒ– API çš„ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå®ƒæä¾›äº†ç²¾ç¡®çš„å­—ç¬¦ä¸²å¯¹æ¯”ã€æ•°å­—æ ¼å¼åŒ–ï¼Œå’Œæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–ã€‚Collatorï¼ŒNumberFormat å’Œ DateTimeFormat å¯¹è±¡çš„æ„é€ å‡½æ•°æ˜¯ Intl å¯¹è±¡çš„å±æ€§ã€‚æœ¬é¡µæ–‡æ¡£å†…å®¹åŒ…æ‹¬äº†è¿™äº›å±æ€§ï¼Œä»¥åŠå›½é™…åŒ–ä½¿ç”¨çš„æ„é€ å™¨å’Œå…¶ä»–è¯­è¨€çš„æ–¹æ³•ç­‰å¸¸è§çš„åŠŸèƒ½ã€‚</p></blockquote><h2 id="æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–"><a href="#æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–" class="headerlink" title="æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–"></a>æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–</h2><p>è¦å¯¹æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–å°±è¦ä½¿ç”¨ <code>Intl.DateTimeFormat</code> å¯¹è±¡ï¼Œå®ƒæ˜¯æ ¹æ®è¯­è¨€æ¥æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´çš„æ„é€ å‡½æ•°ã€‚</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯­è¨€ä»£ç ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ„é€ å‡½æ•°çš„é€‰é¡¹ï¼Œéƒ½æ˜¯å¯é€‰çš„</p><pre><code class="js">new Intl.DateTimeFormat([locales[, options]])</code></pre><h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><pre><code class="js">const date = new Date()console.log(new Intl.DateTimeFormat(&#39;en-US&#39;).format(date))// &quot;10/8/2019&quot;console.log(new Intl.DateTimeFormat(&#39;zh-CN&#39;).format(date))// &quot;2019/10/8&quot;console.log(  new Intl.DateTimeFormat(&#39;zh-CN&#39;, {    year: &#39;numeric&#39;,    month: &#39;numeric&#39;,    day: &#39;numeric&#39;,    weekday: &#39;long&#39;,    hour: &#39;numeric&#39;,    minute: &#39;numeric&#39;,    second: &#39;numeric&#39;,    hour12: false  }).format(date))// &quot;2019å¹´10æœˆ8æ—¥æ˜ŸæœŸäºŒ 15:07:04&quot;</code></pre><h3 id="è¯¦ç»†ä½¿ç”¨"><a href="#è¯¦ç»†ä½¿ç”¨" class="headerlink" title="è¯¦ç»†ä½¿ç”¨"></a>è¯¦ç»†ä½¿ç”¨</h3><p>å‚è€ƒæ–‡æ¡£ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/DateTimeFormat" target="_blank" rel="noopener">Intl.DateTimeFormat</a></p><h2 id="ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–"><a href="#ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–" class="headerlink" title="ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–"></a>ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–</h2><p>ä½¿ç”¨ Intl.RelativeTimeFormat å¯¹ç›¸å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–</p><h3 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>åŒä¸Šï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯­è¨€ä»£ç ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ„é€ å‡½æ•°çš„é€‰é¡¹ï¼Œéƒ½æ˜¯å¯é€‰çš„</p><pre><code class="js">new Intl.RelativeTimeFormat([locales[, options]])</code></pre><h3 id="ç®€å•ä½¿ç”¨-1"><a href="#ç®€å•ä½¿ç”¨-1" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><pre><code class="js">const rtf = new Intl.RelativeTimeFormat(&#39;zh-CN&#39;)console.log(rtf.format(-3, &#39;day&#39;))// &quot;3å¤©å‰&quot;console.log(rtf.format(3, &#39;day&#39;))// &quot;3å¤©å&quot;console.log(rtf.format(3, &#39;minute&#39;))// &quot;3åˆ†é’Ÿå&quot;console.log(rtf.format(-3, &#39;second&#39;))// &quot;3ç§’é’Ÿå‰&quot;</code></pre><h3 id="è¯¦ç»†ä½¿ç”¨-1"><a href="#è¯¦ç»†ä½¿ç”¨-1" class="headerlink" title="è¯¦ç»†ä½¿ç”¨"></a>è¯¦ç»†ä½¿ç”¨</h3><p>å‚è€ƒæ–‡æ¡£ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RelativeTimeFormat#%E5%8F%82%E6%95%B0" target="_blank" rel="noopener">Intl.RelativeTimeFormat</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.zhangxinxu.com/wordpress/2019/09/js-intl-zh/" target="_blank" rel="noopener">Intl</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl" target="_blank" rel="noopener">JS Intl å¯¹è±¡å®Œæ•´ç®€ä»‹åŠåœ¨ä¸­æ–‡ä¸­çš„åº”ç”¨</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¹³æ—¶é¡¹ç›®ä¸­è¦å¯¹æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–é€šå¸¸ä¼šä½¿ç”¨å¦‚ &lt;a href=&quot;https://github.com/iamkun/dayjs&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;dayjs&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/date-fns/date-fns&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;date-fns&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/moment/moment&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;moment&lt;/a&gt; è¿™äº›ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½åªéœ€è¦æŸå‡ ä¸ªæ–¹æ³•ï¼Œå´å®‰è£…äº†ä¸€æ•´ä¸ªåº“ï¼Œå¤§å¤§å¢åŠ äº†é¡¹ç›®çš„ä½“ç§¯ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« çš„æ•°æ® &lt;a href=&quot;https://github.com/you-dont-need/You-Dont-Need-Momentjs&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;You-Dont-Need-Momentjs&lt;/a&gt;ã€‚æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ Intl å¯¹è±¡è¿›è¡Œæ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="JS" scheme="https://coldstone.fun/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹é›†åˆ</title>
    <link href="https://coldstone.fun/post/2019/10/01/dsa-set/"/>
    <id>https://coldstone.fun/post/2019/10/01/dsa-set/</id>
    <published>2019-10-01T02:46:48.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>é›†åˆæ˜¯ä¸€ç§åŒ…å«ä¸åŒå…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œé›†åˆä¸­çš„å…ƒç´ ç§°ä¹‹ä¸ºæˆå‘˜ã€‚é›†åˆæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œä¸€æ˜¯é›†åˆä¸­çš„æˆå‘˜æ˜¯æ— åºçš„ï¼Œå…¶æ¬¡é›†åˆä¸­ä¸å­˜åœ¨ç›¸åŒçš„æˆå‘˜ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é›†åˆæ˜¯ä¸€ç§åŒ…å«ä¸åŒå…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œé›†åˆä¸­çš„å…ƒç´ ç§°ä¹‹ä¸ºæˆå‘˜ã€‚é›†åˆæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œä¸€æ˜¯é›†åˆä¸­çš„æˆå‘˜æ˜¯æ— åºçš„ï¼Œå…¶æ¬¡é›†åˆä¸­ä¸å­˜åœ¨ç›¸åŒçš„æˆå‘˜ã€‚</p><h2 id="å…³äºé›†åˆ"><a href="#å…³äºé›†åˆ" class="headerlink" title="å…³äºé›†åˆ"></a>å…³äºé›†åˆ</h2><p>ä¸åŒ…å«ä»»ä½•æˆå‘˜çš„é›†åˆç§°ä¸ºç©ºé›†ï¼Œå…¨é›†åˆ™æ˜¯åŒ…å«å¯èƒ½ä¸€åˆ‡æˆå‘˜çš„é›†åˆã€‚<br>å¦‚æœä¸¤ä¸ªé›†åˆçš„æˆå‘˜å®Œå…¨ç›¸ç­‰ï¼Œåˆ™ä¸¤ä¸ªé›†åˆç›¸ç­‰ã€‚<br>å¦‚æœä¸€ä¸ªé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å±äºå¦ä¸€ä¸ªé›†åˆï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªé›†åˆæ˜¯å¦ä¸€ä¸ªé›†åˆçš„å­é›†ã€‚<br>å¹¶é›†-å°†ä¸¤ä¸ªé›†åˆçš„æˆå‘˜åˆå¹¶çš„æ“ä½œã€‚<br>äº¤é›†-å°†ä¸¤ä¸ªé›†åˆå…±æœ‰çš„æˆå‘˜ç»„æˆä¸€ä¸ªæ–°çš„é›†åˆã€‚<br>è¡¥é›†-å±äºä¸€ä¸ªé›†åˆè€Œä¸å±äºå¦ä¸€ä¸ªé›†åˆçš„æˆå‘˜ã€‚</p><h2 id="å®ç°é›†åˆ"><a href="#å®ç°é›†åˆ" class="headerlink" title="å®ç°é›†åˆ"></a>å®ç°é›†åˆ</h2><pre><code class="ts">class MySet {  data = &lt;any&gt;[]  get size() {    return this.data.length  }  add(element: any) {    if (this.data.indexOf(element) &gt; -1) {      return false    }    this.data.push(element)  }  remove(element: any) {    const index = this.data.indexOf(element)    if (index &gt; -1) {      this.data.splice(index, 1)      return true    }    return false  }  contains(element: any) {    if (this.data.indexOf(element) &gt; -1) {      return true    }    return false  }  // å¹¶é›†  uinon(set: MySet) {    const newSet = new MySet()    this.data.forEach((e: any) =&gt; newSet.add(e))    for (let index = 0; index &lt; set.data.length; index++) {      const ele = set.data[index]      if (!newSet.contains(ele)) {        newSet.add(ele)      }    }    return newSet  }  // äº¤é›†  intersect(set: MySet) {    const newSet = new MySet()    this.data.forEach((ele: any) =&gt; {      if (set.contains(ele)) {        newSet.add(ele)      }    })    return newSet  }  // åˆ¤æ–­æ˜¯å¦æ˜¯è¡¥é›†  subset(set: MySet) {    if (this.size &gt; set.size) {      return false    } else {      for (let index = 0; index &lt; this.data.length; index++) {        const element = this.data[index]        if (!set.contains(element)) {          return false        }      }      return true    }  }  // è¿”å›é›†åˆä¸­ä¸åŒçš„æˆå‘˜  difference(set: MySet) {    const newSet = new MySet()    for (let index = 0; index &lt; this.data.length; index++) {      const element = this.data[index]      if (!set.contains(element)) {        newSet.add(element)      }    }    return newSet  }  show() {    return this.data.forEach((e: any) =&gt; console.log(e))  }}</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre><code class="ts">const setOne = new MySet()setOne.add(&#39;a&#39;)setOne.add(&#39;b&#39;)setOne.add(&#39;c&#39;)const setTwo = new MySet()setTwo.add(&#39;c&#39;)setTwo.add(&#39;d&#39;)setTwo.add(&#39;e&#39;)setTwo.add(&#39;f&#39;)const setThree = setOne.uinon(setTwo)console.log(&#39;åˆé›†&#39;)setThree.show()// åˆé›†// a b c d e fconst setFour = setOne.intersect(setTwo)console.log(&#39;äº¤é›†&#39;)setFour.show()// äº¤é›†// cconst isSubset = setOne.subset(setTwo)console.log(&#39;æ˜¯å¦æ˜¯è¡¥é›†&#39;, isSubset)// æ˜¯å¦æ˜¯è¡¥é›† falseconst setSix = setOne.difference(setTwo)console.log(&#39;æŸ¥çœ‹é›†åˆä¸­ä¸åŒçš„æˆå‘˜&#39;)setSix.show()// æŸ¥çœ‹é›†åˆä¸­ä¸åŒçš„æˆå‘˜// a b</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é›†åˆæ˜¯ä¸€ç§åŒ…å«ä¸åŒå…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œé›†åˆä¸­çš„å…ƒç´ ç§°ä¹‹ä¸ºæˆå‘˜ã€‚é›†åˆæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œä¸€æ˜¯é›†åˆä¸­çš„æˆå‘˜æ˜¯æ— åºçš„ï¼Œå…¶æ¬¡é›†åˆä¸­ä¸å­˜åœ¨ç›¸åŒçš„æˆå‘˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Provider ç®¡ç† Flutter åº”ç”¨çŠ¶æ€ (ä¸‹)</title>
    <link href="https://coldstone.fun/post/2019/09/23/flutter-provider-todos-02/"/>
    <id>https://coldstone.fun/post/2019/09/23/flutter-provider-todos-02/</id>
    <published>2019-09-23T08:17:17.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>ç´§æ¥ä¸Šç¯‡ï¼Œå¯¹äºä¸€ä¸ªä»£åŠäº‹é¡¹çš„æ–°å¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤åŠŸèƒ½éƒ½å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯æ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œé‡æ–°å¯åŠ¨åº”ç”¨æ•°æ®å°±é‡ç½®äº†ï¼Œä¸ºäº†å­˜å‚¨æ•°æ®å¯ä»¥å°†æ•°æ®å­˜åˆ°æ‰‹æœºçš„å­˜å‚¨é‡Œé¢æˆ–è€…å­˜åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œæœ¬æ–‡å°±å®ç°å¦‚ä½•ä½¿ç”¨ <a href="https://github.com/flutterchina/dio" target="_blank" rel="noopener">dio</a> å°†æ•°æ®å­˜åˆ°æœåŠ¡å™¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç´§æ¥ä¸Šç¯‡ï¼Œå¯¹äºä¸€ä¸ªä»£åŠäº‹é¡¹çš„æ–°å¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤åŠŸèƒ½éƒ½å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯æ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œé‡æ–°å¯åŠ¨åº”ç”¨æ•°æ®å°±é‡ç½®äº†ï¼Œä¸ºäº†å­˜å‚¨æ•°æ®å¯ä»¥å°†æ•°æ®å­˜åˆ°æ‰‹æœºçš„å­˜å‚¨é‡Œé¢æˆ–è€…å­˜åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œæœ¬æ–‡å°±å®ç°å¦‚ä½•ä½¿ç”¨ <a href="https://github.com/flutterchina/dio" target="_blank" rel="noopener">dio</a> å°†æ•°æ®å­˜åˆ°æœåŠ¡å™¨</p><p><a href="https://github.com/xrr2016/flutter_provider_todos/tree/http" target="_blank" rel="noopener">æºç åœ°å€</a></p><h2 id="å¼€å‘å‡†å¤‡"><a href="#å¼€å‘å‡†å¤‡" class="headerlink" title="å¼€å‘å‡†å¤‡"></a>å¼€å‘å‡†å¤‡</h2><p>åœ¨ <code>pubspec.yaml</code> æ·»åŠ  dio ä¾èµ–ï¼›ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„æœåŠ¡ï¼Œæˆ‘ç”¨çš„æ˜¯ <a href="https://jsonbox.io/" target="_blank" rel="noopener">jsonbox</a></p><pre><code class="yml">dependencies:  dio: ^3.0.1</code></pre><h2 id="é…ç½®-dio"><a href="#é…ç½®-dio" class="headerlink" title="é…ç½® dio"></a>é…ç½® dio</h2><p>ç”±äºè¿™ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªæœåŠ¡åœ°å€ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ª dio çš„å•ä¾‹æ¥è¿›è¡Œè¯·æ±‚å°±å¾ˆå¥½äº†ï¼Œæ–°å»ºä¸€ä¸ª request.dart æ–‡ä»¶é…ç½® dioï¼Œä½¿ç”¨ä¸€ä¸ªå‡½æ•°è¿”å›åˆ›å»ºçš„ dio å®ä¾‹</p><ul><li>è®¾ç½®åŸºç¡€çš„è¯·æ±‚åœ°å€</li><li>è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´</li><li>è®¾ç½®åœ¨è°ƒè¯•æ§åˆ¶å°è¾“å‡ºè¯·æ±‚å“åº”ä½“æ–¹ä¾¿æŸ¥çœ‹è¯·æ±‚</li></ul><p>åŸºæœ¬è®¾ç½®ä¸‹å°±å¯ä»¥ç”¨äº†ï¼Œå…¶å®ƒè®¾ç½®å¯ä»¥æŸ¥çœ‹ dio çš„<a href="https://pub.flutter-io.cn/packages/dio" target="_blank" rel="noopener">æ–‡æ¡£</a></p><pre><code class="dart">import &#39;package:dio/dio.dart&#39;;const DB_URL = &#39;https://jsonbox.io/box_7ea9df49e805cf99509b&#39;;Dio craeteDio() {  BaseOptions options = BaseOptions(    baseUrl: DB_URL,    connectTimeout: 5000,    receiveTimeout: 3000,  );  Dio dio = Dio(options);  dio.interceptors.add(LogInterceptor(    error: true,    request: false,    responseBody: true,    responseHeader: false,    requestHeader: false,  ));  return dio;}</code></pre><h2 id="ä¿®æ”¹-Todo-æ¨¡å‹"><a href="#ä¿®æ”¹-Todo-æ¨¡å‹" class="headerlink" title="ä¿®æ”¹ Todo æ¨¡å‹"></a>ä¿®æ”¹ Todo æ¨¡å‹</h2><p>ç”±äºéœ€è¦ä»æœåŠ¡å™¨ä¸Šè·å– todo æ•°æ®ï¼ŒæœåŠ¡è¿”å›çš„æ•°æ®æ˜¯ json æ ¼å¼ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ‹¿åˆ°æ•°æ®çš„æ—¶å€™å°†å•ä¸ª todo çš„ json æ•°æ®è½¬æˆ Todo å®ä¾‹ï¼Œæ–°å»ºä¸€ä¸ª model/todo.dart æ–‡ä»¶ï¼Œæ¯”ä¹‹å‰å¤šçš„æ˜¯ä¸¤ä¸ªæ–¹æ³•è€Œå·²ï¼Œ<code>fromJson</code> è¿™ä¸ªå·¥å‚å‡½æ•°ä½œç”¨æ˜¯ä½¿ç”¨ json æ•°æ®å®ä¾‹åŒ–ä¸€ä¸ª Todoï¼Œ<code>toJson</code> æ–¹æ³•ç”¨æ¥å°†ä¸€ä¸ª Todo è½¬æˆä¸€ä¸ª Map ç»“æ„çš„æ•°æ®</p><p>å¦‚æœä¸€ä¸ªæ¨¡å‹çš„å­—æ®µè¾ƒå°‘å¯ä»¥æ‰‹å†™ï¼Œä½†æ˜¯å½“å­—æ®µè¾ƒå¤šæ¯”è¾ƒå¤æ‚çš„æ—¶å€™å°±éœ€è¦ä½¿ç”¨å·¥å…·æ¥å¸®åŠ©ç”Ÿæˆä»£ç äº†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ <a href="https://app.quicktype.io/" target="_blank" rel="noopener">quicktype</a> è¿™ä¸ªå·¥å…·</p><pre><code class="dart">class Todo {  String id;  bool finish;  String thing;  Todo({    this.id,    this.thing,    this.finish,  });  factory Todo.fromJson(Map&lt;String, dynamic&gt; json) =&gt; Todo(        id: json[&quot;_id&quot;].toString(),        thing: json[&quot;thing&quot;],        finish: json[&quot;finish&quot;],      );  Map&lt;String, dynamic&gt; toJson() =&gt; {        &quot;id&quot;: id,        &quot;thing&quot;: thing,        &quot;finish&quot;: finish,      };}</code></pre><h2 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h2><p>é…ç½®å¥½ dio å°±å¯ä»¥åœ¨ todos.dart å‘æœåŠ¡å™¨å‘é€è¯·æ±‚äº†ï¼Œä¿®æ”¹ store/todos.dartï¼Œç»™ Todos ç±»æ·»åŠ äº†ä¸€ä¸ª _dio å±æ€§ç”¨æ¥å‘é€è¯·æ±‚ï¼Œä¸€ä¸ª getTodos æ–¹æ³•ç”¨æ¥è·å–å…¨éƒ¨ todo çš„åˆ—è¡¨æ•°æ®ï¼Œç„¶åä¿®æ”¹ addTodoï¼ŒremoveTodoï¼ŒeditTodo æ–¹æ³•ä½¿ç”¨ _dio å‘æœåŠ¡å™¨å‘é€ postï¼Œdeleteï¼Œput è¯·æ±‚ã€‚</p><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å°† json è½¬æ¢æˆå®ä¾‹çš„é—®é¢˜ï¼Œå¾ˆå®¹æ˜“å°±ä¼šå‡ºç°ç±»ä¼¼</p><pre><code class="dart">type &#39;List&lt;dynamic&gt;&#39; is not a subtype of type &#39;List&lt;Todo&gt;&#39;</code></pre><p>è¿™ç§é”™è¯¯ï¼Œè¿™ç§éƒ½æ˜¯ç±»å‹è½¬æ¢çš„é—®é¢˜ï¼Œæˆ‘çœ‹äº†ä¸€ç¯‡æ–‡ç« åæ‰ç®—å¼„æ‡‚äº†ä¸€ç‚¹ <a href="https://medium.com/flutter-community/parsing-complex-json-in-flutter-747c46655f51" target="_blank" rel="noopener">parsing-complex-json-in-flutter</a></p><pre><code class="dart">import &#39;package:dio/dio.dart&#39;;import &#39;package:flutter/foundation.dart&#39;;import &#39;../request.dart&#39;;import &#39;../model/todo.dart&#39;;class Todos extends ChangeNotifier {  List&lt;Todo&gt; _items = [];  Dio _dio = craeteDio();  get items {    return [..._items];  }  void refresh() {    notifyListeners();  }  Future&lt;List&gt; getTodos() async {    try {      Response response = await _dio.get(&#39;/todos&#39;);      final list = response.data as List;      _items = List&lt;Todo&gt;.from(list.map((i) =&gt; Todo.fromJson(i)).toList());      return items;    } on DioError catch (err) {      throw err;    }  }  Future addTodo(String thing) async {    try {      Response response = await _dio.post(&#39;/todos&#39;, data: {        &quot;thing&quot;: thing,        &quot;finish&quot;: false,      });      Todo todo = Todo(        thing: thing,        id: response.data[&quot;_id&quot;],        finish: response.data[&quot;finish&quot;],      );      _items.insert(0, todo);      refresh();    } on DioError catch (err) {      throw err;    }  }  Future removeTodo(int index) async {    try {      String todoId = _items[index].id;      await _dio.delete(&quot;/todos/$todoId&quot;);      _items.removeAt(index);      refresh();    } catch (err) {      throw err;    }  }  Future editTodo(int index, String thing, bool finish) async {    String todoId = _items[index].id;    try {      await _dio.put(&quot;/todos/$todoId&quot;, data: {        &quot;thing&quot;: thing,        &quot;finish&quot;: finish,      });      Todo todo = _items[index];      todo.thing = thing;      todo.finish = finish;      refresh();    } catch (e) {      throw e;    }  }  void toggleFinish(int index) {    final todo = _items[index];    todo.finish = !todo.finish;    refresh();  }  bool isTodoExist(String thing) {    bool isExist = false;    for (var i = 0; i &lt; _items.length; i++) {      final todo = _items[i];      if (todo.thing == thing) {        isExist = true;      }    }    return isExist;  }}</code></pre><h2 id="ä½¿ç”¨æ•°æ®"><a href="#ä½¿ç”¨æ•°æ®" class="headerlink" title="ä½¿ç”¨æ•°æ®"></a>ä½¿ç”¨æ•°æ®</h2><p>æœ‰äº†æ•°æ®åå°±å¯ä»¥åœ¨åˆ—è¡¨é¡µä½¿ç”¨äº†ï¼Œç”±äºç°åœ¨æ•°æ®æ˜¯ä»æœåŠ¡å™¨è¿”å›çš„ï¼Œä¼šæœ‰è¯·æ±‚è€—æ—¶ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>FutureBuilder</code> è¿™ä¸ªéƒ¨ä»¶æ¸²æŸ“åˆ—è¡¨ï¼Œ<code>FutureBuilder</code> éœ€è¦ä¸€ä¸ªè®¾ç½®ä¸€ä¸ª future æ¥åˆ¤æ–­çŠ¶æ€ï¼Œè¿™é‡Œè‡ªç„¶æ˜¯ Todos ç±»çš„ <code>getTodos</code> æ–¹æ³•è¿”å›çš„ Future å¯¹è±¡ï¼Œç„¶å builder å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ context ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯ snapshot å¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯è¿™ä¸ª future çš„çŠ¶æ€ã€‚</p><p>åœ¨ builder æ–¹æ³•é‡Œé¢ç”¨ä¸€ä¸ª switch è¯­å¥åˆ¤æ–­è¿™ä¸ª future çš„çŠ¶æ€ï¼Œæ ¹æ®çŠ¶æ€è¿”å›éœ€è¦æ¸²æŸ“çš„éƒ¨ä»¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ noneï¼ˆçŠ¶æ€ä¸å­˜åœ¨ï¼‰ï¼Œactiveï¼ˆè¿è¡Œä¸­ï¼‰ï¼Œwaitingï¼ˆç­‰å¾…ä¸­ï¼‰ï¼Œdoneï¼ˆå®Œæˆï¼‰ï¼Œå¦‚æœéƒ½ä¸åŒ¹é…å°±ï¼Œè¿”å›ä¸€ä¸ª null å€¼ã€‚</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;store/todos.dart&#39;;import &#39;widget/add_todo_button.dart&#39;;import &#39;widget/edit_todo_button.dart&#39;;import &#39;widget/remove_todo_button.dart&#39;;class TodosPage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;Flutter Provider Todos&#39;)),      body: FutureBuilder(        future: Provider.of&lt;Todos&gt;(context).getTodos(),        builder: (context, snapshot) {          switch (snapshot.connectionState) {            case ConnectionState.none:              return Text(&#39;Press button to start.&#39;);            case ConnectionState.active:            case ConnectionState.waiting:              return Center(child: CircularProgressIndicator());            case ConnectionState.done:              if (snapshot.hasError) {                print(snapshot.error);                return Center(                  child: Text(                    &#39;å‡ºé”™äº†ï¼Œè¯·é‡è¯•&#39;,                    style: TextStyle(fontSize: 18.0, color: Colors.red),                  ),                );              }              List items = snapshot.data;              if (items == null) {                return Center(                  child: Text(                    &#39;è¿˜æ²¡æœ‰ä»£åŠäº‹é¡¹ï¼Œå¿«å»æ·»åŠ å§&#39;,                    style: TextStyle(fontSize: 18.0),                  ),                );              }              return ListView.builder(                  itemCount: items.length,                  itemBuilder: (_, index) {                    return Column(                      children: &lt;Widget&gt;[                        ListTile(                          title: Text(                            items[index].thing,                            style: TextStyle(                              color: items[index].finish                                  ? Colors.green                                  : Colors.grey,                            ),                          ),                          trailing: Container(                            width: 150,                            child: Row(                              mainAxisAlignment: MainAxisAlignment.end,                              children: &lt;Widget&gt;[                                EditTodoButton(todoIndex: index),                                RemoveTodoButton(todoIndex: index),                              ],                            ),                          ),                        ),                        Divider(),                      ],                    );                  });          }          return null;        },      ),      floatingActionButton: Consumer&lt;Todos&gt;(        builder: (_, todos, child) {          return AddTodoButton();        },      ),      floatingActionButtonLocation: FloatingActionButtonLocation.centerFloat,    );  }}</code></pre><h2 id="ä¿®æ”¹æŒ‰é’®"><a href="#ä¿®æ”¹æŒ‰é’®" class="headerlink" title="ä¿®æ”¹æŒ‰é’®"></a>ä¿®æ”¹æŒ‰é’®</h2><p>æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦ä¿®æ”¹æ–°å¢ï¼Œç¼–è¾‘ï¼Œåˆ é™¤ä»£åŠçš„æŒ‰é’®äº†ï¼ŒåŒç†ç”±äºç°åœ¨éœ€è¦è·ŸæœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®è¯·æ±‚çŠ¶æ€æ¥å¤„ç†é€»è¾‘ï¼Œä¸»è¦çš„ä¿®æ”¹å°±æ˜¯ä½¿ç”¨ <code>async/await</code> è¯­æ³•ç­‰åˆ°ä¸€ä¸ªè¯·æ±‚å®Œæˆåï¼Œæ ¹æ®è¿”å›å€¼è¿›è¡Œå¤„ç†ã€‚</p><p>æ·»åŠ  Todo æŒ‰é’®</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;../store/todos.dart&#39;;class AddTodoButton extends StatefulWidget {  @override  _AddTodoButtonState createState() =&gt; _AddTodoButtonState();}class _AddTodoButtonState extends State&lt;AddTodoButton&gt; {  final _formKey = GlobalKey&lt;FormState&gt;();  final _controller = TextEditingController();  @override  void dispose() {    _formKey.currentState.dispose();    _controller.dispose();    super.dispose();  }  @override  Widget build(BuildContext context) {    return Consumer&lt;Todos&gt;(      builder: (_, todos, child) {        _addTodo() async {          final isValid = _formKey.currentState.validate();          if (!isValid) {            return;          }          final thing = _controller.value.text;          try {            await todos.addTodo(thing);            Navigator.pop(context);            _controller.clear();          } catch (e) {            Scaffold.of(context).showSnackBar(              SnackBar(content: Text(&#39;æ–°å¢ä»£åŠå¤±è´¥äº†ï¼Œè¯·é‡è¯•ã€‚&#39;)),            );          }        }        return FloatingActionButton(          child: Icon(Icons.add),          onPressed: () {            print(&#39;add todo&#39;);            return showDialog(              context: context,              builder: (BuildContext _) {                return SimpleDialog(                  title: Text(&#39;æ·»åŠ  Todo&#39;),                  contentPadding: const EdgeInsets.all(24.0),                  children: &lt;Widget&gt;[                    Form(                      key: _formKey,                      child: Column(                        children: &lt;Widget&gt;[                          TextFormField(                            autofocus: true,                            autovalidate: false,                            controller: _controller,                            keyboardType: TextInputType.text,                            decoration: InputDecoration(                              border: OutlineInputBorder(),                              labelText: &#39;è¾“å…¥ä½ æƒ³åšçš„äº‹&#39;,                            ),                            validator: (val) {                              if (val.isEmpty) {                                return &#39;æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º&#39;;                              }                              bool isExist = todos.isTodoExist(val);                              if (isExist) {                                return &#39;è¿™ä»¶äº‹æƒ…å·²ç»å­˜åœ¨äº†&#39;;                              }                              return null;                            },                          ),                          SizedBox(height: 20),                          Row(                            mainAxisAlignment: MainAxisAlignment.end,                            children: &lt;Widget&gt;[                              FlatButton(                                child: Text(&#39;å–æ¶ˆ&#39;),                                onPressed: () {                                  Navigator.pop(context);                                },                              ),                              RaisedButton(                                child: Text(                                  &#39;ç¡®å®š&#39;,                                  style: TextStyle(color: Colors.white),                                ),                                color: Theme.of(context).primaryColor,                                onPressed: _addTodo,                              ),                            ],                          ),                        ],                      ),                    ),                  ],                );              },            );          },        );      },    );  }}</code></pre><p>ç¼–è¾‘ Todo æŒ‰é’®</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;../model/todo.dart&#39;;import &#39;../store/todos.dart&#39;;class EditTodoButton extends StatefulWidget {  final todoIndex;  const EditTodoButton({Key key, this.todoIndex}) : super(key: key);  @override  _EditTodoButtonState createState() =&gt; _EditTodoButtonState();}class _EditTodoButtonState extends State&lt;EditTodoButton&gt; {  final _formKey = GlobalKey&lt;FormState&gt;();  @override  void dispose() {    _formKey?.currentState?.dispose();    super.dispose();  }  @override  Widget build(BuildContext context) {    return Consumer&lt;Todos&gt;(      builder: (context, todos, child) {        final todoIndex = widget.todoIndex;        final Todo todo = todos.items[todoIndex];        return IconButton(          color: Colors.blue,          icon: Icon(Icons.edit),          onPressed: () {            return showDialog(              context: context,              builder: (_) {                return SimpleDialog(                  title: Text(&#39;ç¼–è¾‘ Todo&#39;),                  contentPadding: const EdgeInsets.all(24.0),                  children: &lt;Widget&gt;[                    Form(                      key: _formKey,                      child: Column(                        children: &lt;Widget&gt;[                          TextFormField(                            autofocus: false,                            autovalidate: false,                            initialValue: todo.thing,                            decoration: InputDecoration(                              border: OutlineInputBorder(),                              labelText: &#39;è¾“å…¥ä½ æƒ³åšçš„äº‹&#39;,                            ),                            onChanged: (val) {                              todo.thing = val;                            },                            validator: (val) {                              if (val.isEmpty) {                                return &#39;æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º&#39;;                              }                              return null;                            },                          ),                          SizedBox(height: 20),                          SwitchListTile(                            title: const Text(&#39;æ˜¯å¦å®Œæˆ&#39;),                            value: todo.finish,                            onChanged: (bool value) {                              todo.finish = value;                            },                          ),                          SizedBox(height: 20),                          Row(                            mainAxisAlignment: MainAxisAlignment.end,                            children: &lt;Widget&gt;[                              FlatButton(                                child: Text(&#39;å–æ¶ˆ&#39;),                                onPressed: () =&gt; Navigator.pop(context),                              ),                              RaisedButton(                                child: Text(                                  &#39;ç¡®å®š&#39;,                                  style: TextStyle(color: Colors.white),                                ),                                color: Theme.of(context).primaryColor,                                onPressed: () async {                                  final isValid =                                      _formKey.currentState.validate();                                  if (!isValid) {                                    return;                                  }                                  try {                                    await todos.editTodo(                                      todoIndex,                                      todo.thing,                                      todo.finish,                                    );                                    Navigator.pop(context);                                  } catch (e) {                                    Scaffold.of(context).showSnackBar(                                      SnackBar(content: Text(&#39;ä¿®æ”¹ä»£åŠå¤±è´¥äº†ï¼Œè¯·é‡è¯•ã€‚&#39;)),                                    );                                  }                                },                              )                            ],                          ),                        ],                      ),                    ),                  ],                );              },            );          },        );      },    );  }}</code></pre><p>åˆ é™¤ Todo æŒ‰é’®</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;../model/todo.dart&#39;;import &#39;../store/todos.dart&#39;;class RemoveTodoButton extends StatelessWidget {  final int todoIndex;  const RemoveTodoButton({Key key, this.todoIndex}) : super(key: key);  @override  Widget build(BuildContext context) {    return Consumer&lt;Todos&gt;(builder: (_, todos, child) {      final Todo todo = todos.items[todoIndex];      return IconButton(        color: Colors.red,        icon: Icon(Icons.delete),        onPressed: () {          print(&#39;delete todo&#39;);          showDialog(            context: context,            builder: (BuildContext context) {              return AlertDialog(                title: Text(&#39;ç¡®è®¤åˆ é™¤ ${todo.thing}?&#39;),                actions: &lt;Widget&gt;[                  FlatButton(                    child: Text(                      &#39;å–æ¶ˆ&#39;,                      style: TextStyle(color: Colors.grey),                    ),                    onPressed: () =&gt; Navigator.pop(context),                  ),                  FlatButton(                    child: Text(&#39;ç¡®è®¤&#39;),                    onPressed: () async {                      await todos.removeTodo(todoIndex);                      Navigator.pop(context);                    },                  ),                ],              );            },          );        },      );    });  }}</code></pre><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è‡³æ­¤æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šäº†ï¼Œé‡å¯åº”ç”¨æ•°æ®ä¹Ÿä¼šä»æœåŠ¡å™¨ä¸Šè·å–äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç´§æ¥ä¸Šç¯‡ï¼Œå¯¹äºä¸€ä¸ªä»£åŠäº‹é¡¹çš„æ–°å¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤åŠŸèƒ½éƒ½å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯æ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œé‡æ–°å¯åŠ¨åº”ç”¨æ•°æ®å°±é‡ç½®äº†ï¼Œä¸ºäº†å­˜å‚¨æ•°æ®å¯ä»¥å°†æ•°æ®å­˜åˆ°æ‰‹æœºçš„å­˜å‚¨é‡Œé¢æˆ–è€…å­˜åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œæœ¬æ–‡å°±å®ç°å¦‚ä½•ä½¿ç”¨ &lt;a href=&quot;https://github.com/flutterchina/dio&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;dio&lt;/a&gt; å°†æ•°æ®å­˜åˆ°æœåŠ¡å™¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Provider ç®¡ç† Flutter åº”ç”¨çŠ¶æ€ (ä¸Š)</title>
    <link href="https://coldstone.fun/post/2019/09/11/flutter-provider-todos-01/"/>
    <id>https://coldstone.fun/post/2019/09/11/flutter-provider-todos-01/</id>
    <published>2019-09-11T13:48:56.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªåº”ç”¨å†…é€šå¸¸ä¼šæœ‰ä¸¤ç§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨çš„ä½¿ç”¨çš„ä¸´æ—¶æ€§æ•°æ®ä»¥åŠå¾ˆå¤šéƒ¨ä»¶ä½¿ç”¨çš„å…¨å±€æ€§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨ä½¿ç”¨çš„æ•°æ®å¯ä»¥é€šè¿‡ StatefulWidget æ¥ç®¡ç†ï¼Œä½†æ˜¯å…¨å±€æ€§çš„æ•°æ®å¦‚æœé€šè¿‡ä»ä¸Šåˆ°ä¸‹ä¼ é€’çš„æ–¹å¼ä¼šä½¿ä»£ç å†™çš„ååˆ†ç¹çï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·æ¥è¿›è¡Œç®¡ç†äº†ï¼Œæœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Provider æ¥ç®¡ç†è¿™ç§åº”ç”¨çš„å…¨å±€æ€§çš„æ•°æ®</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€ä¸ªåº”ç”¨å†…é€šå¸¸ä¼šæœ‰ä¸¤ç§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨çš„ä½¿ç”¨çš„ä¸´æ—¶æ€§æ•°æ®ä»¥åŠå¾ˆå¤šéƒ¨ä»¶ä½¿ç”¨çš„å…¨å±€æ€§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨ä½¿ç”¨çš„æ•°æ®å¯ä»¥é€šè¿‡ StatefulWidget æ¥ç®¡ç†ï¼Œä½†æ˜¯å…¨å±€æ€§çš„æ•°æ®å¦‚æœé€šè¿‡ä»ä¸Šåˆ°ä¸‹ä¼ é€’çš„æ–¹å¼ä¼šä½¿ä»£ç å†™çš„ååˆ†ç¹çï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·æ¥è¿›è¡Œç®¡ç†äº†ï¼Œæœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Provider æ¥ç®¡ç†è¿™ç§åº”ç”¨çš„å…¨å±€æ€§çš„æ•°æ®</p><h2 id="ä»€ä¹ˆæ˜¯-Provider"><a href="#ä»€ä¹ˆæ˜¯-Provider" class="headerlink" title="ä»€ä¹ˆæ˜¯ Provider"></a>ä»€ä¹ˆæ˜¯ Provider</h2><p>å®˜æ–¹çš„å®šä¹‰æ˜¯ï¼š A mixture between dependency injection (DI) and state management, built with widgets for widgets. ç¿»è¯‘è¿‡æ¥å¤§æ„æ˜¯ä¸€ç§ä¾èµ–æ³¨å…¥å’ŒçŠ¶æ€ç®¡ç†çš„æ··åˆæ–¹æ¡ˆï¼Œä½¿ç”¨éƒ¨ä»¶åˆ›å»ºï¼Œä½œç”¨äºéƒ¨ä»¶ ğŸ˜…</p><p><a href="https://pub.flutter-io.cn/documentation/provider/latest/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Provider"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Provider" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Provider"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Provider</h2><p>åº”ç”¨ä¸­é€šå¸¸ä¼šæœ‰ä¸€äº›å¾ˆå¤šéƒ¨ä»¶éƒ½éœ€è¦çš„æ•°æ®ï¼Œå¦‚ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œç”¨æˆ·è®¾ç½®ï¼Œåœ°ç†ä½ç½®ç­‰ï¼Œå¦‚æœåªæ˜¯ä½¿ç”¨ StatefullWeight çš„è¯å°±éœ€è¦å°†çŠ¶æ€æå‡åˆ°ä¸€ä¸ªçˆ¶éƒ¨ä»¶ä¸­ç„¶åå‘ä¸‹è¿›è¡Œä¼ é€’ï¼Œä¼šå¾ˆç¹çï¼Œä½¿ç”¨ provider çš„è¯å¯ä»¥å°†å¯¹ä¸€ç§çŠ¶æ€æ•°æ®çš„æ“ä½œæ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å†…ï¼Œç„¶åä½¿ç”¨åˆ°è¿™ä¸ªæ•°æ®çš„éƒ¨ä»¶åªéœ€è¦ä½¿ç”¨å°±å¯ä»¥äº†ï¼Œå½“æ•°æ®æœ‰å˜åŒ–æ—¶ï¼Œéƒ¨ä»¶ä¼šè‡ªåŠ¨çš„é‡æ–°æ„å»ºï¼Œä½¿ç•Œé¢æ›´æ–°ã€‚</p><h2 id="ä¸€ä¸ªä¾‹å­-ğŸŒ°"><a href="#ä¸€ä¸ªä¾‹å­-ğŸŒ°" class="headerlink" title="ä¸€ä¸ªä¾‹å­ ğŸŒ°"></a>ä¸€ä¸ªä¾‹å­ ğŸŒ°</h2><p>ä½¿ç”¨ä¸€ä¸ª todo åº”ç”¨æ¥è¯´æ˜å¦‚ä½•åœ¨ Flutter åº”ç”¨ä¸­ä½¿ç”¨ Providerï¼Œæœ€ç»ˆçš„å®Œæˆçš„åº”ç”¨æ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥æ–°å¢ï¼Œç¼–è¾‘å’Œåˆ é™¤ todoã€‚</p><p><a href="https://github.com/xrr2016/flutter_provider_todos" target="_blank" rel="noopener">æºç åœ°å€</a></p><img src="images/provider-todos.png" width="360" style="max-width:360px"><h3 id="åˆ›å»ºåº”ç”¨"><a href="#åˆ›å»ºåº”ç”¨" class="headerlink" title="åˆ›å»ºåº”ç”¨"></a>åˆ›å»ºåº”ç”¨</h3><p>é¦–å…ˆä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºä¸€ä¸ªé¡¹ç›®</p><pre><code class="sh">flutter create flutter_provider_todos</code></pre><p>ç„¶ååœ¨é¡¹ç›®çš„ pubspec.yml æ·»åŠ  provider</p><pre><code class="yml">dependencies:  provider: ^3.1.0</code></pre><p>åˆ›å»ºä¸€ä¸ª store æ–‡ä»¶å¤¹ä»¥åŠ todos.dart ç”¨æ¥å­˜æ”¾åº”ç”¨ä¸­éœ€è¦ç”¨åˆ°çš„å…¨å±€æ€§æ•°æ®ï¼Œæ–°å»ºä¸€ä¸ª widget ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾åº”ç”¨ä¸­çš„éƒ¨ä»¶ä»¥åŠä¸€ä¸ªæ˜¾ç¤º todo çš„é¡µé¢ todos_page.dart</p><img src="images/todos-folder.jpg" width="360" style="max-width:360px"><p>é¦–å…ˆåˆ›å»º todos è¿™ä¸ªå…¨å±€æ€§çš„æ•°æ®ï¼Œä¿®æ”¹ store/todos.dartï¼Œåˆ›å»ºä¸€ä¸ª Todo ç±»è¡¨ç¤ºä¸€ä¸ªä»£åŠäº‹é¡¹ï¼Œç„¶åå®ç° Todos ç±»ï¼Œ Todos æ··åˆäº† ChangeNotifier ç±»ï¼Œä¸ºäº†ä½¿ç”¨ notifyListeners æ–¹æ³•æ¥é€šçŸ¥ UI æ›´æ–°ï¼Œå› æ­¤éœ€è¦å¯¼å…¥ foundation.dartï¼ŒTodos ç±»ä½¿ç”¨ä¸€ä¸ª _items æ•°ç»„å­˜æ”¾ Todo æ•°æ®ï¼Œä»¥åŠå…¶å®ƒå¯¹ Todo è¿›è¡Œæ“ä½œçš„æ–¹æ³•ã€‚</p><pre><code class="dart">import &#39;package:flutter/foundation.dart&#39;;class Todo {  bool finish;  String thing;  Todo({    @required this.thing,    this.finish = false,  });}class Todos extends ChangeNotifier {  List&lt;Todo&gt; _items = [    Todo(thing: &#39;Play lol&#39;, finish: true),    Todo(thing: &#39;Learn flutter&#39;, finish: false),    Todo(thing: &#39;Read book&#39;, finish: false),    Todo(thing: &#39;Watch anime&#39;, finish: false),  ];  get items {    return [..._items];  }  get finishTodos {    return _items.where((todo) =&gt; todo.finish);  }  void refresh() {    notifyListeners();  }  void addTodo(Todo todo) {    _items.insert(0, todo);    refresh();  }  void removeTodo(int index) {    _items.removeAt(index);    refresh();  }  void editTodo(int index, String newThing, bool isFinish) {    Todo todo = _items[index];    todo.thing = newThing;    todo.finish = isFinish;    refresh();  }  void toggleFinish(int index) {    final todo = _items[index];    todo.finish = !todo.finish;    refresh();  }  bool isTodoExist(String thing) {    bool isExist = false;    for (var i = 0; i &lt; _items.length; i++) {      final todo = _items[i];      if (todo.thing == thing) {        isExist = true;      }    }    return isExist;  }}</code></pre><p>ç„¶åä½¿ç”¨ provider æä¾›çš„ ChangeNotifierProvider æ–¹æ³•å°†æ•°æ®æ³¨å†Œåˆ°æ•´ä¸ªåº”ç”¨ï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®å°±éœ€è¦ä½¿ç”¨ MultiProvider æ–¹æ³•</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;todos_page.dart&#39;;import &#39;store/todos.dart&#39;;void main() =&gt; runApp(MyApp());class MyApp extends StatelessWidget {  @override  Widget build(BuildContext context) {    return MaterialApp(      title: &#39;Todos&#39;,      debugShowCheckedModeBanner: false,      theme: ThemeData(        primarySwatch: Colors.green,      ),      home: ChangeNotifierProvider(        builder: (context) =&gt; Todos(),        child: TodosPage(),      ),    );  }}</code></pre><h3 id="åˆ—è¡¨é¡µé¢"><a href="#åˆ—è¡¨é¡µé¢" class="headerlink" title="åˆ—è¡¨é¡µé¢"></a>åˆ—è¡¨é¡µé¢</h3><p>æ¥ç€å°±æ˜¯å®ç°æ˜¾ç¤º todo åˆ—è¡¨çš„é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯è¦ç”¨åˆ° Todos ç±»é‡Œé¢çš„æ•°æ®çš„éƒ¨ä»¶ï¼Œè¦ä½¿ç”¨ provider çš„æ•°æ®é¦–å…ˆè¦å¯¼å…¥ provider ä»¥åŠå¯¹åº”çš„æ•°æ®ç±» Todosï¼Œç„¶åç”¨ Consumer åŠ ç±»å‹ Todos æ¥ä½¿ç”¨è¿™ä¸ªæ•°æ®</p><pre><code class="dart">Consumer&lt;Todos&gt;(  builder: (ctx, todos, child) {    return YourWidget()  },)</code></pre><p>è¿™ä¸ªé¡µé¢ä½¿ç”¨äº†ä¸€ä¸ª ListView.builder() æ¥æ¸²æŸ“ Todosï¼Œç„¶åæ¯ä¸€é¡¹ä½¿ç”¨ä¸€ä¸ª ListTile å±•ç¤ºã€‚æ–°å¢ï¼Œç¼–è¾‘å’Œåˆ é™¤å¯¹åº”äº† 3 ä¸ªä¸åŒçš„éƒ¨ä»¶ï¼Œåˆ†åˆ«æ˜¯ AddTodoButton()ï¼ŒEditTodoButton()ï¼Œ RemoveTodoButton()</p><pre><code class="dart">// todos_page.dartimport &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;store/todos.dart&#39;;import &#39;widget/add_todo_button.dart&#39;;import &#39;widget/edit_todo_button.dart&#39;;import &#39;widget/remove_todo_button.dart&#39;;class TodosPage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;Flutter Provider Todos&#39;)),      body: Consumer&lt;Todos&gt;(        builder: (ctx, todos, child) {          List&lt;Todo&gt; items = todos.items;          return ListView.builder(            itemCount: items.length,            itemBuilder: (_, index) =&gt; Column(              children: &lt;Widget&gt;[                ListTile(                  title: Text(                    items[index].thing,                    style: TextStyle(                      color: items[index].finish ? Colors.green : Colors.grey,                    ),                  ),                  trailing: Container(                    width: 150,                    child: Row(                      mainAxisAlignment: MainAxisAlignment.end,                      children: &lt;Widget&gt;[                        EditTodoButton(todoIndex: index),                        RemoveTodoButton(todoIndex: index),                      ],                    ),                  ),                ),                Divider(),              ],            ),          );        },      ),      floatingActionButton: AddTodoButton(),      floatingActionButtonLocation: FloatingActionButtonLocation.centerFloat,    );  }}</code></pre><h3 id="å®ç°åŠŸèƒ½"><a href="#å®ç°åŠŸèƒ½" class="headerlink" title="å®ç°åŠŸèƒ½"></a>å®ç°åŠŸèƒ½</h3><p>æ¥ä¸‹æ¥å°±æ˜¯è¦å®ç°è¿™ 3 ä¸ªæŒ‰é’®äº†ï¼Œåœ¨ widget ç›®å½•åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶ï¼Œæ¯ä¸ªæŒ‰é’®éƒ½ä¼šä½¿ç”¨åˆ° Todos ç±»é‡Œé¢å®šä¹‰çš„æ–¹æ³•ï¼Œæ‰€ä»¥éƒ½éœ€è¦å¯¼å…¥ provider å’Œ Todos ç±»ï¼Œç‚¹å‡»æŒ‰é’®ä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†è¯¢é—®å¯¹åº”çš„æ“ä½œï¼Œ</p><img src="images/todos-widget.jpg" style="max-width:360px"><p>æ·»åŠ  Todo æŒ‰é’®</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;../store/todos.dart&#39;;class AddTodoButton extends StatefulWidget {  @override  _AddTodoButtonState createState() =&gt; _AddTodoButtonState();}class _AddTodoButtonState extends State&lt;AddTodoButton&gt; {  final _formKey = GlobalKey&lt;FormState&gt;();  final _controller = TextEditingController();  @override  void dispose() {    _formKey.currentState.dispose();    _controller.dispose();    super.dispose();  }  @override  Widget build(BuildContext context) {    return Consumer&lt;Todos&gt;(      builder: (_, todos, child) {        return FloatingActionButton(          child: Icon(Icons.add),          onPressed: () {            print(&#39;add todo&#39;);            return showDialog(              context: context,              builder: (BuildContext _) {                return SimpleDialog(                  title: Text(&#39;æ·»åŠ  Todo&#39;),                  contentPadding: const EdgeInsets.all(24.0),                  children: &lt;Widget&gt;[                    Form(                      key: _formKey,                      child: Column(                        children: &lt;Widget&gt;[                          TextFormField(                            autofocus: true,                            autovalidate: false,                            controller: _controller,                            keyboardType: TextInputType.text,                            decoration: InputDecoration(                              border: OutlineInputBorder(),                              labelText: &#39;è¾“å…¥ä½ æƒ³åšçš„äº‹&#39;,                            ),                            validator: (val) {                              if (val.isEmpty) {                                return &#39;æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º&#39;;                              }                              bool isExist = todos.isTodoExist(val);                              if (isExist) {                                return &#39;è¿™ä»¶äº‹æƒ…å·²ç»å­˜åœ¨äº†&#39;;                              }                              return null;                            },                          ),                          SizedBox(height: 20),                          Row(                            mainAxisAlignment: MainAxisAlignment.end,                            children: &lt;Widget&gt;[                              FlatButton(                                child: Text(&#39;å–æ¶ˆ&#39;),                                onPressed: () {                                  Navigator.pop(context);                                },                              ),                              RaisedButton(                                child: Text(                                  &#39;ç¡®å®š&#39;,                                  style: TextStyle(color: Colors.white),                                ),                                color: Theme.of(context).primaryColor,                                onPressed: () {                                  final isValid =                                      _formKey.currentState.validate();                                  if (!isValid) {                                    return;                                  }                                  final thing = _controller.value.text;                                  todos.addTodo(Todo(                                    thing: thing,                                    finish: false,                                  ));                                  _controller.clear();                                  Navigator.pop(context);                                },                              )                            ],                          ),                        ],                      ),                    ),                  ],                );              },            );          },        );      },    );  }}</code></pre><img src="https://github.com/xrr2016/flutter_provider_todos/raw/master/add-todo.png" width="360" style="max-width:360px"><p>ç¼–è¾‘ Todo æŒ‰é’®</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;../store/todos.dart&#39;;class EditTodoButton extends StatefulWidget {  final todoIndex;  const EditTodoButton({Key key, this.todoIndex}) : super(key: key);  @override  _EditTodoButtonState createState() =&gt; _EditTodoButtonState();}class _EditTodoButtonState extends State&lt;EditTodoButton&gt; {  final _formKey = GlobalKey&lt;FormState&gt;();  @override  void dispose() {    _formKey?.currentState?.dispose();    super.dispose();  }  @override  Widget build(BuildContext context) {    return Consumer&lt;Todos&gt;(      builder: (context, todos, child) {        final todoIndex = widget.todoIndex;        final Todo todo = todos.items[todoIndex];        return IconButton(          color: Colors.blue,          icon: Icon(Icons.edit),          onPressed: () {            return showDialog(              context: context,              builder: (context) {                return SimpleDialog(                  title: Text(&#39;ç¼–è¾‘ Todo&#39;),                  contentPadding: const EdgeInsets.all(24.0),                  children: &lt;Widget&gt;[                    Form(                      key: _formKey,                      child: Column(                        children: &lt;Widget&gt;[                          TextFormField(                            autofocus: false,                            autovalidate: false,                            initialValue: todo.thing,                            decoration: InputDecoration(                              border: OutlineInputBorder(),                              labelText: &#39;è¾“å…¥ä½ æƒ³åšçš„äº‹&#39;,                            ),                            onChanged: (val) {                              todo.thing = val;                            },                            validator: (val) {                              if (val.isEmpty) {                                return &#39;æƒ³åšçš„äº‹ä¸èƒ½ä¸ºç©º&#39;;                              }                              return null;                            },                          ),                          SizedBox(height: 20),                          SwitchListTile(                            title: const Text(&#39;æ˜¯å¦å®Œæˆ&#39;),                            value: todo.finish,                            onChanged: (bool value) {                              todo.finish = value;                            },                          ),                          SizedBox(height: 20),                          Row(                            mainAxisAlignment: MainAxisAlignment.end,                            children: &lt;Widget&gt;[                              FlatButton(                                child: Text(&#39;å–æ¶ˆ&#39;),                                onPressed: () =&gt; Navigator.pop(context),                              ),                              RaisedButton(                                child: Text(                                  &#39;ç¡®å®š&#39;,                                  style: TextStyle(color: Colors.white),                                ),                                color: Theme.of(context).primaryColor,                                onPressed: () {                                  final isValid =                                      _formKey.currentState.validate();                                  if (!isValid) {                                    return;                                  }                                  Navigator.pop(context);                                  todos.editTodo(                                    todoIndex,                                    todo.thing,                                    todo.finish,                                  );                                },                              )                            ],                          ),                        ],                      ),                    ),                  ],                );              },            );          },        );      },    );  }}</code></pre><img src="https://github.com/xrr2016/flutter_provider_todos/raw/master/edit-todo.png" width="360" style="max-width:360px"><p>åˆ é™¤ Todo æŒ‰é’®</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:provider/provider.dart&#39;;import &#39;../store/todos.dart&#39;;class RemoveTodoButton extends StatelessWidget {  final int todoIndex;  const RemoveTodoButton({Key key, this.todoIndex}) : super(key: key);  @override  Widget build(BuildContext context) {    return Consumer&lt;Todos&gt;(builder: (_, todos, child) {      final Todo todo = todos.items[todoIndex];      return IconButton(        color: Colors.red,        icon: Icon(Icons.delete),        onPressed: () {          print(&#39;delete todo&#39;);          showDialog(            context: context,            builder: (BuildContext context) {              return AlertDialog(                title: Text(&#39;ç¡®è®¤åˆ é™¤ ${todo.thing}?&#39;),                actions: &lt;Widget&gt;[                  FlatButton(                    child: Text(                      &#39;å–æ¶ˆ&#39;,                      style: TextStyle(color: Colors.grey),                    ),                    onPressed: () =&gt; Navigator.pop(context),                  ),                  FlatButton(                    child: Text(&#39;ç¡®è®¤&#39;),                    onPressed: () {                      todos.removeTodo(todoIndex);                      Navigator.pop(context);                    },                  ),                ],              );            },          );        },      );    });  }}</code></pre><img src="https://github.com/xrr2016/flutter_provider_todos/raw/master/remove-todo.png" width="360" style="max-width:360px"><p>å¯ä»¥çœ‹åˆ°è¦ä½¿ç”¨å¯¹åº”çš„æ–¹æ³•éœ€è¦çš„åªæ˜¯å‘å¯¹åº”çš„éƒ¨ä»¶æ³¨å…¥è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨å°±å¯ä»¥äº†</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä½¿ç”¨äº† provider åï¼Œæ•°æ®ä»¥åŠå¯¹ä¸€ä¸ª Todo çš„æ“ä½œéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢äº†ï¼Œä¸ç”¨åœ¨å¤šä¸ªå±‚çº§é—´ä¼ é€’æ•°æ®ï¼Œå¹¶ä¸”åœ¨æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°äº† UIï¼Œæ‰€ä»¥æ˜¯ååˆ†æœ‰å¿…è¦çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€ä¸ªåº”ç”¨å†…é€šå¸¸ä¼šæœ‰ä¸¤ç§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨çš„ä½¿ç”¨çš„ä¸´æ—¶æ€§æ•°æ®ä»¥åŠå¾ˆå¤šéƒ¨ä»¶ä½¿ç”¨çš„å…¨å±€æ€§æ•°æ®ï¼Œéƒ¨ä»¶å†…éƒ¨ä½¿ç”¨çš„æ•°æ®å¯ä»¥é€šè¿‡ StatefulWidget æ¥ç®¡ç†ï¼Œä½†æ˜¯å…¨å±€æ€§çš„æ•°æ®å¦‚æœé€šè¿‡ä»ä¸Šåˆ°ä¸‹ä¼ é€’çš„æ–¹å¼ä¼šä½¿ä»£ç å†™çš„ååˆ†ç¹çï¼Œè¿™æ—¶å°±éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·æ¥è¿›è¡Œç®¡ç†äº†ï¼Œæœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨ Provider æ¥ç®¡ç†è¿™ç§åº”ç”¨çš„å…¨å±€æ€§çš„æ•°æ®&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹å“ˆå¸Œè¡¨</title>
    <link href="https://coldstone.fun/post/2019/09/08/dsa-hash/"/>
    <id>https://coldstone.fun/post/2019/09/08/dsa-hash/</id>
    <published>2019-09-08T08:26:45.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿçš„æ’å…¥å’Œå–ç”¨ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®æ•ˆç‡ä½ä¸‹</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿçš„æ’å…¥å’Œå–ç”¨ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®æ•ˆç‡ä½ä¸‹ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>åŸºäºæ•°ç»„å®ç°å“ˆå¸Œè¡¨ï¼Œæ•°ç»„çš„é•¿åº¦æ˜¯é¢„å…ˆè®¾å®šçš„ï¼Œæœ‰éœ€è¦æ˜¯å¢åŠ ã€‚æœ€å¸¸è§çš„æ˜¯å°†æ•°ç»„çš„é•¿åº¦è®¾ä¸ºä¸€ä¸ªè´¨æ•°</p><pre><code class="ts">class HashTable {  table = &lt;any&gt;[]  constructor() {    this.table = Array.from({      length: 137    })  }  // å°†å­—ç¬¦ä¸²çš„ ASCLL ç ç›¸åŠ å¯¹æ•°ç»„é•¿åº¦æ±‚ä½™  hash(data: string) {    let total = 0    for (let index = 0; index &lt; data.length; index++) {      total += data.charCodeAt(index)    }    return total % this.table.length  }  // æ›´ä¼˜çš„ hash æ–¹æ³•  betterHash(data: string) {    const H = 37    let total = 0    for (let index = 0; index &lt; data.length; index++) {      total += H * total + data.charCodeAt(index)    }    total = total % this.table.length    if (total &lt; 0) {      total += this.table.length - 1    }    return parseInt(total.toString())  }  // å­˜å‚¨æ•°æ®  put(key: string, data: any) {    const pos = this.betterHash(key)    this.table[pos] = data  }  // è·å–æ•°æ®  get(key: string) {    return this.table[this.betterHash(key)]  }  // æ˜¾ç¤ºæ•°æ®  show() {    for (let index = 0; index &lt; this.table.length; index++) {      const item = this.table[index]      if (item) {        console.log(`${index}: ${item}`)      }    }  }}</code></pre><p>æµ‹è¯•ä¸‹</p><pre><code class="ts">const hashTable = new HashTable()hashTable.put(&#39;David&#39;, &#39;David&#39;)hashTable.put(&#39;Jennifer&#39;, &#39;Jennifer&#39;)hashTable.put(&#39;Donnie&#39;, &#39;Donnie&#39;)hashTable.put(&#39;Raymond&#39;, &#39;Raymond&#39;)hashTable.put(&#39;Cynthia&#39;, &#39;Cynthia&#39;)hashTable.put(&#39;Mike&#39;, &#39;Mike&#39;)hashTable.put(&#39;Clayton&#39;, &#39;Clayton&#39;)hashTable.put(&#39;Danny&#39;, &#39;Danny&#39;)hashTable.put(&#39;Jonathan&#39;, &#39;Jonathan&#39;)hashTable.show()console.log(&#39;Jonathan: &#39;, hashTable.get(&#39;Jonathan&#39;))</code></pre><p>è¾“å‡º</p><pre><code class="ts">12: Jennifer22: Raymond55: Donnie58: Clayton80: Jonathan82: Mike103: Cynthia110: DannyJonathan:  Jonathan</code></pre><h2 id="ç¢°æ’å¤„ç†"><a href="#ç¢°æ’å¤„ç†" class="headerlink" title="ç¢°æ’å¤„ç†"></a>ç¢°æ’å¤„ç†</h2><p>å½“å“ˆå¸Œæ–¹æ³•å¯¹äºå¤šä¸ªè¾“å…¥äº§ç”Ÿäº†ç›¸åŒçš„è¾“å‡ºæ˜¯å°±ä¼šå‡ºç°ç¢°æ’ï¼Œä¸¤ç§å¯ä»¥è§£å†³é”®çš„ç¢°æ’é—®é¢˜å¼€é“¾æ³•ä»¥åŠçº¿æ€§æ¢æµ‹æ³•</p><p>å¼€é“¾æ³•</p><p>å¼€é“¾æ³•æŒ‡çš„æ˜¯åœ¨å®ç° hash è¡¨çš„åº•å±‚æ•°ç»„ä¸­ï¼Œæ¯ä¸ªæ•°ç»„åˆæ˜¯ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å¦ä¸€ä¸ªæ•°ç»„ï¼Œè¿™æ ·å³ä½¿æœ‰ä¸¤ä¸ªé”® hash åçš„å€¼ç›¸åŒï¼Œä¾ç„¶è¢«ä¿å­˜åœ¨åŒæ ·çš„ä½ç½®ï¼Œä½†æ˜¯ä»–ä»¬åœ¨ç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„ä½ç½®æ˜¯ä¸åŒçš„ã€‚</p><p>è¦å®ç°å¼€é“¾æ³•ï¼Œåœ¨åˆ›å»ºå­˜å‚¨é”®å€¼çš„æ•°ç»„æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç„¶åå°†è¯¥æ•°ç»„èµ‹å€¼ç»™ hash è¡¨é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œåˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚</p><p>çº¿æ€§æ¢æµ‹æ³•</p><p>çº¿æ€§æ¢æµ‹æ³•æŒ‡çš„æ˜¯å½“å‘ç”Ÿç¢°æ’æ—¶æ£€æŸ¥ hash è¡¨é‡Œçš„ä¸‹ä¸€ä¸ªä½ç½®æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±å°†æ•°æ®å­˜å…¥è¯¥ä½ç½®ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºä½å­ä¸ºæ­¢ã€‚é€šå¸¸æ¥è¯´å¦‚æœæ•°ç»„çš„å¤§å°æ˜¯å¾…å­˜å‚¨æ•°æ®ä¸ªæ•°çš„ 1.5 å€æ—¶ï¼Œé‚£ä¹ˆç”¨å¼€é“¾æ³•ï¼›å¦‚æœæ•°ç»„çš„å¤§å°æ˜¯å¾…å­˜å‚¨çš„æ•°æ®ä¸¤å€ä»¥ä¸Šæ—¶ï¼Œé‚£ä¹ˆä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿçš„æ’å…¥å’Œå–ç”¨ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®æ•ˆç‡ä½ä¸‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Egg.js ä¸­ä½¿ç”¨ Redis ç¼“å­˜æå‡æ€§èƒ½</title>
    <link href="https://coldstone.fun/post/2019/08/31/egg-redis-cache/"/>
    <id>https://coldstone.fun/post/2019/08/31/egg-redis-cache/</id>
    <published>2019-08-31T05:20:56.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>Redis æ˜¯ä¸€æ¬¾å¼€æºçš„ï¼ŒåŸºäº BSD è®¸å¯çš„ï¼Œé«˜çº§é”®å€¼ç¼“å­˜å’Œå­˜å‚¨ç³»ç»Ÿã€‚Redis çš„é”®åŒ…æ‹¬ stringï¼Œhashï¼Œlistï¼Œsetï¼Œsorted setï¼Œbitmap å’Œ hyperloglogã€‚ä½ å¯ä»¥åœ¨è¿™äº›ç±»å‹ä¸Šé¢è¿è¡ŒåŸå­æ“ä½œï¼Œä¾‹å¦‚ï¼Œè¿½åŠ å­—ç¬¦ä¸²ï¼Œå¢åŠ å“ˆå¸Œä¸­çš„å€¼ï¼ŒåŠ å…¥ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨ï¼Œè®¡ç®—é›†åˆçš„äº¤é›†ã€å¹¶é›†å’Œå·®é›†ï¼Œæˆ–è€…æ˜¯ä»æœ‰åºé›†åˆä¸­è·å–æœ€é«˜æ’åçš„å…ƒç´ ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Redis æ˜¯ä¸€æ¬¾å¼€æºçš„ï¼ŒåŸºäº BSD è®¸å¯çš„ï¼Œé«˜çº§é”®å€¼ç¼“å­˜å’Œå­˜å‚¨ç³»ç»Ÿã€‚Redis çš„é”®åŒ…æ‹¬ stringï¼Œhashï¼Œlistï¼Œsetï¼Œsorted setï¼Œbitmap å’Œ hyperloglogã€‚ä½ å¯ä»¥åœ¨è¿™äº›ç±»å‹ä¸Šé¢è¿è¡ŒåŸå­æ“ä½œï¼Œä¾‹å¦‚ï¼Œè¿½åŠ å­—ç¬¦ä¸²ï¼Œå¢åŠ å“ˆå¸Œä¸­çš„å€¼ï¼ŒåŠ å…¥ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨ï¼Œè®¡ç®—é›†åˆçš„äº¤é›†ã€å¹¶é›†å’Œå·®é›†ï¼Œæˆ–è€…æ˜¯ä»æœ‰åºé›†åˆä¸­è·å–æœ€é«˜æ’åçš„å…ƒç´ ã€‚</p><p>è¦åœ¨ Egg.js ä¸­ä½¿ç”¨ redisï¼Œåªéœ€è¦æ‰§è¡Œ <code>npm i redis</code> å‘½ä»¤å³å¯ã€‚</p><p>é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥éªŒè¯ä¸€ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªå¯ä»¥è¿”å›å¼€æºä»“åº“åœ¨ Github ä¸Šçš„ star æ•°é‡çš„æ•°æ®æ¥å£ï¼Œæ¥æµ‹è¯•ä½¿ç”¨ Redis åå¸¦æ¥çš„æå‡ï¼Œä»£ç åœ°å€: <a href="https://github.com/xrr2016/egg-redis-test" target="_blank" rel="noopener">https://github.com/xrr2016/egg-redis-test</a></p><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p>é¦–å…ˆä½¿ç”¨ Egg.js åˆ›å»ºä¸€ä¸ªé¡¹ç›®</p><pre><code class="bash">mkdir egg-redis-test &amp;&amp; cd egg-redis-testnpm init egg --type=simplenpm i</code></pre><p>å®‰è£… redis</p><pre><code class="sh">npm i redis</code></pre><p>å¯åŠ¨é¡¹ç›®</p><pre><code class="bash">npm run devopen http://localhost:7001</code></pre><p>å…ˆåˆ›å»º controller å’Œ service ç›®å½•ï¼Œç”¨æ¥æ”¾å¤„ç†è¯·æ±‚å’Œè¿”å›æ•°æ®çš„æ–¹æ³•ï¼Œå®Œæˆåçš„é¡¹ç›®ç›®å½•ä¸º</p><p><img src="/images/egg-folder.jpg" alt="folder"></p><p>ä¿®æ”¹ router.js æ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±ï¼Œç„¶ååœ¨ controller/home.js æ–‡ä»¶å®ç° stars æ–¹æ³•</p><pre><code class="js">&#39;use strict&#39;module.exports = app =&gt; {  const { router, controller } = app  router.get(&#39;/&#39;, controller.home.index)  router.get(&#39;/stars&#39;, controller.home.stars)}</code></pre><p>ä¿®æ”¹ controller/home.js æ–‡ä»¶ï¼Œæ¥æ”¶è¯·æ±‚ä¼ è¿‡æ¥çš„ query å‚æ•°å‘ä¸‹ä¼ ç»™ stars service è¿”å›ç»“æœ</p><pre><code class="js">&#39;use strict&#39;const Controller = require(&#39;egg&#39;).Controllerclass HomeController extends Controller {  async stars() {    const { ctx, service } = this    const { owner, name } = ctx.query    ctx.body = await service.home.stars(owner, name)  }}module.exports = HomeController</code></pre><p>åœ¨ service/home.js é‡Œå®ç° stars æ–¹æ³•ï¼Œéœ€è¦åšçš„å°±æ˜¯é€šè¿‡ controller ä¼ è¿‡æ¥çš„ owner, name å‚æ•°ï¼Œè¯·æ±‚ Github çš„æ¥å£ï¼Œè¿”å›æ•°æ®ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè¯·æ±‚çš„æ˜¯ Github çš„ graphql æ¥å£ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦åœ¨ Github ä¸Šæ–°å»ºä¸€ä¸ª tokenï¼Œtoken ä¸èƒ½ç›´æ¥å†™åœ¨ä»£ç é‡Œé¢ï¼Œéœ€è¦å°† token æ”¾åœ¨ç¯å¢ƒå˜é‡é‡Œï¼Œå¦åˆ™ä»£ç æäº¤åˆ° Github åä¼šå¤±æ•ˆã€‚</p><p><img src="/images/redis-token.jpg" alt="token"></p><p>åˆ›å»º token åä½¿ç”¨ <a href="https://github.com/motdotla/dotenv#readme" target="_blank" rel="noopener">dotenv</a> ä¿å­˜ç¯å¢ƒå˜é‡ï¼Œå…ˆå®‰è£…ç„¶ååœ¨é¡¹ç›®ç›®å½•åˆ›å»ºä¸€ä¸ª .env æ–‡ä»¶</p><pre><code class="bash">npm i dotenv</code></pre><p><img src="/images/env.jpg" alt="token"></p><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨ egg.js è‡ªå¸¦çš„ crul æ–¹æ³•å‘ Github æ¥å£å‘é€ post è¯·æ±‚ï¼Œä»£ç å¦‚ä¸‹</p><pre><code class="js">&#39;use strict&#39;require(&#39;dotenv&#39;).config()const Service = require(&#39;egg&#39;).Serviceclass HomeService extends Service {  async stars(owner, name) {    function setResponse(name, stars) {      return { msg: `${name} has ${stars} stars.` }    }    const query = `      query {        repository(owner: ${owner}, name: ${name}) {          stargazers {            totalCount          }        }      }    `    const result = await this.ctx.curl(&#39;https://api.github.com/graphql&#39;, {      method: &#39;POST&#39;,      dataType: &#39;json&#39;,      headers: {        Authorization: `token ${process.env.TOKEN}`      },      data: JSON.stringify({ query }),      timeout: 10000    })    const data = result.data.data    return setResponse(name, data.repository.stargazers.totalCount)  }}module.exports = HomeService</code></pre><p>ä½¿ç”¨ postman æµ‹è¯•ä¸€ä¸‹æ¥å£</p><p><img src="/images/redis-before.jpg" alt="folder"></p><p>è€—æ—¶å¹³å‡ 1 ç§’å·¦å³ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨ Redis æ·»åŠ ç¼“å­˜ï¼Œé¦–å…ˆéœ€è¦åœ¨æœ¬åœ°å®‰è£… Redisï¼Œå‚è€ƒ <a href="https://redis.io/download" target="_blank" rel="noopener">Redis download</a>ï¼ŒMac å¯ä»¥ç›´æ¥ä½¿ç”¨ homebrew å®‰è£…</p><p>å®‰è£…</p><pre><code class="bash">brew install redis</code></pre><p>å¯åŠ¨</p><pre><code class="bash">redis-server /usr/local/etc/redis.conf</code></pre><p>è¿›å…¥ redis å‘½ä»¤è¡Œ</p><pre><code class="bash">redis-cli</code></pre><p>ç¼“å­˜çš„ä¸»è¦é€»è¾‘å°±æ˜¯ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚å®Œå¾—åˆ° Github çš„æ•°æ®å°†æ•°æ®æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå†æ¬¡è¯·æ±‚çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä¹Ÿéœ€è¦ç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œ<br>éœ€è¦ä»ç¯å¢ƒå˜é‡ä¸­æ‹¿åˆ° tokenï¼Œpost è¯·æ±‚çš„æ•°æ®è¦ç”¨ JSON.stringify æ–¹æ³•ä¼ ç»™ Github æ¥å£ï¼Œå¦åˆ™å‡ºç°è§£æé”™è¯¯ï¼Œä»£ç å¦‚ä¸‹</p><pre><code class="js">&#39;use strict&#39;require(&#39;dotenv&#39;).config()const redis = require(&#39;redis&#39;)const { promisify } = require(&#39;util&#39;)const Service = require(&#39;egg&#39;).Serviceconst REDIS_PORT = process.env.PORT || 6379const client = redis.createClient(REDIS_PORT)const getAsync = promisify(client.get).bind(client)const setexAsync = promisify(client.setex).bind(client)class HomeService extends Service {  async stars(owner, name) {    const key = `${owner}/${name}`    const stars = await getAsync(key)    function setResponse(name, stars) {      return { msg: `${name} has ${stars} stars.` }    }    if (stars !== null) {      return setResponse(name, stars)    }    const query = `      query {        repository(owner: ${owner}, name: ${name}) {          stargazers {            totalCount          }        }      }    `    const result = await this.ctx.curl(&#39;https://api.github.com/graphql&#39;, {      method: &#39;POST&#39;,      dataType: &#39;json&#39;,      headers: {        Authorization: `token ${process.env.TOKEN}`      },      data: JSON.stringify({ query }),      timeout: 10000    })    const data = result.data.data    await setexAsync(key, 10, data.repository.stargazers.totalCount)    return setResponse(name, data.repository.stargazers.totalCount)  }}module.exports = HomeService</code></pre><p>å†æ¬¡æµ‹è¯•ï¼Œé¦–å…ˆæŠŠ Redis é‡Œé¢çš„ç¼“å­˜æ¸…ç©ºï¼Œä½¿ç”¨ Redis çš„å‘½ä»¤è¡Œè¿è¡Œ</p><pre><code class="bash">FLUSHALL</code></pre><p>å‘é€è¯·æ±‚ï¼Œç¬¬ä¸€æ¬¡çš„è€—æ—¶è¿˜æ˜¯ä¸€ç§’å¤šï¼Œç„¶ååœ¨å¤±æ•ˆæ—¶é—´å†…è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨ç¼“å­˜çš„æ•°æ®åè€—æ—¶å¤§å¤§å‡å°‘äº†ï¼Œæ€§èƒ½æå‡æ•ˆæœæ˜¾è‘—ï¼Œå®é™…é¡¹ç›®å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒé•¿çš„ç¼“å­˜å¤±æ•ˆæ—¶é—´</p><p><img src="/images/redis-after.jpg" alt="folder"></p><p>å½“ç„¶ç¼“å­˜è¿‡æœŸååˆè¦é‡æ–°å‘ Github å‘é€è¯·æ±‚äº†ï¼Œå› ä¸º Redis å·²ç»æŠŠæ•°æ®åˆ é™¤äº†</p><p><img src="/images/redis-vue.jpg" alt="folder"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://redis.io/documentation" target="_blank" rel="noopener">Redis documentation</a></p><p><a href="https://github.com/noderedis/node_redis" target="_blank" rel="noopener">Node Redis</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Redis æ˜¯ä¸€æ¬¾å¼€æºçš„ï¼ŒåŸºäº BSD è®¸å¯çš„ï¼Œé«˜çº§é”®å€¼ç¼“å­˜å’Œå­˜å‚¨ç³»ç»Ÿã€‚Redis çš„é”®åŒ…æ‹¬ stringï¼Œhashï¼Œlistï¼Œsetï¼Œsorted setï¼Œbitmap å’Œ hyperloglogã€‚ä½ å¯ä»¥åœ¨è¿™äº›ç±»å‹ä¸Šé¢è¿è¡ŒåŸå­æ“ä½œï¼Œä¾‹å¦‚ï¼Œè¿½åŠ å­—ç¬¦ä¸²ï¼Œå¢åŠ å“ˆå¸Œä¸­çš„å€¼ï¼ŒåŠ å…¥ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨ï¼Œè®¡ç®—é›†åˆçš„äº¤é›†ã€å¹¶é›†å’Œå·®é›†ï¼Œæˆ–è€…æ˜¯ä»æœ‰åºé›†åˆä¸­è·å–æœ€é«˜æ’åçš„å…ƒç´ ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Redis" scheme="https://coldstone.fun/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹å­—å…¸</title>
    <link href="https://coldstone.fun/post/2019/08/28/dsa-dictionary/"/>
    <id>https://coldstone.fun/post/2019/08/28/dsa-dictionary/</id>
    <published>2019-08-28T13:09:13.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>å­—å…¸æ˜¯ä¸€ç§ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œé”®ç”¨æ¥æŸ¥æ‰¾ï¼Œå€¼ç”¨æ¥ä¿å­˜æ•°æ®</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­—å…¸æ˜¯ä¸€ç§ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œé”®ç”¨æ¥æŸ¥æ‰¾ï¼Œå€¼ç”¨æ¥ä¿å­˜æ•°æ®</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><pre><code class="ts">class Dictionary {  data: any[] = []  // æ·»åŠ å…ƒç´   add(key: any, value: any) {    this.data[key] = value  }  // æŸ¥æ‰¾å…ƒç´   find(key: any) {    return this.data[key]  }  // åˆ é™¤å…ƒç´   remove(key: any) {    delete this.data[key]  }  // æ˜¾ç¤ºå…ƒç´   show() {    Object.entries(this.data).forEach(item =&gt; {      console.log(&#39;key:&#39;, item[0], &#39; value:&#39;, item[1])    })  }  // å…ƒç´ ä¸ªæ•°  count() {    let n = 0    Object.keys(this.data).forEach(_ =&gt; {      n += 1    })    return n  }  // æ¸…ç©ºå…ƒç´   clear() {    Object.keys(this.data).forEach((key: any) =&gt; {      delete this.data[key]    })  }}</code></pre><p>æµ‹è¯•</p><pre><code class="ts">const dictionary = new Dictionary()dictionary.add(&#39;a&#39;, &#39;a&#39;)dictionary.add(&#39;b&#39;, &#39;b&#39;)dictionary.add(&#39;c&#39;, &#39;c&#39;)dictionary.add(&#39;d&#39;, &#39;d&#39;)dictionary.add(&#39;e&#39;, &#39;e&#39;)dictionary.show()console.log(&#39;count: &#39;, dictionary.count())dictionary.clear()console.log(&#39;clear: &#39;, dictionary.count())</code></pre><p>è¾“å‡º</p><pre><code class="textmate">key: a  value: akey: b  value: bkey: c  value: ckey: d  value: dkey: e  value: ecount:  5clear:  0</code></pre><p>æ’åºå­—å…¸çš„è¾“å‡ºï¼Œéœ€è¦é‡æ–°å®šä¹‰ show æ–¹æ³•</p><pre><code class="ts">// æ˜¾ç¤ºå…ƒç´ show() {  Object.entries(this.data)    .sort()    .forEach(item =&gt; {      console.log(&#39;key:&#39;, item[0], &#39; value:&#39;, item[1])    })}</code></pre><p>æµ‹è¯•ä¸€ä¸‹</p><pre><code class="ts">const dictionary = new Dictionary()dictionary.add(&#39;c&#39;, &#39;c&#39;)dictionary.add(&#39;a&#39;, &#39;a&#39;)dictionary.add(&#39;d&#39;, &#39;d&#39;)dictionary.add(&#39;e&#39;, &#39;e&#39;)dictionary.add(&#39;b&#39;, &#39;b&#39;)dictionary.show()</code></pre><p>è¾“å‡º</p><pre><code class="textmate">key: a  value: akey: b  value: bkey: c  value: ckey: d  value: dkey: e  value: e</code></pre><p>ä½¿ç”¨ Object.keys æ–¹æ³•æ‹¿åˆ°å­—å…¸çš„ keys æ•°ç»„åï¼Œåœ¨ç”¨ sort æ–¹æ³•å°±å¯ä»¥æ˜¾ç¤ºæœ‰åºçš„å­—å…¸è¾“å‡ºäº†</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­—å…¸æ˜¯ä¸€ç§ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œé”®ç”¨æ¥æŸ¥æ‰¾ï¼Œå€¼ç”¨æ¥ä¿å­˜æ•°æ®&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹é“¾è¡¨</title>
    <link href="https://coldstone.fun/post/2019/08/25/dsa-linklist/"/>
    <id>https://coldstone.fun/post/2019/08/25/dsa-linklist/</id>
    <published>2019-08-25T04:49:36.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>é“¾è¡¨æ˜¯ä¸€ç»„èŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘èŠ‚ç‚¹çš„å¼•ç”¨å«åšé“¾</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é“¾è¡¨æ˜¯ä¸€ç»„èŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘èŠ‚ç‚¹çš„å¼•ç”¨å«åšé“¾ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ä½¿ç”¨ LinkedListNode ç±»æ¥è¡¨ç¤ºèŠ‚ç‚¹ï¼Œä½¿ç”¨ LinkedList æ¥è¡¨ç¤ºé“¾è¡¨</p><pre><code class="ts">class LinkedListNode {  element: any  next: LinkedListNode  constructor(element: any) {    this.element = element    this.next = null  }}class LinkedList {  // å¤´èŠ‚ç‚¹  head: LinkedListNode  constructor() {    this.head = new LinkedListNode(&#39;head&#39;)  }  // æŸ¥æ‰¾  find(element: any) {    let currentNode: LinkedListNode = this.head    while (currentNode.element !== element) {      currentNode = currentNode.next    }    return currentNode  }  // æ’å…¥  insert(element: any, item: any) {    let newNode = new LinkedListNode(element)    let currentNode = this.find(item)    newNode.next = currentNode.next    currentNode.next = newNode  }  // ç§»é™¤  remove(element: any) {    let prevNode = this.findPrevNode(element)    if (!(prevNode.next === null)) {      prevNode.next = prevNode.next.next    }  }  //  findPrevNode(element: any) {    let currentNode = this.head    while (      !(currentNode.next === null) &amp;&amp;      currentNode.next.element !== element    ) {      currentNode = currentNode.next    }    return currentNode  }  // æ˜¾ç¤º  display() {    let currentNode = this.head    while (!(currentNode.next === null)) {      console.log(currentNode.next.element)      currentNode = currentNode.next    }  }}</code></pre><p>æµ‹è¯•</p><pre><code class="ts">const foods = new LinkedList()foods.insert(&#39;eggs&#39;, &#39;head&#39;)foods.insert(&#39;apple&#39;, &#39;eggs&#39;)foods.insert(&#39;bread&#39;, &#39;apple&#39;)foods.insert(&#39;chese&#39;, &#39;bread&#39;)foods.insert(&#39;rice&#39;, &#39;chese&#39;)foods.display()console.log(&#39;------------&#39;)foods.remove(&#39;bread&#39;)foods.display()</code></pre><p>è¾“å‡º</p><pre><code class="json">eggsapplebreadcheserice------------eggsapplecheserice</code></pre><h2 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h2><p>è¦å®ç°åŒå‘é“¾è¡¨é¦–å…ˆè¦ä¸º LinkedListNode ç±»å¢åŠ ä¸€ä¸ª prev å±æ€§</p><pre><code class="ts">class LinkedListNode {  element: any  prev: LinkedListNode  next: LinkedListNode  constructor(element: any) {    this.element = element    this.prev = null    this.next = null  }}</code></pre><p>ç„¶åä¿®æ”¹ LinkedList ç±»çš„ insert, remove æ–¹æ³•</p><pre><code class="ts">class LinkedList {  // å¤´èŠ‚ç‚¹  head: LinkedListNode = new LinkedListNode(&#39;head&#39;)  // æŸ¥æ‰¾  find(element: any) {    let currentNode = this.head    while (currentNode.element !== element) {      currentNode = currentNode.next    }    return currentNode  }  // æ‰¾åˆ°æœ€åçš„èŠ‚ç‚¹  findLast() {    let currentNode = this.head    while (currentNode.next !== null) {      currentNode = currentNode.next    }    return currentNode  }  // æ’å…¥  insert(element: any, item: any) {    let newNode = new LinkedListNode(element)    let currentNode = this.find(item)    newNode.prev = currentNode    newNode.next = currentNode.next    currentNode.next = newNode  }  // ç§»é™¤  remove(element: any) {    let currentNode = this.find(element)    if (currentNode.next !== null) {      currentNode.prev.next = currentNode.next      currentNode.next.prev = currentNode.prev      currentNode.next = null      currentNode.prev = null    }  }  // æ˜¾ç¤º  display() {    let currentNode = this.head    while (!(currentNode.next === null)) {      console.log(currentNode.next.element)      currentNode = currentNode.next    }  }  // å€’å™æ˜¾ç¤º  displayReverse() {    let currentNode = this.findLast()    while (currentNode.prev !== null) {      console.log(currentNode.element)      currentNode = currentNode.prev    }  }}</code></pre><p>æµ‹è¯•ä¸€ä¸‹</p><pre><code class="ts">foods.insert(&#39;eggs&#39;, &#39;head&#39;)foods.insert(&#39;apple&#39;, &#39;eggs&#39;)foods.insert(&#39;bread&#39;, &#39;apple&#39;)foods.insert(&#39;chese&#39;, &#39;bread&#39;)foods.insert(&#39;rice&#39;, &#39;chese&#39;)foods.display()console.log(&#39;------------&#39;)foods.remove(&#39;bread&#39;)foods.display()console.log(&#39;------------&#39;)foods.displayReverse()</code></pre><p>è¾“å‡º</p><pre><code class="json">eggsapplebreadcheserice------------eggsapplecheserice------------ricecheseappleeggs</code></pre><h2 id="å¾ªç¯é“¾è¡¨"><a href="#å¾ªç¯é“¾è¡¨" class="headerlink" title="å¾ªç¯é“¾è¡¨"></a>å¾ªç¯é“¾è¡¨</h2><p>åˆ›å»ºå¾ªç¯é“¾è¡¨éœ€è¦è®©å®ƒçš„å¤´èŠ‚ç‚¹çš„ next å±æ€§æŒ‡å‘æœ¬èº«ï¼Œ ç„¶åä¿®æ”¹ display æ–¹æ³•</p><pre><code class="ts">this.head.next = this.head // æ˜¾ç¤ºdisplay() {  let currentNode = this.head  while (currentNode.next !== null &amp;&amp; currentNode.next.element !== &#39;head&#39;) {    console.log(currentNode.next.element)    currentNode = currentNode.next  }}</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é“¾è¡¨æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¦‚æœå‘ç°æ•°ç»„åœ¨ä½¿ç”¨æ—¶å¾ˆæ…¢ï¼Œå°±å¯ä»¥è€ƒè™‘ç”¨é“¾è¡¨æ›¿ä»£å®ƒï¼Œä½†æ˜¯å¦‚æœéœ€è¦å¯¹æ•°æ®éšæœºè®¿é—®ï¼Œæ•°ç»„ä»»ç„¶æ˜¯æ›´ä¼˜çš„é€‰æ‹©</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é“¾è¡¨æ˜¯ä¸€ç»„èŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘èŠ‚ç‚¹çš„å¼•ç”¨å«åšé“¾&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•åœ¨ Egg.js ä¸­ä½¿ç”¨ Sequelize çš„äº‹åŠ¡ Transaction</title>
    <link href="https://coldstone.fun/post/2019/08/22/egg-sequelize-transaction/"/>
    <id>https://coldstone.fun/post/2019/08/22/egg-sequelize-transaction/</id>
    <published>2019-08-22T06:07:14.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æŸ¥äº†å‡ é <a href="https://sequelize.org/" target="_blank" rel="noopener">Sequelize</a> å…³äº <a href="https://sequelize.org/master/manual/transactions.html" target="_blank" rel="noopener">Transactions</a> çš„æ–‡æ¡£ï¼Œçœ‹äº†å¤§ä½¬åŒäº‹çš„ä»£ç åï¼Œæˆ‘ç»ˆäºå¼„æ‡‚æ€ä¹ˆåœ¨ egg.js æ¡†æ¶é‡Œé¢ä½¿ç”¨äº‹åŠ¡äº† ğŸ˜“</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨æŸ¥äº†å‡ é <a href="https://sequelize.org/" target="_blank" rel="noopener">Sequelize</a> å…³äº <a href="https://sequelize.org/master/manual/transactions.html" target="_blank" rel="noopener">Transactions</a> çš„æ–‡æ¡£ï¼Œçœ‹äº†å¤§ä½¬åŒäº‹çš„ä»£ç åï¼Œæˆ‘ç»ˆäºå¼„æ‡‚æ€ä¹ˆåœ¨ egg.js æ¡†æ¶é‡Œé¢ä½¿ç”¨äº‹åŠ¡äº† ğŸ˜“</p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>Sequelize å…³äºäº‹åŠ¡çš„ç¤ºä¾‹ä»£ç æ˜¯è¿™æ ·æ»´ï¼Œé¦–å…ˆé€šè¿‡ <code>sequelize.transaction</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªäº‹åŠ¡åï¼ŒæŠŠè¿™ä¸ªäº‹åŠ¡ä¼ ç»™éœ€è¦è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œå¦‚æ–°å¢ç”¨æˆ·ï¼Œç»™ç”¨æˆ·åŠ å±æ€§ç­‰ï¼Œä½†æ˜¯çœ‹ä¸Šå»ä»£ç æ¯”è¾ƒéš¾æ‡‚</p><pre><code class="js">return sequelize.transaction().then(t =&gt; {  return User.create(    {      firstName: &#39;Bart&#39;,      lastName: &#39;Simpson&#39;    },    { transaction: t }  )    .then(user =&gt; {      return user.addSibling(        {          firstName: &#39;Lisa&#39;,          lastName: &#39;Simpson&#39;        },        { transaction: t }      )    })    .then(() =&gt; {      return t.commit()    })    .catch(err =&gt; {      return t.rollback()    })})</code></pre><p>å®é™…ä½¿ç”¨çš„è¯éœ€è¦ç”¨ <code>async/await</code> è¯­æ³•è®©ä»£ç çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°ä¸€ç‚¹ï¼Œåœ¨ egg.js ä¸­ä½¿ç”¨çš„ç¤ºä¾‹å¦‚ä¸‹ï¼Œé¦–å…ˆéœ€è¦ç”¨å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„ model å¯¹è±¡ï¼ˆå°±æ˜¯å¯¹æ•°æ®è¡¨çš„æ˜ å°„å¯¹è±¡ï¼‰åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶ååœ¨ <code>try/catch</code> ä¸­æ‰§è¡Œæ‰€è¦è¿›è¡Œçš„æ“ä½œï¼Œå¦‚æœæ“ä½œæŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šå›æ»š</p><pre><code class="js">const transaction = await this.ctx.model.transaction()try {  await this.ctx.model.create(this.ctx.request.body, { transaction })  await this.ctx.service.user.find(userId, { transaction });  await this.ctx.service.product.destory(productId, { transaction });  ...  await transaction.commit()} catch (err) {  await transaction.rollback()  throw err}</code></pre><p>ç”¨äº† <code>async/await</code> è¯­æ³•ï¼Œä»£ç ç¡®å®æ¸…æ™°äº†å¾ˆå¤š</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨æŸ¥äº†å‡ é &lt;a href=&quot;https://sequelize.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Sequelize&lt;/a&gt; å…³äº &lt;a href=&quot;https://sequelize.org/master/manual/transactions.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Transactions&lt;/a&gt; çš„æ–‡æ¡£ï¼Œçœ‹äº†å¤§ä½¬åŒäº‹çš„ä»£ç åï¼Œæˆ‘ç»ˆäºå¼„æ‡‚æ€ä¹ˆåœ¨ egg.js æ¡†æ¶é‡Œé¢ä½¿ç”¨äº‹åŠ¡äº† ğŸ˜“&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Egg" scheme="https://coldstone.fun/tags/Egg/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹é˜Ÿåˆ—</title>
    <link href="https://coldstone.fun/post/2019/08/18/das-queue/"/>
    <id>https://coldstone.fun/post/2019/08/18/das-queue/</id>
    <published>2019-08-18T14:18:36.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>é˜Ÿåˆ—æ˜¯ä¸€ç§åˆ—è¡¨ï¼Œåªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ã€‚é˜Ÿåˆ—ç”¨äºå­˜å‚¨æŒ‰é¡ºåºæ’åˆ—çš„çš„æ•°æ®ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå¯ä»¥å°†é˜Ÿåˆ—æƒ³è±¡æˆåœ¨é¥­åº—æ’é˜Ÿå–é¤çš„äººç¾¤ï¼Œåœ¨é˜Ÿä¼å‰é¢çš„å…ˆå–é¤ï¼Œåæ¥çš„äººåå–é¤</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é˜Ÿåˆ—æ˜¯ä¸€ç§åˆ—è¡¨ï¼Œåªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ã€‚é˜Ÿåˆ—ç”¨äºå­˜å‚¨æŒ‰é¡ºåºæ’åˆ—çš„çš„æ•°æ®ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå¯ä»¥å°†é˜Ÿåˆ—æƒ³è±¡æˆåœ¨é¥­åº—æ’é˜Ÿå–é¤çš„äººç¾¤ï¼Œåœ¨é˜Ÿä¼å‰é¢çš„å…ˆå–é¤ï¼Œåæ¥çš„äººåå–é¤ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç”¨ TypeScript å®ç°é˜Ÿåˆ—</p><pre><code class="ts">class Queue {  data: Array&lt;any&gt; = []  // å…¥é˜Ÿ  enqueue(element: any) {    this.data.push(element)  }  // å‡ºé˜Ÿ  dequeue() {    return this.data.shift()  }  // è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´   front() {    return this.data[0]  }  // è¿”å›æœ€åä¸€ä¸ªå…ƒç´   back() {    return this.data[this.data.length - 1]  }  // æ˜¾ç¤ºé˜Ÿåˆ—ä¸­æ‰€æœ‰å…ƒç´   toString() {    return this.data.map(ele =&gt; `${ele}`).toString()  }  // åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º  empty() {    if (this.data.length) {      return false    }    return true  }}</code></pre><p>æµ‹è¯•ä¸€ä¸‹</p><pre><code class="ts">const queue = new Queue()queue.enqueue(&#39;a&#39;)queue.enqueue(&#39;b&#39;)queue.enqueue(&#39;c&#39;)queue.enqueue(&#39;d&#39;)queue.enqueue(&#39;e&#39;)console.log(&#39;queue: &#39;, queue)console.log(&#39;front: &#39;, queue.front())console.log(&#39;back: &#39;, queue.back())queue.dequeue()queue.dequeue()queue.dequeue()queue.dequeue()console.log(&#39;queue: &#39;, queue)console.log(&#39;queue: &#39;, queue.empty())</code></pre><p>è¾“å‡º</p><pre><code class="json">queue:  Queue { data: [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39; ] }front: aback:  equeue:  Queue { data: [ &#39;e&#39; ] }queue:  false</code></pre><h2 id="ä¼˜å…ˆé˜Ÿåˆ—"><a href="#ä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆé˜Ÿåˆ—"></a>ä¼˜å…ˆé˜Ÿåˆ—</h2><p>ä¼˜å…ˆé˜Ÿåˆ—æŒ‡çš„æ˜¯åœ¨åˆ é™¤é˜Ÿåˆ—ä¸­å…ƒç´ çš„æ—¶å€™éœ€è¦è€ƒè™‘å…ƒç´ çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å…ƒç´ å…ˆå‡ºé˜Ÿï¼Œä¼˜å…ˆçº§ä½çš„åå‡ºé˜Ÿï¼ŒåŒç­‰ä¼˜å…ˆçº§çš„å…ƒç´ æŒ‰åŸæœ¬çš„é¡ºåºå‡ºé˜Ÿã€‚</p><p>é¦–å…ˆéœ€è¦ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„å…ƒç´ </p><pre><code class="ts">interface Element {  data: any  code: number // code è¡¨ç¤ºä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œ0 ä¸ºæœ€é«˜}</code></pre><p>ç„¶åéœ€è¦ä¿®æ”¹ä¸‹é˜Ÿåˆ—çš„å‡ºé˜Ÿæ–¹æ³•ï¼Œæ‰¾åˆ°é˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼Œç„¶åå°†å…¶ç§»é™¤é˜Ÿåˆ—</p><pre><code class="ts">dequeue() {  const codes = this.data.map(ele =&gt; ele.code)  const minCode = Math.min.apply(null, codes)  const index = this.data.findIndex(ele =&gt; ele.code === minCode)  return this.data.splice(index, 1)}</code></pre><p>æµ‹è¯•ä¸€ä¸‹</p><pre><code class="ts">const queue = new Queue()queue.enqueue({ data: &#39;a&#39;, code: 5 })queue.enqueue({ data: &#39;b&#39;, code: 4 })queue.enqueue({ data: &#39;c&#39;, code: 3 })queue.enqueue({ data: &#39;d&#39;, code: 2 })queue.enqueue({ data: &#39;e&#39;, code: 1 })console.log(&#39;queue: &#39;, queue)queue.dequeue()queue.dequeue()queue.dequeue()queue.dequeue()console.log(&#39;queue: &#39;, queue)</code></pre><p>è¾“å‡º</p><pre><code class="json">queue:  Queue {  data:   [     { data: &#39;a&#39;, code: 5 },     { data: &#39;b&#39;, code: 4 },     { data: &#39;c&#39;, code: 3 },     { data: &#39;d&#39;, code: 2 },     { data: &#39;e&#39;, code: 1 }  ]}queue:  Queue {  data:    [      { data: &#39;a&#39;, code: 5 },      { data: &#39;b&#39;, code: 4 }    ]}</code></pre><p>å¯ä»¥çœ‹åˆ°é˜Ÿåˆ—ä¸­å‰©ä¸‹äº†ä¼˜å…ˆçº§è¾ƒä½çš„å…ƒç´ </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é˜Ÿåˆ—æ˜¯ä¸€ç§åˆ—è¡¨ï¼Œåªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ã€‚é˜Ÿåˆ—ç”¨äºå­˜å‚¨æŒ‰é¡ºåºæ’åˆ—çš„çš„æ•°æ®ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œå¯ä»¥å°†é˜Ÿåˆ—æƒ³è±¡æˆåœ¨é¥­åº—æ’é˜Ÿå–é¤çš„äººç¾¤ï¼Œåœ¨é˜Ÿä¼å‰é¢çš„å…ˆå–é¤ï¼Œåæ¥çš„äººåå–é¤&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº Flutter çš„å®‰å“æ‰“åŒ…</title>
    <link href="https://coldstone.fun/post/2019/08/14/flutter-android-build/"/>
    <id>https://coldstone.fun/post/2019/08/14/flutter-android-build/</id>
    <published>2019-08-14T01:56:55.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter åœ¨æ‰“åŒ…å®‰å“åº”ç”¨æ—¶æœ‰ä¸¤ç§æ–¹å¼ <code>flutter build apk</code> å’Œ <code>flutter build appbundle</code>ï¼Œæœ¬æ–‡è¯´ä¸‹è¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Flutter åœ¨æ‰“åŒ…å®‰å“åº”ç”¨æ—¶æœ‰ä¸¤ç§æ–¹å¼ <code>flutter build apk</code> å’Œ <code>flutter build appbundle</code>ï¼Œæœ¬æ–‡è¯´ä¸‹è¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><h2 id="Appbundle"><a href="#Appbundle" class="headerlink" title="Appbundle"></a>Appbundle</h2><p>Android App Bundle æ˜¯ä¸Šä¼ åˆ° Google Play ç”¨ä»¥æ”¯æŒ Dynamic Delivery çš„æ–‡ä»¶ï¼Œæ‰©å±•åä¸º .aabï¼Œä¸€ä¸ª bundle åŒ…å«æ‰€æœ‰åº”ç”¨çš„å·²ç¼–è¯‘ä»£ç å’Œèµ„æºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç”Ÿæˆ apk å’Œ Google Play çš„ç­¾åã€‚</p><p>Google Play çš„æ–°åº”ç”¨æœåŠ¡æ¨¡å¼ç§°ä¸º Dynamic Deliveryï¼ˆåŠ¨æ€ä¼ é€ï¼‰ï¼Œä½¿ç”¨ä½ çš„åº”ç”¨åŒ…ä¸ºæ¯ä¸ªç”¨æˆ·çš„è®¾å¤‡é…ç½®ç”Ÿæˆå¹¶æä¾›ä¼˜åŒ–çš„ APKï¼Œå› æ­¤ç”¨æˆ·åªä¸‹è½½è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä»£ç å’Œèµ„æºã€‚å¼€å‘è€…ä¸å†éœ€è¦æ„å»ºï¼Œç­¾åå’Œç®¡ç†å¤šä¸ª APK æ¥æ”¯æŒä¸åŒçš„è®¾å¤‡ï¼Œç”¨æˆ·å¯ä»¥è·å¾—æ›´å°ï¼Œæ›´ä¼˜åŒ–çš„ä¸‹è½½ã€‚</p><p><a href="https://developer.android.com/guide/app-bundle" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="Apk"><a href="#Apk" class="headerlink" title="Apk"></a>Apk</h2><p>å¦‚æœåº”ç”¨ä¸å‘å¸ƒåˆ° Google Playï¼Œåˆ™éœ€è¦å‘å¸ƒå¤šä¸ª apkï¼Œä½†å¿…é¡»è‡ªå·±æ„å»ºï¼Œç­¾åå’Œç®¡ç†æ¯ä¸ª apkã€‚</p><p>é€šå¸¸æ„å»ºä¸€ä¸ª apk ç”¨ä»¥æ”¯æŒæ‰€æœ‰ç›®æ ‡è®¾å¤‡ï¼Œä½†ç”±äºéœ€è¦æ”¯æŒå¤šä¸ªå±å¹•å¯†åº¦æˆ–åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´éå¸¸å¤§çš„ apkï¼Œå‡å°‘ apk å¤§å°çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºå¤šä¸ª apkï¼Œåœ¨æ‰§è¡Œ <code>flutter build apk</code> çš„æ—¶å€™å¯ä»¥æ·»åŠ æ„å»ºå‚æ•° <code>--target-platform android-arm,android-arm64 --split-per-abi</code>ï¼Œ è¿™æ ·æ„å»ºå‡ºæ¥çš„ apk åŒ…å«ç‰¹å®šå±å¹•å¯†åº¦æˆ– ABI çš„æ–‡ä»¶ã€‚</p><p><a href="https://developer.android.com/studio/build/configure-apk-splits" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flutter åœ¨æ‰“åŒ…å®‰å“åº”ç”¨æ—¶æœ‰ä¸¤ç§æ–¹å¼ &lt;code&gt;flutter build apk&lt;/code&gt; å’Œ &lt;code&gt;flutter build appbundle&lt;/code&gt;ï¼Œæœ¬æ–‡è¯´ä¸‹è¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹æ ˆ</title>
    <link href="https://coldstone.fun/post/2019/08/10/dsa-stack/"/>
    <id>https://coldstone.fun/post/2019/08/10/dsa-stack/</id>
    <published>2019-08-10T15:12:09.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>æ ˆæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºå®ƒåªèƒ½åœ¨æ ˆé¡¶æ·»åŠ æˆ–åˆ é™¤ï¼Œè¿™æ ·çš„æ“ä½œå¾ˆå¿«ï¼Œå®ƒæ˜¯è¢«ç§°ä¹‹ä¸ºåå…¥å…ˆå‡ºï¼ˆLIFOï¼Œlast in first outï¼‰çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥å°†æ ˆæƒ³è±¡æˆä¸€å è£…èœçš„ç›˜å­ï¼Œç”¨çš„æ—¶å€™å…ˆæ‹¿æœ€ä¸Šé¢çš„ï¼Œæ´—å¥½çš„ç›˜å­åˆä¼šæ”¾åˆ°æœ€ä¸Šé¢</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ ˆæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºå®ƒåªèƒ½åœ¨æ ˆé¡¶æ·»åŠ æˆ–åˆ é™¤ï¼Œè¿™æ ·çš„æ“ä½œå¾ˆå¿«ï¼Œå®ƒæ˜¯è¢«ç§°ä¹‹ä¸ºåå…¥å…ˆå‡ºï¼ˆLIFOï¼Œlast in first outï¼‰çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥å°†æ ˆæƒ³è±¡æˆä¸€å è£…èœçš„ç›˜å­ï¼Œç”¨çš„æ—¶å€™å…ˆæ‹¿æœ€ä¸Šé¢çš„ï¼Œæ´—å¥½çš„ç›˜å­åˆä¼šæ”¾åˆ°æœ€ä¸Šé¢ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç”¨ TypeScript å®ç°æ ˆ</p><pre><code class="ts">class Stack {  top: number = 0  data: Array&lt;any&gt; = []  get length() {    return this.top  }  // å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªæ–°å…ƒç´   push(element: any) {    this.data.push(element)    this.top += 1  }  // è¿”å›æ ˆé¡¶å…ƒç´ , åŒæ—¶å°† top å€¼å‡ 1  pop() {    this.top -= 1    return this.data.pop()  }  // è¿”å›æ ˆé¡¶å…ƒç´   peek() {    if (!this.data.length) {      return false    }    return this.data[this.top - 1]  }  // æ¸…ç©ºæ ˆ  clear() {    this.top = 0  }}</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre><code class="ts">const stack = new Stack()stack.push(&#39;aaa&#39;)stack.push(&#39;bbb&#39;)stack.push(&#39;ccc&#39;)stack.push(&#39;ddd&#39;)console.log(&#39;æ‰§è¡Œ push æ–¹æ³•å\n&#39;, stack)stack.pop()console.log(&#39;æ‰§è¡Œ pop æ–¹æ³•å\n&#39;, stack)console.log(&#39;æ‰§è¡Œ peek æ–¹æ³•åè¿”å›ï¼š&#39;, stack.peek())stack.clear()console.log(&#39;æ‰§è¡Œ clear æ–¹æ³•å\n&#39;, stack)æ‰§è¡Œ push æ–¹æ³•å Stack { data: [ &#39;aaa&#39;, &#39;bbb&#39;, &#39;ccc&#39;, &#39;ddd&#39; ], top: 4 }æ‰§è¡Œ pop æ–¹æ³•å Stack { data: [ &#39;aaa&#39;, &#39;bbb&#39;, &#39;ccc&#39; ], top: 3 }æ‰§è¡Œ peek æ–¹æ³•åè¿”å›ï¼š cccæ‰§è¡Œ clear æ–¹æ³•å Stack { data: [ &#39;aaa&#39;, &#39;bbb&#39;, &#39;ccc&#39; ], top: 0 }</code></pre><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><h3 id="å°†-10-è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶"><a href="#å°†-10-è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶" class="headerlink" title="å°† 10 è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶"></a>å°† 10 è¿›åˆ¶çš„æ•°è½¬åŒ–ä¸ºå¦ä¸€ç§è¿›åˆ¶</h3><p>æ­¤ç®—æ³•åªé’ˆå¯¹åŸºæ•°ä¸º 2 ï½ 9 çš„æƒ…å†µ</p><pre><code class="ts">function mulBase(num: number, base: number) {  const stack = new Stack()  while (num &gt; 0) {    stack.push(num % base)    num = Math.floor((num /= base))  }  let converted = &#39;&#39;  while (stack.length &gt; 0) {    converted += stack.pop()  }  return converted}console.log(&#39;num = 2 base = 2ï¼š&#39;, mulBase(2, 2)) // 10console.log(&#39;num = 32 base = 2ï¼š&#39;, mulBase(32, 2)) // 100000console.log(&#39;num = 125 base = 8ï¼š&#39;, mulBase(125, 8)) // 175</code></pre><h3 id="åˆ¤æ–­å›æ–‡"><a href="#åˆ¤æ–­å›æ–‡" class="headerlink" title="åˆ¤æ–­å›æ–‡"></a>åˆ¤æ–­å›æ–‡</h3><pre><code class="ts">function isPalindrome(word: string) {  let rword = &#39;&#39;  const stack = new Stack()  word.split(&#39;&#39;).forEach(w =&gt; stack.push(w))  while (stack.length &gt; 0) {     rword += stack.pop()  }  if(word === rword) {    return true  }  return false}console.log(&#39;hello&#39;, isPalindrome(&#39;hello&#39;));console.log(&#39;bob&#39;, isPalindrome(&#39;bob&#39;));console.log(&#39;racecar&#39;, isPalindrome(&#39;racecar&#39;));hello falsebob trueracecar true</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ ˆæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºå®ƒåªèƒ½åœ¨æ ˆé¡¶æ·»åŠ æˆ–åˆ é™¤ï¼Œè¿™æ ·çš„æ“ä½œå¾ˆå¿«ï¼Œå®ƒæ˜¯è¢«ç§°ä¹‹ä¸ºåå…¥å…ˆå‡ºï¼ˆLIFOï¼Œlast in first outï¼‰çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥å°†æ ˆæƒ³è±¡æˆä¸€å è£…èœçš„ç›˜å­ï¼Œç”¨çš„æ—¶å€™å…ˆæ‹¿æœ€ä¸Šé¢çš„ï¼Œæ´—å¥½çš„ç›˜å­åˆä¼šæ”¾åˆ°æœ€ä¸Šé¢&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹åˆ—è¡¨</title>
    <link href="https://coldstone.fun/post/2019/08/08/datastructure-list/"/>
    <id>https://coldstone.fun/post/2019/08/08/datastructure-list/</id>
    <published>2019-08-08T14:14:05.000Z</published>
    <updated>2019-12-06T12:04:58.098Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ—è¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä»£åŠäº‹é¡¹ï¼Œåä½³æ¦œå•ç­‰ã€‚å½“ä¸éœ€è¦åœ¨ä¸€ä¸ªå¾ˆé•¿çš„åºåˆ—ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œæˆ–è€…å¯¹å…¶æ’åºæ—¶ï¼Œåˆ—è¡¨æ˜¾å¾—å°¤å…¶æœ‰ç”¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åˆ—è¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä»£åŠäº‹é¡¹ï¼Œåä½³æ¦œå•ç­‰ã€‚å½“ä¸éœ€è¦åœ¨ä¸€ä¸ªå¾ˆé•¿çš„åºåˆ—ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œæˆ–è€…å¯¹å…¶æ’åºæ—¶ï¼Œåˆ—è¡¨æ˜¾å¾—å°¤å…¶æœ‰ç”¨</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ä½¿ç”¨ TypeScript å®ç°åˆ—è¡¨ç±»ï¼Œè¦å®ç°çš„çš„åˆ—è¡¨ç±»æ˜¯</p><pre><code class="ts">class List {  pos: number // åˆ—è¡¨å½“å‰ä½ç½®  listSize: number // åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°  data: [] // åˆ—è¡¨çš„æ•°æ®å­˜å‚¨ä½ç½®  constructor() {    this.pos = 0    this.listSize = 0    this.data = []  }  get length() {    return this.listSize  }  // æ¸…ç©ºåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´   clear() {}  // è¿”å›åˆ—è¡¨çš„å­—ç¬¦ä¸²å½¢å¼  toString() {}  // è¿”å›å½“å‰ä½ç½®çš„å…ƒç´   getElement() {}  // åœ¨ç°æœ‰å…ƒç´ åæ’å…¥æ–°å…ƒç´   insert() {}  // åœ¨åˆ—è¡¨çš„æœ«å°¾æ·»åŠ æ–°å…ƒç´   append() {}  // ä»åˆ—è¡¨ä¸­åˆ é™¤å…ƒç´   remove() {}  // å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªå…ƒç´   front() {}  // å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æœ€åä¸€ä¸ªå…ƒç´   end() {}  // å°†å½“å‰ä½ç½®å‘å‰ç§»ä¸€ä½  prev() {}  // å°†å½“å‰ä½ç½®å‘åç§»ä¸€ä½  next() {}  // åˆ¤æ–­æ˜¯å¦æœ‰åä¸€ä¸ªå…ƒç´   hasNext() {}  // åˆ¤æ–­æ˜¯å¦æœ‰å‰ä¸€ä¸ªå…ƒç´   hasPrev() {}  // è¿”å›åˆ—è¡¨çš„å½“å‰ä½ç½®  currentPos() {}  // å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®  moveTo() {}}</code></pre><p>å°†åˆ—è¡¨ç±»å®ç°å</p><pre><code class="ts">class List {  pos: number // åˆ—è¡¨å½“å‰ä½ç½®  data: Array&lt;any&gt; // åˆ—è¡¨çš„æ•°æ®å­˜å‚¨  listSize: number // åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°  constructor() {    this.pos = 0    this.listSize = 0    this.data = []  }  // è¿”å›åˆ—è¡¨çš„é•¿åº¦  get length() {    return this.listSize  }  // è¿”å›åˆ—è¡¨çš„å½“å‰ä½ç½®  get currentPos() {    return this.pos  }  // æ¸…ç©ºåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´   clear() {    delete this.data    this.data.length = this.listSize = this.pos = 0  }  // è¿”å›åˆ—è¡¨çš„å­—ç¬¦ä¸²å½¢å¼  toString() {    return this.data.toString()  }  // è¿”å›å½“å‰ä½ç½®çš„å…ƒç´   getElement() {    return this.data[this.pos]  }  // åœ¨ç°æœ‰å…ƒç´ åæ’å…¥æ–°å…ƒç´   insert(element: any, after: any) {    const index = this.findIndex(after)    if (index &gt; -1) {      this.data.splice(index + 1, 0, element)      this.listSize += 1      return true    }    return false  }  // åœ¨åˆ—è¡¨çš„æœ«å°¾æ·»åŠ æ–°å…ƒç´   append(element: any) {    this.data.push(element)    this.listSize += 1  }  // ä»åˆ—è¡¨ä¸­åˆ é™¤å…ƒç´   remove(element: any) {    const index = this.findIndex(element)    if (index &gt; -1) {      this.data.splice(index, 1)      this.listSize -= 1      return true    }    return false  }  // åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­  contains(element: any) {    return this.data.includes(element)  }  // å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªå…ƒç´   front() {    this.pos = 0  }  // å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æœ€åä¸€ä¸ªå…ƒç´   end() {    this.pos = this.listSize - 1  }  // å°†å½“å‰ä½ç½®å‘å‰ç§»ä¸€ä½  prev() {    if (this.pos &gt; 0) {      this.pos -= 1    }  }  // å°†å½“å‰ä½ç½®å‘åç§»ä¸€ä½  next() {    if (this.pos &lt; this.listSize) {      this.pos += 1    }  }  // åˆ¤æ–­æ˜¯å¦æœ‰åä¸€ä¸ªå…ƒç´   hasNext() {    return this.pos &lt; this.listSize  }  // åˆ¤æ–­æ˜¯å¦æœ‰å‰ä¸€ä¸ªå…ƒç´   hasPrev() {    return this.pos &gt; 0  }  // å°†åˆ—è¡¨çš„å½“å‰ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®  moveTo(position: number) {    if (position &gt; 0 &amp;&amp; position &lt; this.listSize) {      this.pos = position    }  }  // æŸ¥æ‰¾å…ƒç´ ä½ç½®  private findIndex(element: any) {    return this.data.findIndex(ele =&gt; element === ele)  }}</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre><code class="ts">const list = new List()list.append(&#39;aaa&#39;)list.append(&#39;bbb&#39;)list.append(&#39;ccc&#39;)list.append(&#39;ddd&#39;)list.append(&#39;eee&#39;)console.log(&#39;list :&#39;, list)</code></pre><p>è¾“å‡º</p><pre><code class="ts">list : List {  pos: 0,  listSize: 5,  data: [ &#39;aaa&#39;, &#39;bbb&#39;, &#39;ccc&#39;, &#39;ddd&#39;, &#39;eee&#39; ] }</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆ—è¡¨æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä»£åŠäº‹é¡¹ï¼Œåä½³æ¦œå•ç­‰ã€‚å½“ä¸éœ€è¦åœ¨ä¸€ä¸ªå¾ˆé•¿çš„åºåˆ—ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œæˆ–è€…å¯¹å…¶æ’åºæ—¶ï¼Œåˆ—è¡¨æ˜¾å¾—å°¤å…¶æœ‰ç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
</feed>
